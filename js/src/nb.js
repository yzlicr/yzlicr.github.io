"use strict";var t={REVISION:"71"};"object"===typeof module&&(module.exports=t);void 0===Math.sign&&(Math.sign=function(t){return 0>t?-1:0<t?1:+t});t.log=function(){console.log.apply(console,arguments)};t.warn=function(){console.warn.apply(console,arguments)};t.error=function(){console.error.apply(console,arguments)};t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};t.CullFaceNone=0;t.CullFaceBack=1;t.CullFaceFront=2;t.CullFaceFrontBack=3;t.FrontFaceDirectionCW=0;t.FrontFaceDirectionCCW=1;t.BasicShadowMap=0;t.PCFShadowMap=1;t.PCFSoftShadowMap=2;t.FrontSide=0;t.BackSide=1;t.DoubleSide=2;t.NoShading=0;t.FlatShading=1;t.SmoothShading=2;t.NoColors=0;t.FaceColors=1;t.VertexColors=2;t.NoBlending=0;t.NormalBlending=1;t.AdditiveBlending=2;t.SubtractiveBlending=3;t.MultiplyBlending=4;t.CustomBlending=5;t.AddEquation=100;t.SubtractEquation=101;t.ReverseSubtractEquation=102;t.MinEquation=103;t.MaxEquation=104;t.ZeroFactor=200;t.OneFactor=201;t.SrcColorFactor=202;t.OneMinusSrcColorFactor=203;t.SrcAlphaFactor=204;t.OneMinusSrcAlphaFactor=205;t.DstAlphaFactor=206;t.OneMinusDstAlphaFactor=207;t.DstColorFactor=208;t.OneMinusDstColorFactor=209;t.SrcAlphaSaturateFactor=210;t.MultiplyOperation=0;t.MixOperation=1;t.AddOperation=2;t.UVMapping=300;t.CubeReflectionMapping=301;t.CubeRefractionMapping=302;t.EquirectangularReflectionMapping=303;t.EquirectangularRefractionMapping=304;t.SphericalReflectionMapping=305;t.RepeatWrapping=1e3;t.ClampToEdgeWrapping=1001;t.MirroredRepeatWrapping=1002;t.NearestFilter=1003;t.NearestMipMapNearestFilter=1004;t.NearestMipMapLinearFilter=1005;t.LinearFilter=1006;t.LinearMipMapNearestFilter=1007;t.LinearMipMapLinearFilter=1008;t.UnsignedByteType=1009;t.ByteType=1010;t.ShortType=1011;t.UnsignedShortType=1012;t.IntType=1013;t.UnsignedIntType=1014;t.FloatType=1015;t.HalfFloatType=1025;t.UnsignedShort4444Type=1016;t.UnsignedShort5551Type=1017;t.UnsignedShort565Type=1018;t.AlphaFormat=1019;t.RGBFormat=1020;t.RGBAFormat=1021;t.LuminanceFormat=1022;t.LuminanceAlphaFormat=1023;t.RGBEFormat=t.RGBAFormat;t.RGB_S3TC_DXT1_Format=2001;t.RGBA_S3TC_DXT1_Format=2002;t.RGBA_S3TC_DXT3_Format=2003;t.RGBA_S3TC_DXT5_Format=2004;t.RGB_PVRTC_4BPPV1_Format=2100;t.RGB_PVRTC_2BPPV1_Format=2101;t.RGBA_PVRTC_4BPPV1_Format=2102;t.RGBA_PVRTC_2BPPV1_Format=2103;t.Projector=function(){t.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(e,r){t.warn("THREE.Projector: .projectVector() is now vector.project().");e.project(r)};this.unprojectVector=function(e,r){t.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");e.unproject(r)};this.pickingRay=function(e,r){t.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};t.CanvasRenderer=function(){t.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElement("canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};t.Color=function(t){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(t)};t.Color.prototype={constructor:t.Color,r:1,g:1,b:1,set:function(e){e instanceof t.Color?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e);return this},setHex:function(t){t=Math.floor(t);this.r=(t>>16&255)/255;this.g=(t>>8&255)/255;this.b=(t&255)/255;return this},setRGB:function(t,e,r){this.r=t;this.g=e;this.b=r;return this},setHSL:function(t,e,r){if(0===e)this.r=this.g=this.b=r;else{var i=function(t,e,r){0>r&&(r+=1);1<r&&(r-=1);return r<1/6?t+6*(e-t)*r:.5>r?e:r<2/3?t+6*(e-t)*(2/3-r):t};e=.5>=r?r*(1+e):r+e-r*e;r=2*r-e;this.r=i(r,e,t+1/3);this.g=i(r,e,t);this.b=i(r,e,t-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e))return e=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e),this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,this;if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e))return e=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e),this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,this;if(/^\#([0-9a-f]{6})$/i.test(e))return e=/^\#([0-9a-f]{6})$/i.exec(e),this.setHex(parseInt(e[1],16)),this;if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e))return e=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e),this.setHex(parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3],16)),this;if(/^(\w+)$/i.test(e))return this.setHex(t.ColorKeywords[e]),this},copy:function(t){this.r=t.r;this.g=t.g;this.b=t.b;return this},copyGammaToLinear:function(t,e){void 0===e&&(e=2);this.r=Math.pow(t.r,e);this.g=Math.pow(t.g,e);this.b=Math.pow(t.b,e);return this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var r=0<e?1/e:1;this.r=Math.pow(t.r,r);this.g=Math.pow(t.g,r);this.b=Math.pow(t.b,r);return this},convertGammaToLinear:function(){var t=this.r,e=this.g,r=this.b;this.r=t*t;this.g=e*e;this.b=r*r;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){t=t||{h:0,s:0,l:0};var e=this.r,r=this.g,i=this.b,n=Math.max(e,r,i),o=Math.min(e,r,i),a,s=(o+n)/2;if(o===n)o=a=0;else{var h=n-o,o=.5>=s?h/(n+o):h/(2-n-o);switch(n){case e:a=(r-i)/h+(r<i?6:0);break;case r:a=(i-e)/h+2;break;case i:a=(e-r)/h+4}a/=6}t.h=a;t.s=o;t.l=s;return t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,r){var i=this.getHSL();i.h+=t;i.s+=e;i.l+=r;this.setHSL(i.h,i.s,i.l);return this},add:function(t){this.r+=t.r;this.g+=t.g;this.b+=t.b;return this},addColors:function(t,e){this.r=t.r+e.r;this.g=t.g+e.g;this.b=t.b+e.b;return this},addScalar:function(t){this.r+=t;this.g+=t;this.b+=t;return this},multiply:function(t){this.r*=t.r;this.g*=t.g;this.b*=t.b;return this},multiplyScalar:function(t){this.r*=t;this.g*=t;this.b*=t;return this},lerp:function(t,e){this.r+=(t.r-this.r)*e;this.g+=(t.g-this.g)*e;this.b+=(t.b-this.b)*e;return this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t){this.r=t[0];this.g=t[1];this.b=t[2];return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);t[e]=this.r;t[e+1]=this.g;t[e+2]=this.b;return t},clone:function(){return(new t.Color).setRGB(this.r,this.g,this.b)}};t.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};t.Quaternion=function(t,e,r,i){this._x=t||0;this._y=e||0;this._z=r||0;this._w=void 0!==i?i:1};t.Quaternion.prototype={constructor:t.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(t){this._x=t;this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t;this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t;this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t;this.onChangeCallback()},set:function(t,e,r,i){this._x=t;this._y=e;this._z=r;this._w=i;this.onChangeCallback();return this},copy:function(t){this._x=t.x;this._y=t.y;this._z=t.z;this._w=t.w;this.onChangeCallback();return this},setFromEuler:function(e,r){if(!1===e instanceof t.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var i=Math.cos(e._x/2),n=Math.cos(e._y/2),o=Math.cos(e._z/2),a=Math.sin(e._x/2),s=Math.sin(e._y/2),h=Math.sin(e._z/2);"XYZ"===e.order?(this._x=a*n*o+i*s*h,this._y=i*s*o-a*n*h,this._z=i*n*h+a*s*o,this._w=i*n*o-a*s*h):"YXZ"===e.order?(this._x=a*n*o+i*s*h,this._y=i*s*o-a*n*h,this._z=i*n*h-a*s*o,this._w=i*n*o+a*s*h):"ZXY"===e.order?(this._x=a*n*o-i*s*h,this._y=i*s*o+a*n*h,this._z=i*n*h+a*s*o,this._w=i*n*o-a*s*h):"ZYX"===e.order?(this._x=a*n*o-i*s*h,this._y=i*s*o+a*n*h,this._z=i*n*h-a*s*o,this._w=i*n*o+a*s*h):"YZX"===e.order?(this._x=a*n*o+i*s*h,this._y=i*s*o+a*n*h,this._z=i*n*h-a*s*o,this._w=i*n*o-a*s*h):"XZY"===e.order&&(this._x=a*n*o-i*s*h,this._y=i*s*o-a*n*h,this._z=i*n*h+a*s*o,this._w=i*n*o+a*s*h);if(!1!==r)this.onChangeCallback();return this},setFromAxisAngle:function(t,e){var r=e/2,i=Math.sin(r);this._x=t.x*i;this._y=t.y*i;this._z=t.z*i;this._w=Math.cos(r);this.onChangeCallback();return this},setFromRotationMatrix:function(t){var e=t.elements,r=e[0];t=e[4];var i=e[8],n=e[1],o=e[5],a=e[9],s=e[2],h=e[6],e=e[10],l=r+o+e;0<l?(r=.5/Math.sqrt(l+1),this._w=.25/r,this._x=(h-a)*r,this._y=(i-s)*r,this._z=(n-t)*r):r>o&&r>e?(r=2*Math.sqrt(1+r-o-e),this._w=(h-a)/r,this._x=.25*r,this._y=(t+n)/r,this._z=(i+s)/r):o>e?(r=2*Math.sqrt(1+o-r-e),this._w=(i-s)/r,this._x=(t+n)/r,this._y=.25*r,this._z=(a+h)/r):(r=2*Math.sqrt(1+e-r-o),this._w=(n-t)/r,this._x=(i+s)/r,this._y=(a+h)/r,this._z=.25*r);this.onChangeCallback();return this},setFromUnitVectors:function(){var e,r;return function(i,n){void 0===e&&(e=new t.Vector3);r=i.dot(n)+1;1e-6>r?(r=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,n);this._x=e.x;this._y=e.y;this._z=e.z;this._w=r;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();0===t?(this._z=this._y=this._x=0,this._w=1):(t=1/t,this._x*=t,this._y*=t,this._z*=t,this._w*=t);this.onChangeCallback();return this},multiply:function(e,r){return void 0!==r?(t.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,r)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(t,e){var r=t._x,i=t._y,n=t._z,o=t._w,a=e._x,s=e._y,h=e._z,l=e._w;this._x=r*l+o*a+i*h-n*s;this._y=i*l+o*s+n*a-r*h;this._z=n*l+o*h+r*s-i*a;this._w=o*l-r*a-i*s-n*h;this.onChangeCallback();return this},multiplyVector3:function(e){t.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,i=this._y,n=this._z,o=this._w,a=o*t._w+r*t._x+i*t._y+n*t._z;0>a?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t);if(1<=a)return this._w=o,this._x=r,this._y=i,this._z=n,this;var s=Math.acos(a),h=Math.sqrt(1-a*a);if(.001>Math.abs(h))return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(i+this._y),this._z=.5*(n+this._z),this;a=Math.sin((1-e)*s)/h;s=Math.sin(e*s)/h;this._w=o*a+this._w*s;this._x=r*a+this._x*s;this._y=i*a+this._y*s;this._z=n*a+this._z*s;this.onChangeCallback();return this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){void 0===e&&(e=0);this._x=t[e];this._y=t[e+1];this._z=t[e+2];this._w=t[e+3];this.onChangeCallback();return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);t[e]=this._x;t[e+1]=this._y;t[e+2]=this._z;t[e+3]=this._w;return t},onChange:function(t){this.onChangeCallback=t;return this},onChangeCallback:function(){},clone:function(){return new t.Quaternion(this._x,this._y,this._z,this._w)}};t.Quaternion.slerp=function(t,e,r,i){return r.copy(t).slerp(e,i)};t.Vector2=function(t,e){this.x=t||0;this.y=e||0};t.Vector2.prototype={constructor:t.Vector2,set:function(t,e){this.x=t;this.y=e;return this},setX:function(t){this.x=t;return this},setY:function(t){this.y=t;return this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+t)}},copy:function(t){this.x=t.x;this.y=t.y;return this},add:function(e,r){if(void 0!==r)return t.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,r);this.x+=e.x;this.y+=e.y;return this},addScalar:function(t){this.x+=t;this.y+=t;return this},addVectors:function(t,e){this.x=t.x+e.x;this.y=t.y+e.y;return this},sub:function(e,r){if(void 0!==r)return t.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,r);this.x-=e.x;this.y-=e.y;return this},subScalar:function(t){this.x-=t;this.y-=t;return this},subVectors:function(t,e){this.x=t.x-e.x;this.y=t.y-e.y;return this},multiply:function(t){this.x*=t.x;this.y*=t.y;return this},multiplyScalar:function(t){this.x*=t;this.y*=t;return this},divide:function(t){this.x/=t.x;this.y/=t.y;return this},divideScalar:function(t){0!==t?(t=1/t,this.x*=t,this.y*=t):this.y=this.x=0;return this},min:function(t){this.x>t.x&&(this.x=t.x);this.y>t.y&&(this.y=t.y);return this},max:function(t){this.x<t.x&&(this.x=t.x);this.y<t.y&&(this.y=t.y);return this},clamp:function(t,e){this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x);this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y);return this},clampScalar:function(){var e,r;return function(i,n){void 0===e&&(e=new t.Vector2,r=new t.Vector2);e.set(i,i);r.set(n,n);return this.clamp(e,r)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x;t=this.y-t.y;return e*e+t*t},setLength:function(t){var e=this.length();0!==e&&t!==e&&this.multiplyScalar(t/e);return this},lerp:function(t,e){this.x+=(t.x-this.x)*e;this.y+=(t.y-this.y)*e;return this},lerpVectors:function(t,e,r){this.subVectors(e,t).multiplyScalar(r).add(t);return this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){void 0===e&&(e=0);this.x=t[e];this.y=t[e+1];return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);t[e]=this.x;t[e+1]=this.y;return t},fromAttribute:function(t,e,r){void 0===r&&(r=0);e=e*t.itemSize+r;this.x=t.array[e];this.y=t.array[e+1];return this},clone:function(){return new t.Vector2(this.x,this.y)}};t.Vector3=function(t,e,r){this.x=t||0;this.y=e||0;this.z=r||0};t.Vector3.prototype={constructor:t.Vector3,set:function(t,e,r){this.x=t;this.y=e;this.z=r;return this},setX:function(t){this.x=t;return this},setY:function(t){this.y=t;return this},setZ:function(t){this.z=t;return this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+t)}},copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;return this},add:function(e,r){if(void 0!==r)return t.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,r);this.x+=e.x;this.y+=e.y;this.z+=e.z;return this},addScalar:function(t){this.x+=t;this.y+=t;this.z+=t;return this},addVectors:function(t,e){this.x=t.x+e.x;this.y=t.y+e.y;this.z=t.z+e.z;return this},sub:function(e,r){if(void 0!==r)return t.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,r);this.x-=e.x;this.y-=e.y;this.z-=e.z;return this},subScalar:function(t){this.x-=t;this.y-=t;this.z-=t;return this},subVectors:function(t,e){this.x=t.x-e.x;this.y=t.y-e.y;this.z=t.z-e.z;return this},multiply:function(e,r){if(void 0!==r)return t.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,r);this.x*=e.x;this.y*=e.y;this.z*=e.z;return this},multiplyScalar:function(t){this.x*=t;this.y*=t;this.z*=t;return this},multiplyVectors:function(t,e){this.x=t.x*e.x;this.y=t.y*e.y;this.z=t.z*e.z;return this},applyEuler:function(){var e;return function(r){!1===r instanceof t.Euler&&t.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.");void 0===e&&(e=new t.Quaternion);this.applyQuaternion(e.setFromEuler(r));return this}}(),applyAxisAngle:function(){var e;return function(r,i){void 0===e&&(e=new t.Quaternion);this.applyQuaternion(e.setFromAxisAngle(r,i));return this}}(),applyMatrix3:function(t){var e=this.x,r=this.y,i=this.z;t=t.elements;this.x=t[0]*e+t[3]*r+t[6]*i;this.y=t[1]*e+t[4]*r+t[7]*i;this.z=t[2]*e+t[5]*r+t[8]*i;return this},applyMatrix4:function(t){var e=this.x,r=this.y,i=this.z;t=t.elements;this.x=t[0]*e+t[4]*r+t[8]*i+t[12];this.y=t[1]*e+t[5]*r+t[9]*i+t[13];this.z=t[2]*e+t[6]*r+t[10]*i+t[14];return this},applyProjection:function(t){var e=this.x,r=this.y,i=this.z;t=t.elements;var n=1/(t[3]*e+t[7]*r+t[11]*i+t[15]);this.x=(t[0]*e+t[4]*r+t[8]*i+t[12])*n;this.y=(t[1]*e+t[5]*r+t[9]*i+t[13])*n;this.z=(t[2]*e+t[6]*r+t[10]*i+t[14])*n;return this},applyQuaternion:function(t){var e=this.x,r=this.y,i=this.z,n=t.x,o=t.y,a=t.z;t=t.w;var s=t*e+o*i-a*r,h=t*r+a*e-n*i,l=t*i+n*r-o*e,e=-n*e-o*r-a*i;this.x=s*t+e*-n+h*-a-l*-o;this.y=h*t+e*-o+l*-n-s*-a;this.z=l*t+e*-a+s*-o-h*-n;return this},project:function(){var e;return function(r){void 0===e&&(e=new t.Matrix4);e.multiplyMatrices(r.projectionMatrix,e.getInverse(r.matrixWorld));return this.applyProjection(e)}}(),unproject:function(){var e;return function(r){void 0===e&&(e=new t.Matrix4);e.multiplyMatrices(r.matrixWorld,e.getInverse(r.projectionMatrix));return this.applyProjection(e)}}(),transformDirection:function(t){var e=this.x,r=this.y,i=this.z;t=t.elements;this.x=t[0]*e+t[4]*r+t[8]*i;this.y=t[1]*e+t[5]*r+t[9]*i;this.z=t[2]*e+t[6]*r+t[10]*i;this.normalize();return this},divide:function(t){this.x/=t.x;this.y/=t.y;this.z/=t.z;return this},divideScalar:function(t){0!==t?(t=1/t,this.x*=t,this.y*=t,this.z*=t):this.z=this.y=this.x=0;return this},min:function(t){this.x>t.x&&(this.x=t.x);this.y>t.y&&(this.y=t.y);this.z>t.z&&(this.z=t.z);return this},max:function(t){this.x<t.x&&(this.x=t.x);this.y<t.y&&(this.y=t.y);this.z<t.z&&(this.z=t.z);return this},clamp:function(t,e){this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x);this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y);this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z);return this},clampScalar:function(){var e,r;return function(i,n){void 0===e&&(e=new t.Vector3,r=new t.Vector3);e.set(i,i,i);r.set(n,n,n);return this.clamp(e,r)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();0!==e&&t!==e&&this.multiplyScalar(t/e);return this},lerp:function(t,e){this.x+=(t.x-this.x)*e;this.y+=(t.y-this.y)*e;this.z+=(t.z-this.z)*e;return this},lerpVectors:function(t,e,r){this.subVectors(e,t).multiplyScalar(r).add(t);return this},cross:function(e,r){if(void 0!==r)return t.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,r);var i=this.x,n=this.y,o=this.z;this.x=n*e.z-o*e.y;this.y=o*e.x-i*e.z;this.z=i*e.y-n*e.x;return this},crossVectors:function(t,e){var r=t.x,i=t.y,n=t.z,o=e.x,a=e.y,s=e.z;this.x=i*s-n*a;this.y=n*o-r*s;this.z=r*a-i*o;return this},projectOnVector:function(){var e,r;return function(i){void 0===e&&(e=new t.Vector3);e.copy(i).normalize();r=this.dot(e);return this.copy(e).multiplyScalar(r)}}(),projectOnPlane:function(){var e;return function(r){void 0===e&&(e=new t.Vector3);e.copy(this).projectOnVector(r);return this.sub(e)}}(),reflect:function(){var e;return function(r){void 0===e&&(e=new t.Vector3);return this.sub(e.copy(r).multiplyScalar(2*this.dot(r)))}}(),angleTo:function(e){e=this.dot(e)/(this.length()*e.length());return Math.acos(t.Math.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y;t=this.z-t.z;return e*e+r*r+t*t},setEulerFromRotationMatrix:function(e,r){t.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,r){t.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){t.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){t.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,r){t.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(e,r)},setFromMatrixPosition:function(t){this.x=t.elements[12];this.y=t.elements[13];this.z=t.elements[14];return this},setFromMatrixScale:function(t){var e=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),r=this.set(t.elements[4],t.elements[5],t.elements[6]).length();t=this.set(t.elements[8],t.elements[9],t.elements[10]).length();this.x=e;this.y=r;this.z=t;return this},setFromMatrixColumn:function(t,e){var r=4*t,i=e.elements;this.x=i[r];this.y=i[r+1];this.z=i[r+2];return this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){void 0===e&&(e=0);this.x=t[e];this.y=t[e+1];this.z=t[e+2];return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);t[e]=this.x;t[e+1]=this.y;t[e+2]=this.z;return t},fromAttribute:function(t,e,r){void 0===r&&(r=0);e=e*t.itemSize+r;this.x=t.array[e];this.y=t.array[e+1];this.z=t.array[e+2];return this},clone:function(){return new t.Vector3(this.x,this.y,this.z)}};t.Vector4=function(t,e,r,i){this.x=t||0;this.y=e||0;this.z=r||0;this.w=void 0!==i?i:1};t.Vector4.prototype={constructor:t.Vector4,set:function(t,e,r,i){this.x=t;this.y=e;this.z=r;this.w=i;return this},setX:function(t){this.x=t;return this},setY:function(t){this.y=t;return this},setZ:function(t){this.z=t;return this},setW:function(t){this.w=t;return this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+t)}},copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;this.w=void 0!==t.w?t.w:1;return this},add:function(e,r){if(void 0!==r)return t.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,r);this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this},addScalar:function(t){this.x+=t;this.y+=t;this.z+=t;this.w+=t;return this},addVectors:function(t,e){this.x=t.x+e.x;this.y=t.y+e.y;this.z=t.z+e.z;this.w=t.w+e.w;return this},sub:function(e,r){if(void 0!==r)return t.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,r);this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this},subScalar:function(t){this.x-=t;this.y-=t;this.z-=t;this.w-=t;return this},subVectors:function(t,e){this.x=t.x-e.x;this.y=t.y-e.y;this.z=t.z-e.z;this.w=t.w-e.w;return this},multiplyScalar:function(t){this.x*=t;this.y*=t;this.z*=t;this.w*=t;return this},applyMatrix4:function(t){var e=this.x,r=this.y,i=this.z,n=this.w;t=t.elements;this.x=t[0]*e+t[4]*r+t[8]*i+t[12]*n;this.y=t[1]*e+t[5]*r+t[9]*i+t[13]*n;this.z=t[2]*e+t[6]*r+t[10]*i+t[14]*n;this.w=t[3]*e+t[7]*r+t[11]*i+t[15]*n;return this},divideScalar:function(t){0!==t?(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t):(this.z=this.y=this.x=0,this.w=1);return this},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);1e-4>e?(this.x=1,this.z=this.y=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e);return this},setAxisAngleFromRotationMatrix:function(t){var e,r,i;t=t.elements;var n=t[0];i=t[4];var o=t[8],a=t[1],s=t[5],h=t[9];r=t[2];e=t[6];var l=t[10];if(.01>Math.abs(i-a)&&.01>Math.abs(o-r)&&.01>Math.abs(h-e)){if(.1>Math.abs(i+a)&&.1>Math.abs(o+r)&&.1>Math.abs(h+e)&&.1>Math.abs(n+s+l-3))return this.set(1,0,0,0),this;t=Math.PI;n=(n+1)/2;s=(s+1)/2;l=(l+1)/2;i=(i+a)/4;o=(o+r)/4;h=(h+e)/4;n>s&&n>l?.01>n?(e=0,i=r=.707106781):(e=Math.sqrt(n),r=i/e,i=o/e):s>l?.01>s?(e=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),e=i/r,i=h/r):.01>l?(r=e=.707106781,i=0):(i=Math.sqrt(l),e=o/i,r=h/i);this.set(e,r,i,t);return this}t=Math.sqrt((e-h)*(e-h)+(o-r)*(o-r)+(a-i)*(a-i));.001>Math.abs(t)&&(t=1);this.x=(e-h)/t;this.y=(o-r)/t;this.z=(a-i)/t;this.w=Math.acos((n+s+l-1)/2);return this},min:function(t){this.x>t.x&&(this.x=t.x);this.y>t.y&&(this.y=t.y);this.z>t.z&&(this.z=t.z);this.w>t.w&&(this.w=t.w);return this},max:function(t){this.x<t.x&&(this.x=t.x);this.y<t.y&&(this.y=t.y);this.z<t.z&&(this.z=t.z);this.w<t.w&&(this.w=t.w);return this},clamp:function(t,e){this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x);this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y);this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z);this.w<t.w?this.w=t.w:this.w>e.w&&(this.w=e.w);return this},clampScalar:function(){var e,r;return function(i,n){void 0===e&&(e=new t.Vector4,r=new t.Vector4);e.set(i,i,i,i);r.set(n,n,n,n);return this.clamp(e,r)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();0!==e&&t!==e&&this.multiplyScalar(t/e);return this},lerp:function(t,e){this.x+=(t.x-this.x)*e;this.y+=(t.y-this.y)*e;this.z+=(t.z-this.z)*e;this.w+=(t.w-this.w)*e;return this},lerpVectors:function(t,e,r){this.subVectors(e,t).multiplyScalar(r).add(t);return this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){void 0===e&&(e=0);this.x=t[e];this.y=t[e+1];this.z=t[e+2];this.w=t[e+3];return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);t[e]=this.x;t[e+1]=this.y;t[e+2]=this.z;t[e+3]=this.w;return t},fromAttribute:function(t,e,r){void 0===r&&(r=0);e=e*t.itemSize+r;this.x=t.array[e];this.y=t.array[e+1];this.z=t.array[e+2];this.w=t.array[e+3];return this},clone:function(){return new t.Vector4(this.x,this.y,this.z,this.w)}};t.Euler=function(e,r,i,n){this._x=e||0;this._y=r||0;this._z=i||0;this._order=n||t.Euler.DefaultOrder};t.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");t.Euler.DefaultOrder="XYZ";t.Euler.prototype={constructor:t.Euler,_x:0,_y:0,_z:0,_order:t.Euler.DefaultOrder,get x(){return this._x},set x(t){this._x=t;this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t;this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t;this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t;this.onChangeCallback()},set:function(t,e,r,i){this._x=t;this._y=e;this._z=r;this._order=i||this._order;
this.onChangeCallback();return this},copy:function(t){this._x=t._x;this._y=t._y;this._z=t._z;this._order=t._order;this.onChangeCallback();return this},setFromRotationMatrix:function(e,r,i){var n=t.Math.clamp,o=e.elements;e=o[0];var a=o[4],s=o[8],h=o[1],l=o[5],c=o[9],u=o[2],f=o[6],o=o[10];r=r||this._order;"XYZ"===r?(this._y=Math.asin(n(s,-1,1)),.99999>Math.abs(s)?(this._x=Math.atan2(-c,o),this._z=Math.atan2(-a,e)):(this._x=Math.atan2(f,l),this._z=0)):"YXZ"===r?(this._x=Math.asin(-n(c,-1,1)),.99999>Math.abs(c)?(this._y=Math.atan2(s,o),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-u,e),this._z=0)):"ZXY"===r?(this._x=Math.asin(n(f,-1,1)),.99999>Math.abs(f)?(this._y=Math.atan2(-u,o),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(h,e))):"ZYX"===r?(this._y=Math.asin(-n(u,-1,1)),.99999>Math.abs(u)?(this._x=Math.atan2(f,o),this._z=Math.atan2(h,e)):(this._x=0,this._z=Math.atan2(-a,l))):"YZX"===r?(this._z=Math.asin(n(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,e)):(this._x=0,this._y=Math.atan2(s,o))):"XZY"===r?(this._z=Math.asin(-n(a,-1,1)),.99999>Math.abs(a)?(this._x=Math.atan2(f,l),this._y=Math.atan2(s,e)):(this._x=Math.atan2(-c,o),this._y=0)):t.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+r);this._order=r;if(!1!==i)this.onChangeCallback();return this},setFromQuaternion:function(){var e;return function(r,i,n){void 0===e&&(e=new t.Matrix4);e.makeRotationFromQuaternion(r);this.setFromRotationMatrix(e,i,n);return this}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var e=new t.Quaternion;return function(t){e.setFromEuler(this);this.setFromQuaternion(e,t)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){this._x=t[0];this._y=t[1];this._z=t[2];void 0!==t[3]&&(this._order=t[3]);this.onChangeCallback();return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);t[e]=this._x;t[e+1]=this._y;t[e+2]=this._z;t[e+3]=this._order;return t},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new t.Vector3(this._x,this._y,this._z)},onChange:function(t){this.onChangeCallback=t;return this},onChangeCallback:function(){},clone:function(){return new t.Euler(this._x,this._y,this._z,this._order)}};t.Line3=function(e,r){this.start=void 0!==e?e:new t.Vector3;this.end=void 0!==r?r:new t.Vector3};t.Line3.prototype={constructor:t.Line3,set:function(t,e){this.start.copy(t);this.end.copy(e);return this},copy:function(t){this.start.copy(t.start);this.end.copy(t.end);return this},center:function(e){return(e||new t.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new t.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,r){var i=r||new t.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new t.Vector3,r=new t.Vector3;return function(i,n){e.subVectors(i,this.start);r.subVectors(this.end,this.start);var o=r.dot(r),o=r.dot(e)/o;n&&(o=t.Math.clamp(o,0,1));return o}}(),closestPointToPoint:function(e,r,i){e=this.closestPointToPointParameter(e,r);i=i||new t.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},applyMatrix4:function(t){this.start.applyMatrix4(t);this.end.applyMatrix4(t);return this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)},clone:function(){return(new t.Line3).copy(this)}};t.Box2=function(e,r){this.min=void 0!==e?e:new t.Vector2(Infinity,Infinity);this.max=void 0!==r?r:new t.Vector2((-Infinity),(-Infinity))};t.Box2.prototype={constructor:t.Box2,set:function(t,e){this.min.copy(t);this.max.copy(e);return this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var e=new t.Vector2;return function(t,r){var i=e.copy(r).multiplyScalar(.5);this.min.copy(t).sub(i);this.max.copy(t).add(i);return this}}(),copy:function(t){this.min.copy(t.min);this.max.copy(t.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new t.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new t.Vector2).subVectors(this.max,this.min)},expandByPoint:function(t){this.min.min(t);this.max.max(t);return this},expandByVector:function(t){this.min.sub(t);this.max.add(t);return this},expandByScalar:function(t){this.min.addScalar(-t);this.max.addScalar(t);return this},containsPoint:function(t){return t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y?!1:!0},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y?!0:!1},getParameter:function(e,r){return(r||new t.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(t){return t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y?!1:!0},clampPoint:function(e,r){return(r||new t.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new t.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(t){this.min.max(t.min);this.max.min(t.max);return this},union:function(t){this.min.min(t.min);this.max.max(t.max);return this},translate:function(t){this.min.add(t);this.max.add(t);return this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},clone:function(){return(new t.Box2).copy(this)}};t.Box3=function(e,r){this.min=void 0!==e?e:new t.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==r?r:new t.Vector3((-Infinity),(-Infinity),(-Infinity))};t.Box3.prototype={constructor:t.Box3,set:function(t,e){this.min.copy(t);this.max.copy(e);return this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var e=new t.Vector3;return function(t,r){var i=e.copy(r).multiplyScalar(.5);this.min.copy(t).sub(i);this.max.copy(t).add(i);return this}}(),setFromObject:function(){var e=new t.Vector3;return function(r){var i=this;r.updateMatrixWorld(!0);this.makeEmpty();r.traverse(function(r){var n=r.geometry;if(void 0!==n)if(n instanceof t.Geometry)for(var o=n.vertices,n=0,a=o.length;n<a;n++)e.copy(o[n]),e.applyMatrix4(r.matrixWorld),i.expandByPoint(e);else if(n instanceof t.BufferGeometry&&void 0!==n.attributes.position)for(o=n.attributes.position.array,n=0,a=o.length;n<a;n+=3)e.set(o[n],o[n+1],o[n+2]),e.applyMatrix4(r.matrixWorld),i.expandByPoint(e)});return this}}(),copy:function(t){this.min.copy(t.min);this.max.copy(t.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new t.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new t.Vector3).subVectors(this.max,this.min)},expandByPoint:function(t){this.min.min(t);this.max.max(t);return this},expandByVector:function(t){this.min.sub(t);this.max.add(t);return this},expandByScalar:function(t){this.min.addScalar(-t);this.max.addScalar(t);return this},containsPoint:function(t){return t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z?!1:!0},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z?!0:!1},getParameter:function(e,r){return(r||new t.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(t){return t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z?!1:!0},clampPoint:function(e,r){return(r||new t.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new t.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new t.Vector3;return function(r){r=r||new t.Sphere;r.center=this.center();r.radius=.5*this.size(e).length();return r}}(),intersect:function(t){this.min.max(t.min);this.max.min(t.max);return this},union:function(t){this.min.min(t.min);this.max.max(t.max);return this},applyMatrix4:function(){var e=[new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3];return function(t){e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t);e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t);e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t);e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t);e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t);e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t);e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t);e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t);this.makeEmpty();this.setFromPoints(e);return this}}(),translate:function(t){this.min.add(t);this.max.add(t);return this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},clone:function(){return(new t.Box3).copy(this)}};t.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&t.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};t.Matrix3.prototype={constructor:t.Matrix3,set:function(t,e,r,i,n,o,a,s,h){var l=this.elements;l[0]=t;l[3]=e;l[6]=r;l[1]=i;l[4]=n;l[7]=o;l[2]=a;l[5]=s;l[8]=h;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(t){t=t.elements;this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]);return this},multiplyVector3:function(e){t.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)},multiplyVector3Array:function(e){t.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new t.Vector3;return function(t,r,i){void 0===r&&(r=0);void 0===i&&(i=t.length);for(var n=0;n<i;n+=3,r+=3)e.x=t[r],e.y=t[r+1],e.z=t[r+2],e.applyMatrix3(this),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z;return t}}(),multiplyScalar:function(t){var e=this.elements;e[0]*=t;e[3]*=t;e[6]*=t;e[1]*=t;e[4]*=t;e[7]*=t;e[2]*=t;e[5]*=t;e[8]*=t;return this},determinant:function(){var t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],o=t[4],a=t[5],s=t[6],h=t[7],t=t[8];return e*o*t-e*a*h-r*n*t+r*a*s+i*n*h-i*o*s},getInverse:function(e,r){var i=e.elements,n=this.elements;n[0]=i[10]*i[5]-i[6]*i[9];n[1]=-i[10]*i[1]+i[2]*i[9];n[2]=i[6]*i[1]-i[2]*i[5];n[3]=-i[10]*i[4]+i[6]*i[8];n[4]=i[10]*i[0]-i[2]*i[8];n[5]=-i[6]*i[0]+i[2]*i[4];n[6]=i[9]*i[4]-i[5]*i[8];n[7]=-i[9]*i[0]+i[1]*i[8];n[8]=i[5]*i[0]-i[1]*i[4];i=i[0]*n[0]+i[1]*n[3]+i[2]*n[6];if(0===i){if(r)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");t.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/i);return this},transpose:function(){var t,e=this.elements;t=e[1];e[1]=e[3];e[3]=t;t=e[2];e[2]=e[6];e[6]=t;t=e[5];e[5]=e[7];e[7]=t;return this},flattenToArrayOffset:function(t,e){var r=this.elements;t[e]=r[0];t[e+1]=r[1];t[e+2]=r[2];t[e+3]=r[3];t[e+4]=r[4];t[e+5]=r[5];t[e+6]=r[6];t[e+7]=r[7];t[e+8]=r[8];return t},getNormalMatrix:function(t){this.getInverse(t).transpose();return this},transposeIntoArray:function(t){var e=this.elements;t[0]=e[0];t[1]=e[3];t[2]=e[6];t[3]=e[1];t[4]=e[4];t[5]=e[7];t[6]=e[2];t[7]=e[5];t[8]=e[8];return this},fromArray:function(t){this.elements.set(t);return this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},clone:function(){return(new t.Matrix3).fromArray(this.elements)}};t.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&t.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};t.Matrix4.prototype={constructor:t.Matrix4,set:function(t,e,r,i,n,o,a,s,h,l,c,u,f,p,d,m){var g=this.elements;g[0]=t;g[4]=e;g[8]=r;g[12]=i;g[1]=n;g[5]=o;g[9]=a;g[13]=s;g[2]=h;g[6]=l;g[10]=c;g[14]=u;g[3]=f;g[7]=p;g[11]=d;g[15]=m;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(t){this.elements.set(t.elements);return this},extractPosition:function(e){t.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(e)},copyPosition:function(t){var e=this.elements;t=t.elements;e[12]=t[12];e[13]=t[13];e[14]=t[14];return this},extractBasis:function(t,e,r){var i=this.elements;t.set(i[0],i[1],i[2]);e.set(i[4],i[5],i[6]);r.set(i[8],i[9],i[10]);return this},makeBasis:function(t,e,r){this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1);return this},extractRotation:function(){var e=new t.Vector3;return function(t){var r=this.elements;t=t.elements;var i=1/e.set(t[0],t[1],t[2]).length(),n=1/e.set(t[4],t[5],t[6]).length(),o=1/e.set(t[8],t[9],t[10]).length();r[0]=t[0]*i;r[1]=t[1]*i;r[2]=t[2]*i;r[4]=t[4]*n;r[5]=t[5]*n;r[6]=t[6]*n;r[8]=t[8]*o;r[9]=t[9]*o;r[10]=t[10]*o;return this}}(),makeRotationFromEuler:function(e){!1===e instanceof t.Euler&&t.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=this.elements,i=e.x,n=e.y,o=e.z,a=Math.cos(i),i=Math.sin(i),s=Math.cos(n),n=Math.sin(n),h=Math.cos(o),o=Math.sin(o);if("XYZ"===e.order){e=a*h;var l=a*o,c=i*h,u=i*o;r[0]=s*h;r[4]=-s*o;r[8]=n;r[1]=l+c*n;r[5]=e-u*n;r[9]=-i*s;r[2]=u-e*n;r[6]=c+l*n;r[10]=a*s}else"YXZ"===e.order?(e=s*h,l=s*o,c=n*h,u=n*o,r[0]=e+u*i,r[4]=c*i-l,r[8]=a*n,r[1]=a*o,r[5]=a*h,r[9]=-i,r[2]=l*i-c,r[6]=u+e*i,r[10]=a*s):"ZXY"===e.order?(e=s*h,l=s*o,c=n*h,u=n*o,r[0]=e-u*i,r[4]=-a*o,r[8]=c+l*i,r[1]=l+c*i,r[5]=a*h,r[9]=u-e*i,r[2]=-a*n,r[6]=i,r[10]=a*s):"ZYX"===e.order?(e=a*h,l=a*o,c=i*h,u=i*o,r[0]=s*h,r[4]=c*n-l,r[8]=e*n+u,r[1]=s*o,r[5]=u*n+e,r[9]=l*n-c,r[2]=-n,r[6]=i*s,r[10]=a*s):"YZX"===e.order?(e=a*s,l=a*n,c=i*s,u=i*n,r[0]=s*h,r[4]=u-e*o,r[8]=c*o+l,r[1]=o,r[5]=a*h,r[9]=-i*h,r[2]=-n*h,r[6]=l*o+c,r[10]=e-u*o):"XZY"===e.order&&(e=a*s,l=a*n,c=i*s,u=i*n,r[0]=s*h,r[4]=-o,r[8]=n*h,r[1]=e*o+u,r[5]=a*h,r[9]=l*o-c,r[2]=c*o-l,r[6]=i*h,r[10]=u*o+e);r[3]=0;r[7]=0;r[11]=0;r[12]=0;r[13]=0;r[14]=0;r[15]=1;return this},setRotationFromQuaternion:function(e){t.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(t){var e=this.elements,r=t.x,i=t.y,n=t.z,o=t.w,a=r+r,s=i+i,h=n+n;t=r*a;var l=r*s,r=r*h,c=i*s,i=i*h,n=n*h,a=o*a,s=o*s,o=o*h;e[0]=1-(c+n);e[4]=l-o;e[8]=r+s;e[1]=l+o;e[5]=1-(t+n);e[9]=i-a;e[2]=r-s;e[6]=i+a;e[10]=1-(t+c);e[3]=0;e[7]=0;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return this},lookAt:function(){var e=new t.Vector3,r=new t.Vector3,i=new t.Vector3;return function(t,n,o){var a=this.elements;i.subVectors(t,n).normalize();0===i.length()&&(i.z=1);e.crossVectors(o,i).normalize();0===e.length()&&(i.x+=1e-4,e.crossVectors(o,i).normalize());r.crossVectors(i,e);a[0]=e.x;a[4]=r.x;a[8]=i.x;a[1]=e.y;a[5]=r.y;a[9]=i.y;a[2]=e.z;a[6]=r.z;a[10]=i.z;return this}}(),multiply:function(e,r){return void 0!==r?(t.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,r)):this.multiplyMatrices(this,e)},multiplyMatrices:function(t,e){var r=t.elements,i=e.elements,n=this.elements,o=r[0],a=r[4],s=r[8],h=r[12],l=r[1],c=r[5],u=r[9],f=r[13],p=r[2],d=r[6],m=r[10],g=r[14],y=r[3],v=r[7],x=r[11],r=r[15],b=i[0],_=i[4],w=i[8],M=i[12],S=i[1],T=i[5],E=i[9],A=i[13],C=i[2],L=i[6],P=i[10],R=i[14],F=i[3],U=i[7],B=i[11],i=i[15];n[0]=o*b+a*S+s*C+h*F;n[4]=o*_+a*T+s*L+h*U;n[8]=o*w+a*E+s*P+h*B;n[12]=o*M+a*A+s*R+h*i;n[1]=l*b+c*S+u*C+f*F;n[5]=l*_+c*T+u*L+f*U;n[9]=l*w+c*E+u*P+f*B;n[13]=l*M+c*A+u*R+f*i;n[2]=p*b+d*S+m*C+g*F;n[6]=p*_+d*T+m*L+g*U;n[10]=p*w+d*E+m*P+g*B;n[14]=p*M+d*A+m*R+g*i;n[3]=y*b+v*S+x*C+r*F;n[7]=y*_+v*T+x*L+r*U;n[11]=y*w+v*E+x*P+r*B;n[15]=y*M+v*A+x*R+r*i;return this},multiplyToArray:function(t,e,r){var i=this.elements;this.multiplyMatrices(t,e);r[0]=i[0];r[1]=i[1];r[2]=i[2];r[3]=i[3];r[4]=i[4];r[5]=i[5];r[6]=i[6];r[7]=i[7];r[8]=i[8];r[9]=i[9];r[10]=i[10];r[11]=i[11];r[12]=i[12];r[13]=i[13];r[14]=i[14];r[15]=i[15];return this},multiplyScalar:function(t){var e=this.elements;e[0]*=t;e[4]*=t;e[8]*=t;e[12]*=t;e[1]*=t;e[5]*=t;e[9]*=t;e[13]*=t;e[2]*=t;e[6]*=t;e[10]*=t;e[14]*=t;e[3]*=t;e[7]*=t;e[11]*=t;e[15]*=t;return this},multiplyVector3:function(e){t.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return e.applyProjection(this)},multiplyVector4:function(e){t.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},multiplyVector3Array:function(e){t.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new t.Vector3;return function(t,r,i){void 0===r&&(r=0);void 0===i&&(i=t.length);for(var n=0;n<i;n+=3,r+=3)e.x=t[r],e.y=t[r+1],e.z=t[r+2],e.applyMatrix4(this),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z;return t}}(),rotateAxis:function(e){t.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");e.transformDirection(this)},crossVector:function(e){t.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},determinant:function(){var t=this.elements,e=t[0],r=t[4],i=t[8],n=t[12],o=t[1],a=t[5],s=t[9],h=t[13],l=t[2],c=t[6],u=t[10],f=t[14];return t[3]*(+n*s*c-i*h*c-n*a*u+r*h*u+i*a*f-r*s*f)+t[7]*(+e*s*f-e*h*u+n*o*u-i*o*f+i*h*l-n*s*l)+t[11]*(+e*h*c-e*a*f-n*o*c+r*o*f+n*a*l-r*h*l)+t[15]*(-i*a*l-e*s*c+e*a*u+i*o*c-r*o*u+r*s*l)},transpose:function(){var t=this.elements,e;e=t[1];t[1]=t[4];t[4]=e;e=t[2];t[2]=t[8];t[8]=e;e=t[6];t[6]=t[9];t[9]=e;e=t[3];t[3]=t[12];t[12]=e;e=t[7];t[7]=t[13];t[13]=e;e=t[11];t[11]=t[14];t[14]=e;return this},flattenToArrayOffset:function(t,e){var r=this.elements;t[e]=r[0];t[e+1]=r[1];t[e+2]=r[2];t[e+3]=r[3];t[e+4]=r[4];t[e+5]=r[5];t[e+6]=r[6];t[e+7]=r[7];t[e+8]=r[8];t[e+9]=r[9];t[e+10]=r[10];t[e+11]=r[11];t[e+12]=r[12];t[e+13]=r[13];t[e+14]=r[14];t[e+15]=r[15];return t},getPosition:function(){var e=new t.Vector3;return function(){t.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var r=this.elements;return e.set(r[12],r[13],r[14])}}(),setPosition:function(t){var e=this.elements;e[12]=t.x;e[13]=t.y;e[14]=t.z;return this},getInverse:function(e,r){var i=this.elements,n=e.elements,o=n[0],a=n[4],s=n[8],h=n[12],l=n[1],c=n[5],u=n[9],f=n[13],p=n[2],d=n[6],m=n[10],g=n[14],y=n[3],v=n[7],x=n[11],n=n[15];i[0]=u*g*v-f*m*v+f*d*x-c*g*x-u*d*n+c*m*n;i[4]=h*m*v-s*g*v-h*d*x+a*g*x+s*d*n-a*m*n;i[8]=s*f*v-h*u*v+h*c*x-a*f*x-s*c*n+a*u*n;i[12]=h*u*d-s*f*d-h*c*m+a*f*m+s*c*g-a*u*g;i[1]=f*m*y-u*g*y-f*p*x+l*g*x+u*p*n-l*m*n;i[5]=s*g*y-h*m*y+h*p*x-o*g*x-s*p*n+o*m*n;i[9]=h*u*y-s*f*y-h*l*x+o*f*x+s*l*n-o*u*n;i[13]=s*f*p-h*u*p+h*l*m-o*f*m-s*l*g+o*u*g;i[2]=c*g*y-f*d*y+f*p*v-l*g*v-c*p*n+l*d*n;i[6]=h*d*y-a*g*y-h*p*v+o*g*v+a*p*n-o*d*n;i[10]=a*f*y-h*c*y+h*l*v-o*f*v-a*l*n+o*c*n;i[14]=h*c*p-a*f*p-h*l*d+o*f*d+a*l*g-o*c*g;i[3]=u*d*y-c*m*y-u*p*v+l*m*v+c*p*x-l*d*x;i[7]=a*m*y-s*d*y+s*p*v-o*m*v-a*p*x+o*d*x;i[11]=s*c*y-a*u*y-s*l*v+o*u*v+a*l*x-o*c*x;i[15]=a*u*p-s*c*p+s*l*d-o*u*d-a*l*m+o*c*m;i=o*i[0]+l*i[4]+p*i[8]+y*i[12];if(0==i){if(r)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");t.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/i);return this},translate:function(e){t.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){t.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){t.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){t.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,r){t.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(t){var e=this.elements,r=t.x,i=t.y;t=t.z;e[0]*=r;e[4]*=i;e[8]*=t;e[1]*=r;e[5]*=i;e[9]*=t;e[2]*=r;e[6]*=i;e[10]*=t;e[3]*=r;e[7]*=i;e[11]*=t;return this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],Math.max(t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10])))},makeTranslation:function(t,e,r){this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1);return this},makeRotationX:function(t){var e=Math.cos(t);t=Math.sin(t);this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1);return this},makeRotationY:function(t){var e=Math.cos(t);t=Math.sin(t);this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1);return this},makeRotationZ:function(t){var e=Math.cos(t);t=Math.sin(t);this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(t,e){var r=Math.cos(e),i=Math.sin(e),n=1-r,o=t.x,a=t.y,s=t.z,h=n*o,l=n*a;this.set(h*o+r,h*a-i*s,h*s+i*a,0,h*a+i*s,l*a+r,l*s-i*o,0,h*s-i*a,l*s+i*o,n*s*s+r,0,0,0,0,1);return this},makeScale:function(t,e,r){this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1);return this},compose:function(t,e,r){this.makeRotationFromQuaternion(e);this.scale(r);this.setPosition(t);return this},decompose:function(){var e=new t.Vector3,r=new t.Matrix4;return function(t,i,n){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),h=e.set(o[8],o[9],o[10]).length();0>this.determinant()&&(a=-a);t.x=o[12];t.y=o[13];t.z=o[14];r.elements.set(this.elements);t=1/a;var o=1/s,l=1/h;r.elements[0]*=t;r.elements[1]*=t;r.elements[2]*=t;r.elements[4]*=o;r.elements[5]*=o;r.elements[6]*=o;r.elements[8]*=l;r.elements[9]*=l;r.elements[10]*=l;i.setFromRotationMatrix(r);n.x=a;n.y=s;n.z=h;return this}}(),makeFrustum:function(t,e,r,i,n,o){var a=this.elements;a[0]=2*n/(e-t);a[4]=0;a[8]=(e+t)/(e-t);a[12]=0;a[1]=0;a[5]=2*n/(i-r);a[9]=(i+r)/(i-r);a[13]=0;a[2]=0;a[6]=0;a[10]=-(o+n)/(o-n);a[14]=-2*o*n/(o-n);a[3]=0;a[7]=0;a[11]=-1;a[15]=0;return this},makePerspective:function(e,r,i,n){e=i*Math.tan(t.Math.degToRad(.5*e));var o=-e;return this.makeFrustum(o*r,e*r,o,e,i,n)},makeOrthographic:function(t,e,r,i,n,o){var a=this.elements,s=e-t,h=r-i,l=o-n;a[0]=2/s;a[4]=0;a[8]=0;a[12]=-((e+t)/s);a[1]=0;a[5]=2/h;a[9]=0;a[13]=-((r+i)/h);a[2]=0;a[6]=0;a[10]=-2/l;a[14]=-((o+n)/l);a[3]=0;a[7]=0;a[11]=0;a[15]=1;return this},fromArray:function(t){this.elements.set(t);return this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]},clone:function(){return(new t.Matrix4).fromArray(this.elements)}};t.Ray=function(e,r){this.origin=void 0!==e?e:new t.Vector3;this.direction=void 0!==r?r:new t.Vector3};t.Ray.prototype={constructor:t.Ray,set:function(t,e){this.origin.copy(t);this.direction.copy(e);return this},copy:function(t){this.origin.copy(t.origin);this.direction.copy(t.direction);return this},at:function(e,r){return(r||new t.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new t.Vector3;return function(t){this.origin.copy(this.at(t,e));return this}}(),closestPointToPoint:function(e,r){var i=r||new t.Vector3;i.subVectors(e,this.origin);var n=i.dot(this.direction);return 0>n?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(){var e=new t.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);if(0>r)return this.origin.distanceTo(t);e.copy(this.direction).multiplyScalar(r).add(this.origin);return e.distanceTo(t)}}(),distanceSqToSegment:function(){var e=new t.Vector3,r=new t.Vector3,i=new t.Vector3;return function(t,n,o,a){e.copy(t).add(n).multiplyScalar(.5);r.copy(n).sub(t).normalize();i.copy(this.origin).sub(e);var s=.5*t.distanceTo(n),h=-this.direction.dot(r),l=i.dot(this.direction),c=-i.dot(r),u=i.lengthSq(),f=Math.abs(1-h*h),p;0<f?(t=h*c-l,n=h*l-c,p=s*f,0<=t?n>=-p?n<=p?(s=1/f,t*=s,n*=s,h=t*(t+h*n+2*l)+n*(h*t+n+2*c)+u):(n=s,t=Math.max(0,-(h*n+l)),h=-t*t+n*(n+2*c)+u):(n=-s,t=Math.max(0,-(h*n+l)),h=-t*t+n*(n+2*c)+u):n<=-p?(t=Math.max(0,-(-h*s+l)),n=0<t?-s:Math.min(Math.max(-s,-c),s),h=-t*t+n*(n+2*c)+u):n<=p?(t=0,n=Math.min(Math.max(-s,-c),s),h=n*(n+2*c)+u):(t=Math.max(0,-(h*s+l)),n=0<t?s:Math.min(Math.max(-s,-c),s),h=-t*t+n*(n+2*c)+u)):(n=0<h?-s:s,t=Math.max(0,-(h*n+l)),h=-t*t+n*(n+2*c)+u);o&&o.copy(this.direction).multiplyScalar(t).add(this.origin);a&&a.copy(r).multiplyScalar(n).add(e);return h}}(),isIntersectionSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},intersectSphere:function(){var e=new t.Vector3;return function(t,r){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),n=e.dot(e)-i*i,o=t.radius*t.radius;if(n>o)return null;o=Math.sqrt(o-n);n=i-o;i+=o;return 0>n&&0>i?null:0>n?this.at(i,r):this.at(n,r)}}(),isIntersectionPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||0>t.normal.dot(this.direction)*e?!0:!1},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0==e)return 0==t.distanceToPoint(this.origin)?0:null;t=-(this.origin.dot(t.normal)+t.constant)/e;return 0<=t?t:null},intersectPlane:function(t,e){var r=this.distanceToPlane(t);return null===r?null:this.at(r,e)},isIntersectionBox:function(){var e=new t.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(t,e){var r,i,n,o,a;i=1/this.direction.x;o=1/this.direction.y;a=1/this.direction.z;var s=this.origin;0<=i?(r=(t.min.x-s.x)*i,i*=t.max.x-s.x):(r=(t.max.x-s.x)*i,i*=t.min.x-s.x);0<=o?(n=(t.min.y-s.y)*o,o*=t.max.y-s.y):(n=(t.max.y-s.y)*o,o*=t.min.y-s.y);if(r>o||n>i)return null;if(n>r||r!==r)r=n;if(o<i||i!==i)i=o;0<=a?(n=(t.min.z-s.z)*a,a*=t.max.z-s.z):(n=(t.max.z-s.z)*a,a*=t.min.z-s.z);if(r>a||n>i)return null;if(n>r||r!==r)r=n;if(a<i||i!==i)i=a;return 0>i?null:this.at(0<=r?r:i,e)},intersectTriangle:function(){var e=new t.Vector3,r=new t.Vector3,i=new t.Vector3,n=new t.Vector3;return function(t,o,a,s,h){r.subVectors(o,t);i.subVectors(a,t);n.crossVectors(r,i);o=this.direction.dot(n);if(0<o){if(s)return null;s=1}else if(0>o)s=-1,o=-o;else return null;e.subVectors(this.origin,t);t=s*this.direction.dot(i.crossVectors(e,i));if(0>t)return null;a=s*this.direction.dot(r.cross(e));if(0>a||t+a>o)return null;t=-s*e.dot(n);return 0>t?null:this.at(t/o,h)}}(),applyMatrix4:function(t){this.direction.add(this.origin).applyMatrix4(t);this.origin.applyMatrix4(t);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)},clone:function(){return(new t.Ray).copy(this)}};t.Sphere=function(e,r){this.center=void 0!==e?e:new t.Vector3;this.radius=void 0!==r?r:0};t.Sphere.prototype={constructor:t.Sphere,set:function(t,e){this.center.copy(t);this.radius=e;return this},setFromPoints:function(){var e=new t.Box3;return function(t,r){var i=this.center;void 0!==r?i.copy(r):e.setFromPoints(t).center(i);for(var n=0,o=0,a=t.length;o<a;o++)n=Math.max(n,i.distanceToSquared(t[o]));this.radius=Math.sqrt(n);return this}}(),copy:function(t){this.center.copy(t.center);this.radius=t.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},clampPoint:function(e,r){var i=this.center.distanceToSquared(e),n=r||new t.Vector3;n.copy(e);i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center));return n},getBoundingBox:function(e){e=e||new t.Box3;e.set(this.center,this.center);e.expandByScalar(this.radius);return e},applyMatrix4:function(t){this.center.applyMatrix4(t);this.radius*=t.getMaxScaleOnAxis();return this},translate:function(t){this.center.add(t);return this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius},clone:function(){return(new t.Sphere).copy(this)}};t.Frustum=function(e,r,i,n,o,a){this.planes=[void 0!==e?e:new t.Plane,void 0!==r?r:new t.Plane,void 0!==i?i:new t.Plane,void 0!==n?n:new t.Plane,void 0!==o?o:new t.Plane,void 0!==a?a:new t.Plane]};t.Frustum.prototype={constructor:t.Frustum,set:function(t,e,r,i,n,o){var a=this.planes;a[0].copy(t);a[1].copy(e);a[2].copy(r);a[3].copy(i);a[4].copy(n);a[5].copy(o);return this},copy:function(t){for(var e=this.planes,r=0;6>r;r++)e[r].copy(t.planes[r]);return this},setFromMatrix:function(t){var e=this.planes,r=t.elements;t=r[0];var i=r[1],n=r[2],o=r[3],a=r[4],s=r[5],h=r[6],l=r[7],c=r[8],u=r[9],f=r[10],p=r[11],d=r[12],m=r[13],g=r[14],r=r[15];e[0].setComponents(o-t,l-a,p-c,r-d).normalize();e[1].setComponents(o+t,l+a,p+c,r+d).normalize();e[2].setComponents(o+i,l+s,p+u,r+m).normalize();e[3].setComponents(o-i,l-s,p-u,r-m).normalize();e[4].setComponents(o-n,l-h,p-f,r-g).normalize();e[5].setComponents(o+n,l+h,p+f,r+g).normalize();return this},intersectsObject:function(){var e=new t.Sphere;return function(t){var r=t.geometry;null===r.boundingSphere&&r.computeBoundingSphere();e.copy(r.boundingSphere);e.applyMatrix4(t.matrixWorld);return this.intersectsSphere(e)}}(),intersectsSphere:function(t){var e=this.planes,r=t.center;t=-t.radius;for(var i=0;6>i;i++)if(e[i].distanceToPoint(r)<t)return!1;return!0},intersectsBox:function(){var e=new t.Vector3,r=new t.Vector3;return function(t){for(var i=this.planes,n=0;6>n;n++){var o=i[n];e.x=0<o.normal.x?t.min.x:t.max.x;r.x=0<o.normal.x?t.max.x:t.min.x;e.y=0<o.normal.y?t.min.y:t.max.y;r.y=0<o.normal.y?t.max.y:t.min.y;e.z=0<o.normal.z?t.min.z:t.max.z;r.z=0<o.normal.z?t.max.z:t.min.z;var a=o.distanceToPoint(e),o=o.distanceToPoint(r);if(0>a&&0>o)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,r=0;6>r;r++)if(0>e[r].distanceToPoint(t))return!1;return!0},clone:function(){return(new t.Frustum).copy(this)}};t.Plane=function(e,r){this.normal=void 0!==e?e:new t.Vector3(1,0,0);this.constant=void 0!==r?r:0};t.Plane.prototype={constructor:t.Plane,set:function(t,e){this.normal.copy(t);this.constant=e;return this},setComponents:function(t,e,r,i){this.normal.set(t,e,r);this.constant=i;return this},setFromNormalAndCoplanarPoint:function(t,e){this.normal.copy(t);this.constant=-e.dot(this.normal);return this},setFromCoplanarPoints:function(){var e=new t.Vector3,r=new t.Vector3;return function(t,i,n){i=e.subVectors(n,i).cross(r.subVectors(t,i)).normalize();this.setFromNormalAndCoplanarPoint(i,t);return this}}(),copy:function(t){this.normal.copy(t.normal);this.constant=t.constant;return this},normalize:function(){var t=1/this.normal.length();this.normal.multiplyScalar(t);this.constant*=t;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(e,r){var i=this.distanceToPoint(e);return(r||new t.Vector3).copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(t){var e=this.distanceToPoint(t.start);t=this.distanceToPoint(t.end);return 0>e&&0<t||0>t&&0<e},intersectLine:function(){var e=new t.Vector3;return function(r,i){var n=i||new t.Vector3,o=r.delta(e),a=this.normal.dot(o);
if(0==a){if(0==this.distanceToPoint(r.start))return n.copy(r.start)}else return a=-(r.start.dot(this.normal)+this.constant)/a,0>a||1<a?void 0:n.copy(o).multiplyScalar(a).add(r.start)}}(),coplanarPoint:function(e){return(e||new t.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new t.Vector3,r=new t.Vector3,i=new t.Matrix3;return function(t,n){var o=n||i.getNormalMatrix(t),o=e.copy(this.normal).applyMatrix3(o),a=this.coplanarPoint(r);a.applyMatrix4(t);this.setFromNormalAndCoplanarPoint(o,a);return this}}(),translate:function(t){this.constant-=t.dot(this.normal);return this},equals:function(t){return t.normal.equals(this.normal)&&t.constant==this.constant},clone:function(){return(new t.Plane).copy(this)}};t.Math={generateUUID:function(){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=Array(36),r=0,i;return function(){for(var n=0;36>n;n++)8==n||13==n||18==n||23==n?e[n]="-":14==n?e[n]="4":(2>=r&&(r=33554432+16777216*Math.random()|0),i=r&15,r>>=4,e[n]=t[19==n?i&3|8:i]);return e.join("")}}(),clamp:function(t,e,r){return t<e?e:t>r?r:t},clampBottom:function(t,e){return t<e?e:t},mapLinear:function(t,e,r,i,n){return i+(t-e)*(n-i)/(r-e)},smoothstep:function(t,e,r){if(t<=e)return 0;if(t>=r)return 1;t=(t-e)/(r-e);return t*t*(3-2*t)},smootherstep:function(t,e,r){if(t<=e)return 0;if(t>=r)return 1;t=(t-e)/(r-e);return t*t*t*(t*(6*t-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(t,e){return Math.floor(this.randFloat(t,e))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(){var t=Math.PI/180;return function(e){return e*t}}(),radToDeg:function(){var t=180/Math.PI;return function(e){return e*t}}(),isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},nextPowerOfTwo:function(t){t--;t|=t>>1;t|=t>>2;t|=t>>4;t|=t>>8;t|=t>>16;t++;return t}};t.Spline=function(e){function r(t,e,r,i,n,o,a){t=.5*(r-t);i=.5*(i-e);return(2*(e-r)+t+i)*a+(-3*(e-r)-2*t-i)*o+t*n+e}this.points=e;var i=[],n={x:0,y:0,z:0},o,a,s,h,l,c,u,f,p;this.initFromArray=function(t){this.points=[];for(var e=0;e<t.length;e++)this.points[e]={x:t[e][0],y:t[e][1],z:t[e][2]}};this.getPoint=function(t){o=(this.points.length-1)*t;a=Math.floor(o);s=o-a;i[0]=0===a?a:a-1;i[1]=a;i[2]=a>this.points.length-2?this.points.length-1:a+1;i[3]=a>this.points.length-3?this.points.length-1:a+2;c=this.points[i[0]];u=this.points[i[1]];f=this.points[i[2]];p=this.points[i[3]];h=s*s;l=s*h;n.x=r(c.x,u.x,f.x,p.x,s,h,l);n.y=r(c.y,u.y,f.y,p.y,s,h,l);n.z=r(c.z,u.z,f.z,p.z,s,h,l);return n};this.getControlPointsArray=function(){var t,e,r=this.points.length,i=[];for(t=0;t<r;t++)e=this.points[t],i[t]=[e.x,e.y,e.z];return i};this.getLength=function(e){var r,i,n,o=r=r=0,a=new t.Vector3,s=new t.Vector3,h=[],l=0;h[0]=0;e||(e=100);i=this.points.length*e;a.copy(this.points[0]);for(e=1;e<i;e++)r=e/i,n=this.getPoint(r),s.copy(n),l+=s.distanceTo(a),a.copy(n),r*=this.points.length-1,r=Math.floor(r),r!=o&&(h[r]=l,o=r);h[h.length]=l;return{chunks:h,total:l}};this.reparametrizeByArcLength=function(e){var r,i,n,o,a,s,h=[],l=new t.Vector3,c=this.getLength();h.push(l.copy(this.points[0]).clone());for(r=1;r<this.points.length;r++){i=c.chunks[r]-c.chunks[r-1];s=Math.ceil(e*i/c.total);o=(r-1)/(this.points.length-1);a=r/(this.points.length-1);for(i=1;i<s-1;i++)n=o+1/s*i*(a-o),n=this.getPoint(n),h.push(l.copy(n).clone());h.push(l.copy(this.points[r]).clone())}this.points=h}};t.Triangle=function(e,r,i){this.a=void 0!==e?e:new t.Vector3;this.b=void 0!==r?r:new t.Vector3;this.c=void 0!==i?i:new t.Vector3};t.Triangle.normal=function(){var e=new t.Vector3;return function(r,i,n,o){o=o||new t.Vector3;o.subVectors(n,i);e.subVectors(r,i);o.cross(e);r=o.lengthSq();return 0<r?o.multiplyScalar(1/Math.sqrt(r)):o.set(0,0,0)}}();t.Triangle.barycoordFromPoint=function(){var e=new t.Vector3,r=new t.Vector3,i=new t.Vector3;return function(n,o,a,s,h){e.subVectors(s,o);r.subVectors(a,o);i.subVectors(n,o);n=e.dot(e);o=e.dot(r);a=e.dot(i);var l=r.dot(r);s=r.dot(i);var c=n*l-o*o;h=h||new t.Vector3;if(0==c)return h.set(-2,-1,-1);c=1/c;l=(l*a-o*s)*c;n=(n*s-o*a)*c;return h.set(1-l-n,n,l)}}();t.Triangle.containsPoint=function(){var e=new t.Vector3;return function(r,i,n,o){r=t.Triangle.barycoordFromPoint(r,i,n,o,e);return 0<=r.x&&0<=r.y&&1>=r.x+r.y}}();t.Triangle.prototype={constructor:t.Triangle,set:function(t,e,r){this.a.copy(t);this.b.copy(e);this.c.copy(r);return this},setFromPointsAndIndices:function(t,e,r,i){this.a.copy(t[e]);this.b.copy(t[r]);this.c.copy(t[i]);return this},copy:function(t){this.a.copy(t.a);this.b.copy(t.b);this.c.copy(t.c);return this},area:function(){var e=new t.Vector3,r=new t.Vector3;return function(){e.subVectors(this.c,this.b);r.subVectors(this.a,this.b);return.5*e.cross(r).length()}}(),midpoint:function(e){return(e||new t.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return t.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new t.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,r){return t.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,r)},containsPoint:function(e){return t.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)},clone:function(){return(new t.Triangle).copy(this)}};t.Clock=function(t){this.autoStart=void 0!==t?t:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};t.Clock.prototype={constructor:t.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var t=0;this.autoStart&&!this.running&&this.start();if(this.running){var e=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),t=.001*(e-this.oldTime);this.oldTime=e;this.elapsedTime+=t}return t}};t.EventDispatcher=function(){};t.EventDispatcher.prototype={constructor:t.EventDispatcher,apply:function(e){e.addEventListener=t.EventDispatcher.prototype.addEventListener;e.hasEventListener=t.EventDispatcher.prototype.hasEventListener;e.removeEventListener=t.EventDispatcher.prototype.removeEventListener;e.dispatchEvent=t.EventDispatcher.prototype.dispatchEvent},addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]);-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)?!0:!1},removeEventListener:function(t,e){if(void 0!==this._listeners){var r=this._listeners[t];if(void 0!==r){var i=r.indexOf(e);-1!==i&&r.splice(i,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var r=[],i=e.length,n=0;n<i;n++)r[n]=e[n];for(n=0;n<i;n++)r[n].call(this,t)}}}};(function(t){t.Raycaster=function(e,r,i,n){this.ray=new t.Ray(e,r);this.near=i||0;this.far=n||Infinity;this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var e=function(t,e){return t.distance-e.distance},r=function(t,e,i,n){t.raycast(e,i);if(!0===n){t=t.children;n=0;for(var o=t.length;n<o;n++)r(t[n],e,i,!0)}};t.Raycaster.prototype={constructor:t.Raycaster,precision:1e-4,linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(e,r){r instanceof t.PerspectiveCamera?(this.ray.origin.copy(r.position),this.ray.direction.set(e.x,e.y,.5).unproject(r).sub(r.position).normalize()):r instanceof t.OrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(r),this.ray.direction.set(0,0,-1).transformDirection(r.matrixWorld)):t.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,i){var n=[];r(t,this,n,i);n.sort(e);return n},intersectObjects:function(i,n){var o=[];if(!1===i instanceof Array)return t.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),o;for(var a=0,s=i.length;a<s;a++)r(i[a],this,o,n);o.sort(e);return o}}})(t);t.Object3D=function(){Object.defineProperty(this,"id",{value:t.Object3DIdCount++});this.uuid=t.Math.generateUUID();this.name="";this.type="Object3D";this.parent=void 0;this.children=[];this.up=t.Object3D.DefaultUp.clone();var e=new t.Vector3,r=new t.Euler,i=new t.Quaternion,n=new t.Vector3(1,1,1);r.onChange(function(){i.setFromEuler(r,!1)});i.onChange(function(){r.setFromQuaternion(i,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:r},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:n}});this.rotationAutoUpdate=!0;this.matrix=new t.Matrix4;this.matrixWorld=new t.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}};t.Object3D.DefaultUp=new t.Vector3(0,1,0);t.Object3D.prototype={constructor:t.Object3D,get eulerOrder(){t.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");return this.rotation.order},set eulerOrder(e){t.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");this.rotation.order=e},get useQuaternion(){t.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){t.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var e=new t.Quaternion;return function(t,r){e.setFromAxisAngle(t,r);this.quaternion.multiply(e);return this}}(),rotateX:function(){var e=new t.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new t.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new t.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new t.Vector3;return function(t,r){e.copy(t).applyQuaternion(this.quaternion);this.position.add(e.multiplyScalar(r));return this}}(),translate:function(e,r){t.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(r,e)},translateX:function(){var e=new t.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new t.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new t.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new t.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new t.Matrix4;return function(t){e.lookAt(t,this.position,this.up);this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(1<arguments.length){for(var r=0;r<arguments.length;r++)this.add(arguments[r]);return this}if(e===this)return t.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this;e instanceof t.Object3D?(void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):t.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e);return this},remove:function(t){if(1<arguments.length)for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);e=this.children.indexOf(t);-1!==e&&(t.parent=void 0,t.dispatchEvent({type:"removed"}),this.children.splice(e,1))},getChildByName:function(e){t.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(e)},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r].getObjectByProperty(t,e);if(void 0!==n)return n}},getWorldPosition:function(e){e=e||new t.Vector3;this.updateMatrixWorld(!0);return e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new t.Vector3,r=new t.Vector3;return function(i){i=i||new t.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(e,i,r);return i}}(),getWorldRotation:function(){var e=new t.Quaternion;return function(r){r=r||new t.Euler;this.getWorldQuaternion(e);return r.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new t.Vector3,r=new t.Quaternion;return function(i){i=i||new t.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(e,r,i);return i}}(),getWorldDirection:function(){var e=new t.Quaternion;return function(r){r=r||new t.Vector3;this.getWorldQuaternion(e);return r.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=0,r=this.children.length;e<r;e++)this.children[e].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=0,r=this.children.length;e<r;e++)this.children[e].traverseVisible(t)}},traverseAncestors:function(t){this.parent&&(t(this.parent),this.parent.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===t)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0;for(var e=0,r=this.children.length;e<r;e++)this.children[e].updateMatrixWorld(t)},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},r={},i={},n=function(t){void 0===e.materials&&(e.materials=[]);if(void 0===i[t.uuid]){var r=t.toJSON();delete r.metadata;i[t.uuid]=r;e.materials.push(r)}return t.uuid},o=function(i){var a={};a.uuid=i.uuid;a.type=i.type;""!==i.name&&(a.name=i.name);"{}"!==JSON.stringify(i.userData)&&(a.userData=i.userData);!0!==i.visible&&(a.visible=i.visible);if(i instanceof t.PerspectiveCamera)a.fov=i.fov,a.aspect=i.aspect,a.near=i.near,a.far=i.far;else if(i instanceof t.OrthographicCamera)a.left=i.left,a.right=i.right,a.top=i.top,a.bottom=i.bottom,a.near=i.near,a.far=i.far;else if(i instanceof t.AmbientLight)a.color=i.color.getHex();else if(i instanceof t.DirectionalLight)a.color=i.color.getHex(),a.intensity=i.intensity;else if(i instanceof t.PointLight)a.color=i.color.getHex(),a.intensity=i.intensity,a.distance=i.distance,a.decay=i.decay;else if(i instanceof t.SpotLight)a.color=i.color.getHex(),a.intensity=i.intensity,a.distance=i.distance,a.angle=i.angle,a.exponent=i.exponent,a.decay=i.decay;else if(i instanceof t.HemisphereLight)a.color=i.color.getHex(),a.groundColor=i.groundColor.getHex();else if(i instanceof t.Mesh||i instanceof t.Line||i instanceof t.PointCloud){var s=i.geometry;void 0===e.geometries&&(e.geometries=[]);if(void 0===r[s.uuid]){var h=s.toJSON();delete h.metadata;r[s.uuid]=h;e.geometries.push(h)}a.geometry=s.uuid;a.material=n(i.material);i instanceof t.Line&&(a.mode=i.mode)}else i instanceof t.Sprite&&(a.material=n(i.material));a.matrix=i.matrix.toArray();if(0<i.children.length)for(a.children=[],s=0;s<i.children.length;s++)a.children.push(o(i.children[s]));return a};e.object=o(this);return e},clone:function(e,r){void 0===e&&(e=new t.Object3D);void 0===r&&(r=!0);e.name=this.name;e.up.copy(this.up);e.position.copy(this.position);e.quaternion.copy(this.quaternion);e.scale.copy(this.scale);e.rotationAutoUpdate=this.rotationAutoUpdate;e.matrix.copy(this.matrix);e.matrixWorld.copy(this.matrixWorld);e.matrixAutoUpdate=this.matrixAutoUpdate;e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;e.visible=this.visible;e.castShadow=this.castShadow;e.receiveShadow=this.receiveShadow;e.frustumCulled=this.frustumCulled;e.userData=JSON.parse(JSON.stringify(this.userData));if(!0===r)for(var i=0;i<this.children.length;i++)e.add(this.children[i].clone());return e}};t.EventDispatcher.prototype.apply(t.Object3D.prototype);t.Object3DIdCount=0;t.Face3=function(e,r,i,n,o,a){this.a=e;this.b=r;this.c=i;this.normal=n instanceof t.Vector3?n:new t.Vector3;this.vertexNormals=n instanceof Array?n:[];this.color=o instanceof t.Color?o:new t.Color;this.vertexColors=o instanceof Array?o:[];this.vertexTangents=[];this.materialIndex=void 0!==a?a:0};t.Face3.prototype={constructor:t.Face3,clone:function(){var e=new t.Face3(this.a,this.b,this.c);e.normal.copy(this.normal);e.color.copy(this.color);e.materialIndex=this.materialIndex;for(var r=0,i=this.vertexNormals.length;r<i;r++)e.vertexNormals[r]=this.vertexNormals[r].clone();r=0;for(i=this.vertexColors.length;r<i;r++)e.vertexColors[r]=this.vertexColors[r].clone();r=0;for(i=this.vertexTangents.length;r<i;r++)e.vertexTangents[r]=this.vertexTangents[r].clone();return e}};t.Face4=function(e,r,i,n,o,a,s){t.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new t.Face3(e,r,i,o,a,s)};t.BufferAttribute=function(t,e){this.array=t;this.itemSize=e;this.needsUpdate=!1};t.BufferAttribute.prototype={constructor:t.BufferAttribute,get length(){return this.array.length},copyAt:function(t,e,r){t*=this.itemSize;r*=e.itemSize;for(var i=0,n=this.itemSize;i<n;i++)this.array[t+i]=e.array[r+i];return this},set:function(t,e){void 0===e&&(e=0);this.array.set(t,e);return this},setX:function(t,e){this.array[t*this.itemSize]=e;return this},setY:function(t,e){this.array[t*this.itemSize+1]=e;return this},setZ:function(t,e){this.array[t*this.itemSize+2]=e;return this},setXY:function(t,e,r){t*=this.itemSize;this.array[t]=e;this.array[t+1]=r;return this},setXYZ:function(t,e,r,i){t*=this.itemSize;this.array[t]=e;this.array[t+1]=r;this.array[t+2]=i;return this},setXYZW:function(t,e,r,i,n){t*=this.itemSize;this.array[t]=e;this.array[t+1]=r;this.array[t+2]=i;this.array[t+3]=n;return this},clone:function(){return new t.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};t.Int8Attribute=function(e,r){t.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new t.BufferAttribute(e,r)};t.Uint8Attribute=function(e,r){t.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new t.BufferAttribute(e,r)};t.Uint8ClampedAttribute=function(e,r){t.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new t.BufferAttribute(e,r)};t.Int16Attribute=function(e,r){t.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new t.BufferAttribute(e,r)};t.Uint16Attribute=function(e,r){t.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new t.BufferAttribute(e,r)};t.Int32Attribute=function(e,r){t.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new t.BufferAttribute(e,r)};t.Uint32Attribute=function(e,r){t.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new t.BufferAttribute(e,r)};t.Float32Attribute=function(e,r){t.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new t.BufferAttribute(e,r)};t.Float64Attribute=function(e,r){t.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new t.BufferAttribute(e,r)};t.DynamicBufferAttribute=function(e,r){t.BufferAttribute.call(this,e,r);this.updateRange={offset:0,count:-1}};t.DynamicBufferAttribute.prototype=Object.create(t.BufferAttribute.prototype);t.DynamicBufferAttribute.prototype.constructor=t.DynamicBufferAttribute;t.DynamicBufferAttribute.prototype.clone=function(){return new t.DynamicBufferAttribute(new this.array.constructor(this.array),this.itemSize)};t.BufferGeometry=function(){Object.defineProperty(this,"id",{value:t.GeometryIdCount++});this.uuid=t.Math.generateUUID();this.name="";this.type="BufferGeometry";this.attributes={};this.attributesKeys=[];this.offsets=this.drawcalls=[];this.boundingSphere=this.boundingBox=null};t.BufferGeometry.prototype={constructor:t.BufferGeometry,addAttribute:function(e,r,i){!1===r instanceof t.BufferAttribute?(t.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.attributes[e]={array:r,itemSize:i}):(this.attributes[e]=r,this.attributesKeys=Object.keys(this.attributes))},getAttribute:function(t){return this.attributes[t]},addDrawCall:function(t,e,r){this.drawcalls.push({start:t,count:e,index:void 0!==r?r:0})},applyMatrix:function(e){var r=this.attributes.position;void 0!==r&&(e.applyToVector3Array(r.array),r.needsUpdate=!0);r=this.attributes.normal;void 0!==r&&((new t.Matrix3).getNormalMatrix(e).applyToVector3Array(r.array),r.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();this.applyMatrix((new t.Matrix4).setPosition(e));return e},fromGeometry:function(e,r){r=r||{vertexColors:t.NoColors};var i=e.vertices,n=e.faces,o=e.faceVertexUvs,a=r.vertexColors,s=0<o[0].length,h=3==n[0].vertexNormals.length,l=new Float32Array(9*n.length);this.addAttribute("position",new t.BufferAttribute(l,3));var c=new Float32Array(9*n.length);this.addAttribute("normal",new t.BufferAttribute(c,3));if(a!==t.NoColors){var u=new Float32Array(9*n.length);this.addAttribute("color",new t.BufferAttribute(u,3))}if(!0===s){var f=new Float32Array(6*n.length);this.addAttribute("uv",new t.BufferAttribute(f,2))}for(var p=0,d=0,m=0;p<n.length;p++,d+=6,m+=9){var g=n[p],y=i[g.a],v=i[g.b],x=i[g.c];l[m]=y.x;l[m+1]=y.y;l[m+2]=y.z;l[m+3]=v.x;l[m+4]=v.y;l[m+5]=v.z;l[m+6]=x.x;l[m+7]=x.y;l[m+8]=x.z;!0===h?(y=g.vertexNormals[0],v=g.vertexNormals[1],x=g.vertexNormals[2],c[m]=y.x,c[m+1]=y.y,c[m+2]=y.z,c[m+3]=v.x,c[m+4]=v.y,c[m+5]=v.z,c[m+6]=x.x,c[m+7]=x.y,c[m+8]=x.z):(y=g.normal,c[m]=y.x,c[m+1]=y.y,c[m+2]=y.z,c[m+3]=y.x,c[m+4]=y.y,c[m+5]=y.z,c[m+6]=y.x,c[m+7]=y.y,c[m+8]=y.z);a===t.FaceColors?(g=g.color,u[m]=g.r,u[m+1]=g.g,u[m+2]=g.b,u[m+3]=g.r,u[m+4]=g.g,u[m+5]=g.b,u[m+6]=g.r,u[m+7]=g.g,u[m+8]=g.b):a===t.VertexColors&&(y=g.vertexColors[0],v=g.vertexColors[1],g=g.vertexColors[2],u[m]=y.r,u[m+1]=y.g,u[m+2]=y.b,u[m+3]=v.r,u[m+4]=v.g,u[m+5]=v.b,u[m+6]=g.r,u[m+7]=g.g,u[m+8]=g.b);!0===s&&(g=o[0][p][0],y=o[0][p][1],v=o[0][p][2],f[d]=g.x,f[d+1]=g.y,f[d+2]=y.x,f[d+3]=y.y,f[d+4]=v.x,f[d+5]=v.y)}this.computeBoundingSphere();return this},computeBoundingBox:function(){var e=new t.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new t.Box3);var r=this.attributes.position.array;if(r){var i=this.boundingBox;i.makeEmpty();for(var n=0,o=r.length;n<o;n+=3)e.set(r[n],r[n+1],r[n+2]),i.expandByPoint(e)}if(void 0===r||0===r.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0);(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&t.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var e=new t.Box3,r=new t.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new t.Sphere);var i=this.attributes.position.array;if(i){e.makeEmpty();for(var n=this.boundingSphere.center,o=0,a=i.length;o<a;o+=3)r.set(i[o],i[o+1],i[o+2]),e.expandByPoint(r);e.center(n);for(var s=0,o=0,a=i.length;o<a;o+=3)r.set(i[o],i[o+1],i[o+2]),s=Math.max(s,n.distanceToSquared(r));this.boundingSphere.radius=Math.sqrt(s);isNaN(this.boundingSphere.radius)&&t.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var r=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new t.BufferAttribute(new Float32Array(r.length),3));else for(var i=e.normal.array,n=0,o=i.length;n<o;n++)i[n]=0;var i=e.normal.array,a,s,h,l=new t.Vector3,c=new t.Vector3,u=new t.Vector3,f=new t.Vector3,p=new t.Vector3;if(e.index)for(var d=e.index.array,m=0<this.offsets.length?this.offsets:[{start:0,count:d.length,index:0}],g=0,y=m.length;g<y;++g){o=m[g].start;a=m[g].count;for(var v=m[g].index,n=o,o=o+a;n<o;n+=3)a=3*(v+d[n]),s=3*(v+d[n+1]),h=3*(v+d[n+2]),l.fromArray(r,a),c.fromArray(r,s),u.fromArray(r,h),f.subVectors(u,c),p.subVectors(l,c),f.cross(p),i[a]+=f.x,i[a+1]+=f.y,i[a+2]+=f.z,i[s]+=f.x,i[s+1]+=f.y,i[s+2]+=f.z,i[h]+=f.x,i[h+1]+=f.y,i[h+2]+=f.z}else for(n=0,o=r.length;n<o;n+=9)l.fromArray(r,n),c.fromArray(r,n+3),u.fromArray(r,n+6),f.subVectors(u,c),p.subVectors(l,c),f.cross(p),i[n]=f.x,i[n+1]=f.y,i[n+2]=f.z,i[n+3]=f.x,i[n+4]=f.y,i[n+5]=f.z,i[n+6]=f.x,i[n+7]=f.y,i[n+8]=f.z;this.normalizeNormals();e.normal.needsUpdate=!0}},computeTangents:function(){function e(t,e,r){f.fromArray(n,3*t);p.fromArray(n,3*e);d.fromArray(n,3*r);m.fromArray(a,2*t);g.fromArray(a,2*e);y.fromArray(a,2*r);v=p.x-f.x;x=d.x-f.x;b=p.y-f.y;_=d.y-f.y;w=p.z-f.z;M=d.z-f.z;S=g.x-m.x;T=y.x-m.x;E=g.y-m.y;A=y.y-m.y;C=1/(S*A-T*E);L.set((A*v-E*x)*C,(A*b-E*_)*C,(A*w-E*M)*C);P.set((S*x-T*v)*C,(S*_-T*b)*C,(S*M-T*w)*C);l[t].add(L);l[e].add(L);l[r].add(L);c[t].add(P);c[e].add(P);c[r].add(P)}function r(t){O.fromArray(o,3*t);I.copy(O);H=l[t];k.copy(H);k.sub(O.multiplyScalar(O.dot(H))).normalize();N.crossVectors(I,H);W=N.dot(c[t]);G=0>W?-1:1;h[4*t]=k.x;h[4*t+1]=k.y;h[4*t+2]=k.z;h[4*t+3]=G}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)t.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var i=this.attributes.index.array,n=this.attributes.position.array,o=this.attributes.normal.array,a=this.attributes.uv.array,s=n.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new t.BufferAttribute(new Float32Array(4*s),4));for(var h=this.attributes.tangent.array,l=[],c=[],u=0;u<s;u++)l[u]=new t.Vector3,c[u]=new t.Vector3;var f=new t.Vector3,p=new t.Vector3,d=new t.Vector3,m=new t.Vector2,g=new t.Vector2,y=new t.Vector2,v,x,b,_,w,M,S,T,E,A,C,L=new t.Vector3,P=new t.Vector3,R,F,U,B,D;0===this.drawcalls.length&&this.addDrawCall(0,i.length,0);var V=this.drawcalls,u=0;for(F=V.length;u<F;++u){R=V[u].start;U=V[u].count;var z=V[u].index,s=R;for(R+=U;s<R;s+=3)U=z+i[s],B=z+i[s+1],D=z+i[s+2],e(U,B,D)}var k=new t.Vector3,N=new t.Vector3,O=new t.Vector3,I=new t.Vector3,G,H,W,u=0;for(F=V.length;u<F;++u)for(R=V[u].start,U=V[u].count,z=V[u].index,s=R,R+=U;s<R;s+=3)U=z+i[s],B=z+i[s+1],D=z+i[s+2],r(U),r(B),r(D)}},computeOffsets:function(t){void 0===t&&(t=65535);for(var e=this.attributes.index.array,r=this.attributes.position.array,i=e.length/3,n=new Uint16Array(e.length),o=0,a=0,s=[{start:0,count:0,index:0}],h=s[0],l=0,c=0,u=new Int32Array(6),f=new Int32Array(r.length),p=new Int32Array(r.length),d=0;d<r.length;d++)f[d]=-1,p[d]=-1;for(r=0;r<i;r++){for(var m=c=0;3>m;m++)d=e[3*r+m],-1==f[d]?(u[2*m]=d,u[2*m+1]=-1,c++):f[d]<h.index?(u[2*m]=d,u[2*m+1]=-1,l++):(u[2*m]=d,u[2*m+1]=f[d]);if(a+c>h.index+t)for(h={start:o,count:0,index:a},s.push(h),c=0;6>c;c+=2)m=u[c+1],-1<m&&m<h.index&&(u[c+1]=-1);for(c=0;6>c;c+=2)d=u[c],m=u[c+1],-1===m&&(m=a++),f[d]=m,p[m]=d,n[o++]=m-h.index,h.count++}this.reorderBuffers(n,p,a);return this.drawcalls=this.offsets=s},merge:function(e,r){if(!1===e instanceof t.BufferGeometry)t.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);else{void 0===r&&(r=0);var i=this.attributes,n;for(n in i)if(void 0!==e.attributes[n])for(var o=i[n].array,a=e.attributes[n],s=a.array,h=0,a=a.itemSize*r;h<s.length;h++,a++)o[a]=s[h];return this}},normalizeNormals:function(){for(var t=this.attributes.normal.array,e,r,i,n=0,o=t.length;n<o;n+=3)e=t[n],r=t[n+1],i=t[n+2],e=1/Math.sqrt(e*e+r*r+i*i),t[n]*=e,t[n+1]*=e,t[n+2]*=e},reorderBuffers:function(t,e,r){var i={},n;for(n in this.attributes)"index"!=n&&(i[n]=new this.attributes[n].array.constructor(this.attributes[n].itemSize*r));for(var o=0;o<r;o++){var a=e[o];for(n in this.attributes)if("index"!=n)for(var s=this.attributes[n].array,h=this.attributes[n].itemSize,l=i[n],c=0;c<h;c++)l[o*h+c]=s[a*h+c]}this.attributes.index.array=t;for(n in this.attributes)"index"!=n&&(this.attributes[n].array=i[n],this.attributes[n].numItems=this.attributes[n].itemSize*r)},toJSON:function(){var t={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},e=this.attributes,r=this.offsets,i=this.boundingSphere,n;for(n in e){var o=e[n],a=Array.prototype.slice.call(o.array);t.data.attributes[n]={itemSize:o.itemSize,type:o.array.constructor.name,array:a}}0<r.length&&(t.data.offsets=JSON.parse(JSON.stringify(r)));null!==i&&(t.data.boundingSphere={center:i.center.toArray(),radius:i.radius});return t},clone:function(){var e=new t.BufferGeometry,r;for(r in this.attributes)e.addAttribute(r,this.attributes[r].clone());r=0;for(var i=this.offsets.length;r<i;r++){var n=this.offsets[r];e.offsets.push({start:n.start,index:n.index,count:n.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};t.EventDispatcher.prototype.apply(t.BufferGeometry.prototype);t.Geometry=function(){Object.defineProperty(this,"id",{value:t.GeometryIdCount++});this.uuid=t.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1;this.dynamic=!0;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1};t.Geometry.prototype={constructor:t.Geometry,applyMatrix:function(e){for(var r=(new t.Matrix3).getNormalMatrix(e),i=0,n=this.vertices.length;i<n;i++)this.vertices[i].applyMatrix4(e);i=0;for(n=this.faces.length;i<n;i++){e=this.faces[i];e.normal.applyMatrix3(r).normalize();for(var o=0,a=e.vertexNormals.length;o<a;o++)e.vertexNormals[o].applyMatrix3(r).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0},fromBufferGeometry:function(e){for(var r=this,i=e.attributes,n=i.position.array,o=void 0!==i.index?i.index.array:void 0,a=void 0!==i.normal?i.normal.array:void 0,s=void 0!==i.color?i.color.array:void 0,h=void 0!==i.uv?i.uv.array:void 0,l=[],c=[],u=i=0;i<n.length;i+=3,u+=2)r.vertices.push(new t.Vector3(n[i],n[i+1],n[i+2])),void 0!==a&&l.push(new t.Vector3(a[i],a[i+1],a[i+2])),void 0!==s&&r.colors.push(new t.Color(s[i],s[i+1],s[i+2])),void 0!==h&&c.push(new t.Vector2(h[u],h[u+1]));var f=function(e,i,n){var o=void 0!==a?[l[e].clone(),l[i].clone(),l[n].clone()]:[],u=void 0!==s?[r.colors[e].clone(),r.colors[i].clone(),r.colors[n].clone()]:[];r.faces.push(new t.Face3(e,i,n,o,u));void 0!==h&&r.faceVertexUvs[0].push([c[e].clone(),c[i].clone(),c[n].clone()])};if(void 0!==o)if(n=e.drawcalls,0<n.length)for(i=0;i<n.length;i++)for(var u=n[i],p=u.start,d=u.count,m=u.index,u=p,p=p+d;u<p;u+=3)f(m+o[u],m+o[u+1],m+o[u+2]);else for(i=0;i<o.length;i+=3)f(o[i],o[i+1],o[i+2]);else for(i=0;i<n.length/3;i+=3)f(i,i+1,i+2);
this.computeFaceNormals();null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone());null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();this.applyMatrix((new t.Matrix4).setPosition(e));return e},computeFaceNormals:function(){for(var e=new t.Vector3,r=new t.Vector3,i=0,n=this.faces.length;i<n;i++){var o=this.faces[i],a=this.vertices[o.a],s=this.vertices[o.b];e.subVectors(this.vertices[o.c],s);r.subVectors(a,s);e.cross(r);e.normalize();o.normal.copy(e)}},computeVertexNormals:function(e){var r,i,n;n=Array(this.vertices.length);r=0;for(i=this.vertices.length;r<i;r++)n[r]=new t.Vector3;if(e){var o,a,s,h=new t.Vector3,l=new t.Vector3;e=0;for(r=this.faces.length;e<r;e++)i=this.faces[e],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c],h.subVectors(s,a),l.subVectors(o,a),h.cross(l),n[i.a].add(h),n[i.b].add(h),n[i.c].add(h)}else for(e=0,r=this.faces.length;e<r;e++)i=this.faces[e],n[i.a].add(i.normal),n[i.b].add(i.normal),n[i.c].add(i.normal);r=0;for(i=this.vertices.length;r<i;r++)n[r].normalize();e=0;for(r=this.faces.length;e<r;e++)i=this.faces[e],i.vertexNormals[0]=n[i.a].clone(),i.vertexNormals[1]=n[i.b].clone(),i.vertexNormals[2]=n[i.c].clone()},computeMorphNormals:function(){var e,r,i,n,o;i=0;for(n=this.faces.length;i<n;i++)for(o=this.faces[i],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),e=0,r=o.vertexNormals.length;e<r;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone();var a=new t.Geometry;a.faces=this.faces;e=0;for(r=this.morphTargets.length;e<r;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];o=this.morphNormals[e].faceNormals;var s=this.morphNormals[e].vertexNormals,h,l;i=0;for(n=this.faces.length;i<n;i++)h=new t.Vector3,l={a:new t.Vector3,b:new t.Vector3,c:new t.Vector3},o.push(h),s.push(l)}s=this.morphNormals[e];a.vertices=this.morphTargets[e].vertices;a.computeFaceNormals();a.computeVertexNormals();i=0;for(n=this.faces.length;i<n;i++)o=this.faces[i],h=s.faceNormals[i],l=s.vertexNormals[i],h.copy(o.normal),l.a.copy(o.vertexNormals[0]),l.b.copy(o.vertexNormals[1]),l.c.copy(o.vertexNormals[2])}i=0;for(n=this.faces.length;i<n;i++)o=this.faces[i],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeTangents:function(){var e,r,i,n,o,a,s,h,l,c,u,f,p,d,m,g,y,v=[],x=[];i=new t.Vector3;var b=new t.Vector3,_=new t.Vector3,w=new t.Vector3,M=new t.Vector3;e=0;for(r=this.vertices.length;e<r;e++)v[e]=new t.Vector3,x[e]=new t.Vector3;e=0;for(r=this.faces.length;e<r;e++)o=this.faces[e],a=this.faceVertexUvs[0][e],n=o.a,y=o.b,o=o.c,s=this.vertices[n],h=this.vertices[y],l=this.vertices[o],c=a[0],u=a[1],f=a[2],a=h.x-s.x,p=l.x-s.x,d=h.y-s.y,m=l.y-s.y,h=h.z-s.z,s=l.z-s.z,l=u.x-c.x,g=f.x-c.x,u=u.y-c.y,c=f.y-c.y,f=1/(l*c-g*u),i.set((c*a-u*p)*f,(c*d-u*m)*f,(c*h-u*s)*f),b.set((l*p-g*a)*f,(l*m-g*d)*f,(l*s-g*h)*f),v[n].add(i),v[y].add(i),v[o].add(i),x[n].add(b),x[y].add(b),x[o].add(b);b=["a","b","c","d"];e=0;for(r=this.faces.length;e<r;e++)for(o=this.faces[e],i=0;i<Math.min(o.vertexNormals.length,3);i++)M.copy(o.vertexNormals[i]),n=o[b[i]],y=v[n],_.copy(y),_.sub(M.multiplyScalar(M.dot(y))).normalize(),w.crossVectors(o.vertexNormals[i],y),n=w.dot(x[n]),n=0>n?-1:1,o.vertexTangents[i]=new t.Vector4(_.x,_.y,_.z,n);this.hasTangents=!0},computeLineDistances:function(){for(var t=0,e=this.vertices,r=0,i=e.length;r<i;r++)0<r&&(t+=e[r].distanceTo(e[r-1])),this.lineDistances[r]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new t.Box3);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new t.Sphere);this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,r,i){if(!1===e instanceof t.Geometry)t.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);else{var n,o=this.vertices.length,a=this.vertices,s=e.vertices,h=this.faces,l=e.faces,c=this.faceVertexUvs[0];e=e.faceVertexUvs[0];void 0===i&&(i=0);void 0!==r&&(n=(new t.Matrix3).getNormalMatrix(r));for(var u=0,f=s.length;u<f;u++){var p=s[u].clone();void 0!==r&&p.applyMatrix4(r);a.push(p)}u=0;for(f=l.length;u<f;u++){var s=l[u],d,m=s.vertexNormals,g=s.vertexColors,p=new t.Face3(s.a+o,s.b+o,s.c+o);p.normal.copy(s.normal);void 0!==n&&p.normal.applyMatrix3(n).normalize();r=0;for(a=m.length;r<a;r++)d=m[r].clone(),void 0!==n&&d.applyMatrix3(n).normalize(),p.vertexNormals.push(d);p.color.copy(s.color);r=0;for(a=g.length;r<a;r++)d=g[r],p.vertexColors.push(d.clone());p.materialIndex=s.materialIndex+i;h.push(p)}u=0;for(f=e.length;u<f;u++)if(i=e[u],n=[],void 0!==i){r=0;for(a=i.length;r<a;r++)n.push(i[r].clone());c.push(n)}}},mergeMesh:function(e){!1===e instanceof t.Mesh?t.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e):(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix))},mergeVertices:function(){var t={},e=[],r=[],i,n=Math.pow(10,4),o,a;o=0;for(a=this.vertices.length;o<a;o++)i=this.vertices[o],i=Math.round(i.x*n)+"_"+Math.round(i.y*n)+"_"+Math.round(i.z*n),void 0===t[i]?(t[i]=o,e.push(this.vertices[o]),r[o]=e.length-1):r[o]=r[t[i]];t=[];o=0;for(a=this.faces.length;o<a;o++)for(n=this.faces[o],n.a=r[n.a],n.b=r[n.b],n.c=r[n.c],n=[n.a,n.b,n.c],i=0;3>i;i++)if(n[i]==n[(i+1)%3]){t.push(o);break}for(o=t.length-1;0<=o;o--)for(n=t[o],this.faces.splice(n,1),r=0,a=this.faceVertexUvs.length;r<a;r++)this.faceVertexUvs[r].splice(n,1);o=this.vertices.length-e.length;this.vertices=e;return o},toJSON:function(){function t(t,e,r){return r?t|1<<e:t&~(1<<e)}function e(t){var e=t.x.toString()+t.y.toString()+t.z.toString();if(void 0!==l[e])return l[e];l[e]=h.length/3;h.push(t.x,t.y,t.z);return l[e]}function r(t){var e=t.r.toString()+t.g.toString()+t.b.toString();if(void 0!==u[e])return u[e];u[e]=c.length;c.push(t.getHex());return u[e]}function i(t){var e=t.x.toString()+t.y.toString();if(void 0!==p[e])return p[e];p[e]=f.length/2;f.push(t.x,t.y);return p[e]}var n={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};""!==this.name&&(n.name=this.name);if(void 0!==this.parameters){var o=this.parameters,a;for(a in o)void 0!==o[a]&&(n[a]=o[a]);return n}o=[];for(a=0;a<this.vertices.length;a++){var s=this.vertices[a];o.push(s.x,s.y,s.z)}var s=[],h=[],l={},c=[],u={},f=[],p={};for(a=0;a<this.faces.length;a++){var d=this.faces[a],m=void 0!==this.faceVertexUvs[0][a],g=0<d.normal.length(),y=0<d.vertexNormals.length,v=1!==d.color.r||1!==d.color.g||1!==d.color.b,x=0<d.vertexColors.length,b=0,b=t(b,0,0),b=t(b,1,!1),b=t(b,2,!1),b=t(b,3,m),b=t(b,4,g),b=t(b,5,y),b=t(b,6,v),b=t(b,7,x);s.push(b);s.push(d.a,d.b,d.c);m&&(m=this.faceVertexUvs[0][a],s.push(i(m[0]),i(m[1]),i(m[2])));g&&s.push(e(d.normal));y&&(g=d.vertexNormals,s.push(e(g[0]),e(g[1]),e(g[2])));v&&s.push(r(d.color));x&&(d=d.vertexColors,s.push(r(d[0]),r(d[1]),r(d[2])))}n.data={};n.data.vertices=o;n.data.normals=h;0<c.length&&(n.data.colors=c);0<f.length&&(n.data.uvs=[f]);n.data.faces=s;return n},clone:function(){for(var e=new t.Geometry,r=this.vertices,i=0,n=r.length;i<n;i++)e.vertices.push(r[i].clone());r=this.faces;i=0;for(n=r.length;i<n;i++)e.faces.push(r[i].clone());i=0;for(n=this.faceVertexUvs.length;i<n;i++){r=this.faceVertexUvs[i];void 0===e.faceVertexUvs[i]&&(e.faceVertexUvs[i]=[]);for(var o=0,a=r.length;o<a;o++){for(var s=r[o],h=[],l=0,c=s.length;l<c;l++)h.push(s[l].clone());e.faceVertexUvs[i].push(h)}}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};t.EventDispatcher.prototype.apply(t.Geometry.prototype);t.GeometryIdCount=0;t.Camera=function(){t.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new t.Matrix4;this.projectionMatrix=new t.Matrix4};t.Camera.prototype=Object.create(t.Object3D.prototype);t.Camera.prototype.constructor=t.Camera;t.Camera.prototype.getWorldDirection=function(){var e=new t.Quaternion;return function(r){r=r||new t.Vector3;this.getWorldQuaternion(e);return r.set(0,0,-1).applyQuaternion(e)}}();t.Camera.prototype.lookAt=function(){var e=new t.Matrix4;return function(t){e.lookAt(this.position,t,this.up);this.quaternion.setFromRotationMatrix(e)}}();t.Camera.prototype.clone=function(e){void 0===e&&(e=new t.Camera);t.Object3D.prototype.clone.call(this,e);e.matrixWorldInverse.copy(this.matrixWorldInverse);e.projectionMatrix.copy(this.projectionMatrix);return e};t.CubeCamera=function(e,r,i){t.Object3D.call(this);this.type="CubeCamera";var n=new t.PerspectiveCamera(90,1,e,r);n.up.set(0,-1,0);n.lookAt(new t.Vector3(1,0,0));this.add(n);var o=new t.PerspectiveCamera(90,1,e,r);o.up.set(0,-1,0);o.lookAt(new t.Vector3((-1),0,0));this.add(o);var a=new t.PerspectiveCamera(90,1,e,r);a.up.set(0,0,1);a.lookAt(new t.Vector3(0,1,0));this.add(a);var s=new t.PerspectiveCamera(90,1,e,r);s.up.set(0,0,-1);s.lookAt(new t.Vector3(0,(-1),0));this.add(s);var h=new t.PerspectiveCamera(90,1,e,r);h.up.set(0,-1,0);h.lookAt(new t.Vector3(0,0,1));this.add(h);var l=new t.PerspectiveCamera(90,1,e,r);l.up.set(0,-1,0);l.lookAt(new t.Vector3(0,0,(-1)));this.add(l);this.renderTarget=new t.WebGLRenderTargetCube(i,i,{format:t.RGBFormat,magFilter:t.LinearFilter,minFilter:t.LinearFilter});this.updateCubeMap=function(t,e){var r=this.renderTarget,i=r.generateMipmaps;r.generateMipmaps=!1;r.activeCubeFace=0;t.render(e,n,r);r.activeCubeFace=1;t.render(e,o,r);r.activeCubeFace=2;t.render(e,a,r);r.activeCubeFace=3;t.render(e,s,r);r.activeCubeFace=4;t.render(e,h,r);r.generateMipmaps=i;r.activeCubeFace=5;t.render(e,l,r)}};t.CubeCamera.prototype=Object.create(t.Object3D.prototype);t.CubeCamera.prototype.constructor=t.CubeCamera;t.OrthographicCamera=function(e,r,i,n,o,a){t.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=e;this.right=r;this.top=i;this.bottom=n;this.near=void 0!==o?o:.1;this.far=void 0!==a?a:2e3;this.updateProjectionMatrix()};t.OrthographicCamera.prototype=Object.create(t.Camera.prototype);t.OrthographicCamera.prototype.constructor=t.OrthographicCamera;t.OrthographicCamera.prototype.updateProjectionMatrix=function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-t,r+t,i+e,i-e,this.near,this.far)};t.OrthographicCamera.prototype.clone=function(){var e=new t.OrthographicCamera;t.Camera.prototype.clone.call(this,e);e.zoom=this.zoom;e.left=this.left;e.right=this.right;e.top=this.top;e.bottom=this.bottom;e.near=this.near;e.far=this.far;e.projectionMatrix.copy(this.projectionMatrix);return e};t.PerspectiveCamera=function(e,r,i,n){t.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=void 0!==e?e:50;this.aspect=void 0!==r?r:1;this.near=void 0!==i?i:.1;this.far=void 0!==n?n:2e3;this.updateProjectionMatrix()};t.PerspectiveCamera.prototype=Object.create(t.Camera.prototype);t.PerspectiveCamera.prototype.constructor=t.PerspectiveCamera;t.PerspectiveCamera.prototype.setLens=function(e,r){void 0===r&&(r=24);this.fov=2*t.Math.radToDeg(Math.atan(r/(2*e)));this.updateProjectionMatrix()};t.PerspectiveCamera.prototype.setViewOffset=function(t,e,r,i,n,o){this.fullWidth=t;this.fullHeight=e;this.x=r;this.y=i;this.width=n;this.height=o;this.updateProjectionMatrix()};t.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=t.Math.radToDeg(2*Math.atan(Math.tan(.5*t.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var r=this.fullWidth/this.fullHeight,e=Math.tan(t.Math.degToRad(.5*e))*this.near,i=-e,n=r*i,r=Math.abs(r*e-n),i=Math.abs(e-i);this.projectionMatrix.makeFrustum(n+this.x*r/this.fullWidth,n+(this.x+this.width)*r/this.fullWidth,e-(this.y+this.height)*i/this.fullHeight,e-this.y*i/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)};t.PerspectiveCamera.prototype.clone=function(){var e=new t.PerspectiveCamera;t.Camera.prototype.clone.call(this,e);e.zoom=this.zoom;e.fov=this.fov;e.aspect=this.aspect;e.near=this.near;e.far=this.far;e.projectionMatrix.copy(this.projectionMatrix);return e};t.Light=function(e){t.Object3D.call(this);this.type="Light";this.color=new t.Color(e)};t.Light.prototype=Object.create(t.Object3D.prototype);t.Light.prototype.constructor=t.Light;t.Light.prototype.clone=function(e){void 0===e&&(e=new t.Light);t.Object3D.prototype.clone.call(this,e);e.color.copy(this.color);return e};t.AmbientLight=function(e){t.Light.call(this,e);this.type="AmbientLight"};t.AmbientLight.prototype=Object.create(t.Light.prototype);t.AmbientLight.prototype.constructor=t.AmbientLight;t.AmbientLight.prototype.clone=function(){var e=new t.AmbientLight;t.Light.prototype.clone.call(this,e);return e};t.AreaLight=function(e,r){t.Light.call(this,e);this.type="AreaLight";this.normal=new t.Vector3(0,(-1),0);this.right=new t.Vector3(1,0,0);this.intensity=void 0!==r?r:1;this.height=this.width=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};t.AreaLight.prototype=Object.create(t.Light.prototype);t.AreaLight.prototype.constructor=t.AreaLight;t.DirectionalLight=function(e,r){t.Light.call(this,e);this.type="DirectionalLight";this.position.set(0,1,0);this.target=new t.Object3D;this.intensity=void 0!==r?r:1;this.onlyShadow=this.castShadow=!1;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraTop=this.shadowCameraRight=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=!1;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCascade=!1;this.shadowCascadeOffset=new t.Vector3(0,0,(-1e3));this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null};t.DirectionalLight.prototype=Object.create(t.Light.prototype);t.DirectionalLight.prototype.constructor=t.DirectionalLight;t.DirectionalLight.prototype.clone=function(){var e=new t.DirectionalLight;t.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.intensity=this.intensity;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;e.shadowCameraNear=this.shadowCameraNear;e.shadowCameraFar=this.shadowCameraFar;e.shadowCameraLeft=this.shadowCameraLeft;e.shadowCameraRight=this.shadowCameraRight;e.shadowCameraTop=this.shadowCameraTop;e.shadowCameraBottom=this.shadowCameraBottom;e.shadowCameraVisible=this.shadowCameraVisible;e.shadowBias=this.shadowBias;e.shadowDarkness=this.shadowDarkness;e.shadowMapWidth=this.shadowMapWidth;e.shadowMapHeight=this.shadowMapHeight;e.shadowCascade=this.shadowCascade;e.shadowCascadeOffset.copy(this.shadowCascadeOffset);e.shadowCascadeCount=this.shadowCascadeCount;e.shadowCascadeBias=this.shadowCascadeBias.slice(0);e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0);e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0);e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0);e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0);return e};t.HemisphereLight=function(e,r,i){t.Light.call(this,e);this.type="HemisphereLight";this.position.set(0,100,0);this.groundColor=new t.Color(r);this.intensity=void 0!==i?i:1};t.HemisphereLight.prototype=Object.create(t.Light.prototype);t.HemisphereLight.prototype.constructor=t.HemisphereLight;t.HemisphereLight.prototype.clone=function(){var e=new t.HemisphereLight;t.Light.prototype.clone.call(this,e);e.groundColor.copy(this.groundColor);e.intensity=this.intensity;return e};t.PointLight=function(e,r,i,n){t.Light.call(this,e);this.type="PointLight";this.intensity=void 0!==r?r:1;this.distance=void 0!==i?i:0;this.decay=void 0!==n?n:1};t.PointLight.prototype=Object.create(t.Light.prototype);t.PointLight.prototype.constructor=t.PointLight;t.PointLight.prototype.clone=function(){var e=new t.PointLight;t.Light.prototype.clone.call(this,e);e.intensity=this.intensity;e.distance=this.distance;e.decay=this.decay;return e};t.SpotLight=function(e,r,i,n,o,a){t.Light.call(this,e);this.type="SpotLight";this.position.set(0,1,0);this.target=new t.Object3D;this.intensity=void 0!==r?r:1;this.distance=void 0!==i?i:0;this.angle=void 0!==n?n:Math.PI/3;this.exponent=void 0!==o?o:10;this.decay=void 0!==a?a:1;this.onlyShadow=this.castShadow=!1;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=!1;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null};t.SpotLight.prototype=Object.create(t.Light.prototype);t.SpotLight.prototype.constructor=t.SpotLight;t.SpotLight.prototype.clone=function(){var e=new t.SpotLight;t.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.intensity=this.intensity;e.distance=this.distance;e.angle=this.angle;e.exponent=this.exponent;e.decay=this.decay;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;e.shadowCameraNear=this.shadowCameraNear;e.shadowCameraFar=this.shadowCameraFar;e.shadowCameraFov=this.shadowCameraFov;e.shadowCameraVisible=this.shadowCameraVisible;e.shadowBias=this.shadowBias;e.shadowDarkness=this.shadowDarkness;e.shadowMapWidth=this.shadowMapWidth;e.shadowMapHeight=this.shadowMapHeight;return e};t.Cache={files:{},add:function(t,e){this.files[t]=e},get:function(t){return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};t.Loader=function(e){this.statusDomElement=(this.showStatus=e)?t.Loader.prototype.addStatusElement():null;this.imageLoader=new t.ImageLoader;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};t.Loader.prototype={constructor:t.Loader,crossOrigin:void 0,addStatusElement:function(){var t=document.createElement("div");t.style.position="absolute";t.style.right="0px";t.style.top="0px";t.style.fontSize="0.8em";t.style.textAlign="left";t.style.background="rgba(0,0,0,0.25)";t.style.color="#fff";t.style.width="120px";t.style.padding="0.5em 0.5em 0.5em 0.5em";t.style.zIndex=1e3;t.innerHTML="Loading ...";return t},updateProgress:function(t){var e="Loaded ",e=t.total?e+((100*t.loaded/t.total).toFixed(0)+"%"):e+((t.loaded/1024).toFixed(2)+" KB");this.statusDomElement.innerHTML=e},extractUrlBase:function(t){t=t.split("/");if(1===t.length)return"./";t.pop();return t.join("/")+"/"},initMaterials:function(t,e){for(var r=[],i=0;i<t.length;++i)r[i]=this.createMaterial(t[i],e);return r},needsTangents:function(e){for(var r=0,i=e.length;r<i;r++)if(e[r]instanceof t.ShaderMaterial)return!0;return!1},createMaterial:function(e,r){function i(t){t=Math.log(t)/Math.LN2;return Math.pow(2,Math.round(t))}function n(e,n,o,s,h,l,c){var u=r+o,f,p=t.Loader.Handlers.get(u);null!==p?f=p.load(u):(f=new t.Texture,p=a.imageLoader,p.crossOrigin=a.crossOrigin,p.load(u,function(e){if(!1===t.Math.isPowerOfTwo(e.width)||!1===t.Math.isPowerOfTwo(e.height)){var r=i(e.width),n=i(e.height),o=document.createElement("canvas");o.width=r;o.height=n;o.getContext("2d").drawImage(e,0,0,r,n);f.image=o}else f.image=e;f.needsUpdate=!0}));f.sourceFile=o;s&&(f.repeat.set(s[0],s[1]),1!==s[0]&&(f.wrapS=t.RepeatWrapping),1!==s[1]&&(f.wrapT=t.RepeatWrapping));h&&f.offset.set(h[0],h[1]);l&&(o={repeat:t.RepeatWrapping,mirror:t.MirroredRepeatWrapping},void 0!==o[l[0]]&&(f.wrapS=o[l[0]]),void 0!==o[l[1]]&&(f.wrapT=o[l[1]]));c&&(f.anisotropy=c);e[n]=f}function o(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]}var a=this,s="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var l=e.shading.toLowerCase();"phong"===l?s="MeshPhongMaterial":"basic"===l&&(s="MeshBasicMaterial")}void 0!==e.blending&&void 0!==t[e.blending]&&(h.blending=t[e.blending]);void 0!==e.transparent&&(h.transparent=e.transparent);void 0!==e.opacity&&1>e.opacity&&(h.transparent=!0);void 0!==e.depthTest&&(h.depthTest=e.depthTest);void 0!==e.depthWrite&&(h.depthWrite=e.depthWrite);void 0!==e.visible&&(h.visible=e.visible);void 0!==e.flipSided&&(h.side=t.BackSide);void 0!==e.doubleSided&&(h.side=t.DoubleSide);void 0!==e.wireframe&&(h.wireframe=e.wireframe);void 0!==e.vertexColors&&("face"===e.vertexColors?h.vertexColors=t.FaceColors:e.vertexColors&&(h.vertexColors=t.VertexColors));e.colorDiffuse?h.color=o(e.colorDiffuse):e.DbgColor&&(h.color=e.DbgColor);e.colorSpecular&&(h.specular=o(e.colorSpecular));e.colorEmissive&&(h.emissive=o(e.colorEmissive));void 0!==e.transparency&&(console.warn("THREE.Loader: transparency has been renamed to opacity"),e.opacity=e.transparency);void 0!==e.opacity&&(h.opacity=e.opacity);e.specularCoef&&(h.shininess=e.specularCoef);e.mapDiffuse&&r&&n(h,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);e.mapLight&&r&&n(h,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);e.mapBump&&r&&n(h,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);e.mapNormal&&r&&n(h,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);e.mapSpecular&&r&&n(h,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);e.mapAlpha&&r&&n(h,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);e.mapBumpScale&&(h.bumpScale=e.mapBumpScale);e.mapNormalFactor&&(h.normalScale=new t.Vector2(e.mapNormalFactor,e.mapNormalFactor));s=new t[s](h);void 0!==e.DbgName&&(s.name=e.DbgName);return s}};t.Loader.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=0,r=this.handlers.length;e<r;e+=2){var i=this.handlers[e+1];if(this.handlers[e].test(t))return i}return null}};t.XHRLoader=function(e){this.manager=void 0!==e?e:t.DefaultLoadingManager};t.XHRLoader.prototype={constructor:t.XHRLoader,load:function(e,r,i,n){var o=this,a=t.Cache.get(e);void 0!==a?r&&r(a):(a=new XMLHttpRequest,a.open("GET",e,!0),a.addEventListener("load",function(i){t.Cache.add(e,this.response);r&&r(this.response);o.manager.itemEnd(e)},!1),void 0!==i&&a.addEventListener("progress",function(t){i(t)},!1),void 0!==n&&a.addEventListener("error",function(t){n(t)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(a.responseType=this.responseType),a.send(null),o.manager.itemStart(e))},setResponseType:function(t){this.responseType=t},setCrossOrigin:function(t){this.crossOrigin=t}};t.ImageLoader=function(e){this.manager=void 0!==e?e:t.DefaultLoadingManager};t.ImageLoader.prototype={constructor:t.ImageLoader,load:function(e,r,i,n){var o=this,a=t.Cache.get(e);if(void 0!==a)r(a);else return a=document.createElement("img"),a.addEventListener("load",function(i){t.Cache.add(e,this);r&&r(this);o.manager.itemEnd(e)},!1),void 0!==i&&a.addEventListener("progress",function(t){i(t)},!1),void 0!==n&&a.addEventListener("error",function(t){n(t)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),a.src=e,o.manager.itemStart(e),a},setCrossOrigin:function(t){this.crossOrigin=t}};t.JSONLoader=function(e){t.Loader.call(this,e);this.withCredentials=!1};t.JSONLoader.prototype=Object.create(t.Loader.prototype);t.JSONLoader.prototype.constructor=t.JSONLoader;t.JSONLoader.prototype.load=function(t,e,r){r=r&&"string"===typeof r?r:this.extractUrlBase(t);this.onLoadStart();this.loadAjaxJSON(this,t,e,r)};t.JSONLoader.prototype.loadAjaxJSON=function(e,r,i,n,o){var a=new XMLHttpRequest,s=0;a.onreadystatechange=function(){if(a.readyState===a.DONE)if(200===a.status||0===a.status){if(a.responseText){var h=JSON.parse(a.responseText),l=h.metadata;if(void 0!==l){if("object"===l.type){t.error("THREE.JSONLoader: "+r+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===l.type){t.error("THREE.JSONLoader: "+r+" seems to be a Scene. Use THREE.SceneLoader instead.");return}}h=e.parse(h,n);i(h.geometry,h.materials)}else t.error("THREE.JSONLoader: "+r+" seems to be unreachable or the file is empty.");e.onLoadComplete()}else t.error("THREE.JSONLoader: Couldn't load "+r+" ("+a.status+")");else a.readyState===a.LOADING?o&&(0===s&&(s=a.getResponseHeader("Content-Length")),o({total:s,loaded:a.responseText.length})):a.readyState===a.HEADERS_RECEIVED&&void 0!==o&&(s=a.getResponseHeader("Content-Length"))};a.open("GET",r,!0);a.withCredentials=this.withCredentials;a.send(null)};t.JSONLoader.prototype.parse=function(e,r){var i=new t.Geometry,n=void 0!==e.scale?1/e.scale:1;(function(r){var n,o,a,s,h,l,c,u,f,p,d,m,g,y=e.faces;l=e.vertices;var v=e.normals,x=e.colors,b=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&b++;for(n=0;n<b;n++)i.faceVertexUvs[n]=[]}s=0;for(h=l.length;s<h;)n=new t.Vector3,n.x=l[s++]*r,n.y=l[s++]*r,n.z=l[s++]*r,i.vertices.push(n);s=0;for(h=y.length;s<h;)if(r=y[s++],f=r&1,a=r&2,n=r&8,c=r&16,p=r&32,l=r&64,r&=128,f){f=new t.Face3;f.a=y[s];f.b=y[s+1];f.c=y[s+3];d=new t.Face3;d.a=y[s+1];d.b=y[s+2];d.c=y[s+3];s+=4;a&&(a=y[s++],f.materialIndex=a,d.materialIndex=a);a=i.faces.length;if(n)for(n=0;n<b;n++)for(m=e.uvs[n],i.faceVertexUvs[n][a]=[],i.faceVertexUvs[n][a+1]=[],o=0;4>o;o++)u=y[s++],g=m[2*u],u=m[2*u+1],g=new t.Vector2(g,u),2!==o&&i.faceVertexUvs[n][a].push(g),0!==o&&i.faceVertexUvs[n][a+1].push(g);c&&(c=3*y[s++],f.normal.set(v[c++],v[c++],v[c]),d.normal.copy(f.normal));if(p)for(n=0;4>n;n++)c=3*y[s++],p=new t.Vector3(v[c++],v[c++],v[c]),2!==n&&f.vertexNormals.push(p),0!==n&&d.vertexNormals.push(p);l&&(l=y[s++],l=x[l],f.color.setHex(l),d.color.setHex(l));if(r)for(n=0;4>n;n++)l=y[s++],l=x[l],2!==n&&f.vertexColors.push(new t.Color(l)),0!==n&&d.vertexColors.push(new t.Color(l));i.faces.push(f);i.faces.push(d)}else{f=new t.Face3;f.a=y[s++];f.b=y[s++];f.c=y[s++];a&&(a=y[s++],f.materialIndex=a);a=i.faces.length;if(n)for(n=0;n<b;n++)for(m=e.uvs[n],i.faceVertexUvs[n][a]=[],o=0;3>o;o++)u=y[s++],g=m[2*u],u=m[2*u+1],g=new t.Vector2(g,u),i.faceVertexUvs[n][a].push(g);c&&(c=3*y[s++],f.normal.set(v[c++],v[c++],v[c]));if(p)for(n=0;3>n;n++)c=3*y[s++],p=new t.Vector3(v[c++],v[c++],v[c]),f.vertexNormals.push(p);l&&(l=y[s++],f.color.setHex(x[l]));if(r)for(n=0;3>n;n++)l=y[s++],f.vertexColors.push(new t.Color(x[l]));i.faces.push(f)}})(n);(function(){var r=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,o=e.skinWeights.length;n<o;n+=r)i.skinWeights.push(new t.Vector4(e.skinWeights[n],1<r?e.skinWeights[n+1]:0,2<r?e.skinWeights[n+2]:0,3<r?e.skinWeights[n+3]:0));if(e.skinIndices)for(n=0,o=e.skinIndices.length;n<o;n+=r)i.skinIndices.push(new t.Vector4(e.skinIndices[n],1<r?e.skinIndices[n+1]:0,2<r?e.skinIndices[n+2]:0,3<r?e.skinIndices[n+3]:0));i.bones=e.bones;i.bones&&0<i.bones.length&&(i.skinWeights.length!==i.skinIndices.length||i.skinIndices.length!==i.vertices.length)&&t.warn("THREE.JSONLoader: When skinning, number of vertices ("+i.vertices.length+"), skinIndices ("+i.skinIndices.length+"), and skinWeights ("+i.skinWeights.length+") should match.");i.animation=e.animation;i.animations=e.animations})();(function(r){if(void 0!==e.morphTargets){var n,o,a,s,h,l;n=0;for(o=e.morphTargets.length;n<o;n++)for(i.morphTargets[n]={},i.morphTargets[n].name=e.morphTargets[n].name,i.morphTargets[n].vertices=[],h=i.morphTargets[n].vertices,l=e.morphTargets[n].vertices,a=0,s=l.length;a<s;a+=3){var c=new t.Vector3;c.x=l[a]*r;c.y=l[a+1]*r;c.z=l[a+2]*r;h.push(c)}}if(void 0!==e.morphColors)for(n=0,o=e.morphColors.length;n<o;n++)for(i.morphColors[n]={},i.morphColors[n].name=e.morphColors[n].name,i.morphColors[n].colors=[],s=i.morphColors[n].colors,h=e.morphColors[n].colors,r=0,a=h.length;r<a;r+=3)l=new t.Color(16755200),l.setRGB(h[r],h[r+1],h[r+2]),s.push(l)})(n);i.computeFaceNormals();i.computeBoundingSphere();if(void 0===e.materials||0===e.materials.length)return{geometry:i};n=this.initMaterials(e.materials,r);this.needsTangents(n)&&i.computeTangents();return{geometry:i,materials:n}};t.LoadingManager=function(t,e,r){var i=this,n=0,o=0;this.onLoad=t;this.onProgress=e;this.onError=r;this.itemStart=function(t){o++};this.itemEnd=function(t){n++;if(void 0!==i.onProgress)i.onProgress(t,n,o);if(n===o&&void 0!==i.onLoad)i.onLoad()}};t.DefaultLoadingManager=new t.LoadingManager;t.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:t.DefaultLoadingManager};t.BufferGeometryLoader.prototype={constructor:t.BufferGeometryLoader,load:function(e,r,i,n){var o=this,a=new t.XHRLoader(o.manager);a.setCrossOrigin(this.crossOrigin);a.load(e,function(t){r(o.parse(JSON.parse(t)))},i,n)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(e){var r=new t.BufferGeometry,i=e.data.attributes,n;for(n in i){var o=i[n],a=new self[o.type](o.array);r.addAttribute(n,new t.BufferAttribute(a,o.itemSize))}i=e.data.offsets;void 0!==i&&(r.offsets=JSON.parse(JSON.stringify(i)));e=e.data.boundingSphere;void 0!==e&&(i=new t.Vector3,void 0!==e.center&&i.fromArray(e.center),r.boundingSphere=new t.Sphere(i,e.radius));return r}};t.MaterialLoader=function(e){this.manager=void 0!==e?e:t.DefaultLoadingManager};t.MaterialLoader.prototype={constructor:t.MaterialLoader,load:function(e,r,i,n){var o=this,a=new t.XHRLoader(o.manager);a.setCrossOrigin(this.crossOrigin);a.load(e,function(t){r(o.parse(JSON.parse(t)))},i,n)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(e){var r=new t[e.type];void 0!==e.color&&r.color.setHex(e.color);void 0!==e.emissive&&r.emissive.setHex(e.emissive);void 0!==e.specular&&r.specular.setHex(e.specular);void 0!==e.shininess&&(r.shininess=e.shininess);void 0!==e.uniforms&&(r.uniforms=e.uniforms);void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader);void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader);void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors);void 0!==e.shading&&(r.shading=e.shading);void 0!==e.blending&&(r.blending=e.blending);void 0!==e.side&&(r.side=e.side);void 0!==e.opacity&&(r.opacity=e.opacity);void 0!==e.transparent&&(r.transparent=e.transparent);void 0!==e.wireframe&&(r.wireframe=e.wireframe);void 0!==e.size&&(r.size=e.size);void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation);if(void 0!==e.materials)for(var i=0,n=e.materials.length;i<n;i++)r.materials.push(this.parse(e.materials[i]));return r}};t.ObjectLoader=function(e){this.manager=void 0!==e?e:t.DefaultLoadingManager;this.texturePath=""};t.ObjectLoader.prototype={constructor:t.ObjectLoader,load:function(e,r,i,n){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var o=this,a=new t.XHRLoader(o.manager);a.setCrossOrigin(this.crossOrigin);a.load(e,function(t){o.parse(JSON.parse(t),r)},i,n)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var r=this.parseGeometries(t.geometries),i=this.parseImages(t.images,function(){void 0!==e&&e(n)}),i=this.parseTextures(t.textures,i),i=this.parseMaterials(t.materials,i),n=this.parseObject(t.object,r,i);void 0!==t.images&&0!==t.images.length||void 0===e||e(n);return n},parseGeometries:function(e){var r={};if(void 0!==e)for(var i=new t.JSONLoader,n=new t.BufferGeometryLoader,o=0,a=e.length;o<a;o++){var s,h=e[o];switch(h.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new t[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case"BoxGeometry":case"CubeGeometry":s=new t.BoxGeometry(h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case"CircleGeometry":s=new t.CircleGeometry(h.radius,h.segments);break;case"CylinderGeometry":s=new t.CylinderGeometry(h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded);break;case"SphereGeometry":s=new t.SphereGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);
break;case"IcosahedronGeometry":s=new t.IcosahedronGeometry(h.radius,h.detail);break;case"TorusGeometry":s=new t.TorusGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case"TorusKnotGeometry":s=new t.TorusKnotGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.p,h.q,h.heightScale);break;case"BufferGeometry":s=n.parse(h);break;case"Geometry":s=i.parse(h.data).geometry}s.uuid=h.uuid;void 0!==h.name&&(s.name=h.name);r[h.uuid]=s}return r},parseMaterials:function(e,r){var i={};if(void 0!==e)for(var n=function(e){void 0===r[e]&&t.warn("THREE.ObjectLoader: Undefined texture",e);return r[e]},o=new t.MaterialLoader,a=0,s=e.length;a<s;a++){var h=e[a],l=o.parse(h);l.uuid=h.uuid;void 0!==h.name&&(l.name=h.name);void 0!==h.map&&(l.map=n(h.map));void 0!==h.bumpMap&&(l.bumpMap=n(h.bumpMap),h.bumpScale&&(l.bumpScale=new t.Vector2(h.bumpScale,h.bumpScale)));void 0!==h.alphaMap&&(l.alphaMap=n(h.alphaMap));void 0!==h.envMap&&(l.envMap=n(h.envMap));void 0!==h.normalMap&&(l.normalMap=n(h.normalMap),h.normalScale&&(l.normalScale=new t.Vector2(h.normalScale,h.normalScale)));void 0!==h.lightMap&&(l.lightMap=n(h.lightMap));void 0!==h.specularMap&&(l.specularMap=n(h.specularMap));i[h.uuid]=l}return i},parseImages:function(e,r){var i=this,n={};if(void 0!==e&&0<e.length){var o=new t.LoadingManager(r),a=new t.ImageLoader(o);a.setCrossOrigin(this.crossOrigin);for(var o=function(t){i.manager.itemStart(t);return a.load(t,function(){i.manager.itemEnd(t)})},s=0,h=e.length;s<h;s++){var l=e[s],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:i.texturePath+l.url;n[l.uuid]=o(c)}}return n},parseTextures:function(e,r){var i={};if(void 0!==e)for(var n=0,o=e.length;n<o;n++){var a=e[n];void 0===a.image&&t.warn('THREE.ObjectLoader: No "image" speficied for',a.uuid);void 0===r[a.image]&&t.warn("THREE.ObjectLoader: Undefined image",a.image);var s=new t.Texture(r[a.image]);s.needsUpdate=!0;s.uuid=a.uuid;void 0!==a.name&&(s.name=a.name);void 0!==a.repeat&&(s.repeat=new t.Vector2(a.repeat[0],a.repeat[1]));void 0!==a.minFilter&&(s.minFilter=t[a.minFilter]);void 0!==a.magFilter&&(s.magFilter=t[a.magFilter]);void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy);a.wrap instanceof Array&&(s.wrapS=t[a.wrap[0]],s.wrapT=t[a.wrap[1]]);i[a.uuid]=s}return i},parseObject:function(){var e=new t.Matrix4;return function(r,i,n){var o;o=function(e){void 0===i[e]&&t.warn("THREE.ObjectLoader: Undefined geometry",e);return i[e]};var a=function(e){void 0===n[e]&&t.warn("THREE.ObjectLoader: Undefined material",e);return n[e]};switch(r.type){case"Scene":o=new t.Scene;break;case"PerspectiveCamera":o=new t.PerspectiveCamera(r.fov,r.aspect,r.near,r.far);break;case"OrthographicCamera":o=new t.OrthographicCamera(r.left,r.right,r.top,r.bottom,r.near,r.far);break;case"AmbientLight":o=new t.AmbientLight(r.color);break;case"DirectionalLight":o=new t.DirectionalLight(r.color,r.intensity);break;case"PointLight":o=new t.PointLight(r.color,r.intensity,r.distance,r.decay);break;case"SpotLight":o=new t.SpotLight(r.color,r.intensity,r.distance,r.angle,r.exponent,r.decay);break;case"HemisphereLight":o=new t.HemisphereLight(r.color,r.groundColor,r.intensity);break;case"Mesh":o=new t.Mesh(o(r.geometry),a(r.material));break;case"Line":o=new t.Line(o(r.geometry),a(r.material),r.mode);break;case"PointCloud":o=new t.PointCloud(o(r.geometry),a(r.material));break;case"Sprite":o=new t.Sprite(a(r.material));break;case"Group":o=new t.Group;break;default:o=new t.Object3D}o.uuid=r.uuid;void 0!==r.name&&(o.name=r.name);void 0!==r.matrix?(e.fromArray(r.matrix),e.decompose(o.position,o.quaternion,o.scale)):(void 0!==r.position&&o.position.fromArray(r.position),void 0!==r.rotation&&o.rotation.fromArray(r.rotation),void 0!==r.scale&&o.scale.fromArray(r.scale));void 0!==r.visible&&(o.visible=r.visible);void 0!==r.userData&&(o.userData=r.userData);if(void 0!==r.children)for(var s in r.children)o.add(this.parseObject(r.children[s],i,n));return o}}()};t.TextureLoader=function(e){this.manager=void 0!==e?e:t.DefaultLoadingManager};t.TextureLoader.prototype={constructor:t.TextureLoader,load:function(e,r,i,n){var o=new t.ImageLoader(this.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){e=new t.Texture(e);e.needsUpdate=!0;void 0!==r&&r(e)},i,n)},setCrossOrigin:function(t){this.crossOrigin=t}};t.DataTextureLoader=t.BinaryTextureLoader=function(){this._parser=null};t.BinaryTextureLoader.prototype={constructor:t.BinaryTextureLoader,load:function(e,r,i,n){var o=this,a=new t.DataTexture,s=new t.XHRLoader;s.setResponseType("arraybuffer");s.load(e,function(e){if(e=o._parser(e))void 0!==e.image?a.image=e.image:void 0!==e.data&&(a.image.width=e.width,a.image.height=e.height,a.image.data=e.data),a.wrapS=void 0!==e.wrapS?e.wrapS:t.ClampToEdgeWrapping,a.wrapT=void 0!==e.wrapT?e.wrapT:t.ClampToEdgeWrapping,a.magFilter=void 0!==e.magFilter?e.magFilter:t.LinearFilter,a.minFilter=void 0!==e.minFilter?e.minFilter:t.LinearMipMapLinearFilter,a.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.format&&(a.format=e.format),void 0!==e.type&&(a.type=e.type),void 0!==e.mipmaps&&(a.mipmaps=e.mipmaps),1===e.mipmapCount&&(a.minFilter=t.LinearFilter),a.needsUpdate=!0,r&&r(a,e)},i,n);return a}};t.CompressedTextureLoader=function(){this._parser=null};t.CompressedTextureLoader.prototype={constructor:t.CompressedTextureLoader,load:function(e,r,i){var n=this,o=[],a=new t.CompressedTexture;a.image=o;var s=new t.XHRLoader;s.setResponseType("arraybuffer");if(e instanceof Array){var h=0;i=function(i){s.load(e[i],function(e){e=n._parser(e,!0);o[i]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps};h+=1;6===h&&(1==e.mipmapCount&&(a.minFilter=t.LinearFilter),a.format=e.format,a.needsUpdate=!0,r&&r(a))})};for(var l=0,c=e.length;l<c;++l)i(l)}else s.load(e,function(e){e=n._parser(e,!0);if(e.isCubemap)for(var i=e.mipmaps.length/e.mipmapCount,s=0;s<i;s++){o[s]={mipmaps:[]};for(var h=0;h<e.mipmapCount;h++)o[s].mipmaps.push(e.mipmaps[s*e.mipmapCount+h]),o[s].format=e.format,o[s].width=e.width,o[s].height=e.height}else a.image.width=e.width,a.image.height=e.height,a.mipmaps=e.mipmaps;1===e.mipmapCount&&(a.minFilter=t.LinearFilter);a.format=e.format;a.needsUpdate=!0;r&&r(a)});return a}};t.Material=function(){Object.defineProperty(this,"id",{value:t.MaterialIdCount++});this.uuid=t.Math.generateUUID();this.name="";this.type="Material";this.side=t.FrontSide;this.opacity=1;this.transparent=!1;this.blending=t.NormalBlending;this.blendSrc=t.SrcAlphaFactor;this.blendDst=t.OneMinusSrcAlphaFactor;this.blendEquation=t.AddEquation;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.colorWrite=this.depthWrite=this.depthTest=!0;this.polygonOffset=!1;this.overdraw=this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this._needsUpdate=this.visible=!0};t.Material.prototype={constructor:t.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(t){!0===t&&this.update();this._needsUpdate=t},setValues:function(e){if(void 0!==e)for(var r in e){var i=e[r];if(void 0===i)t.warn("THREE.Material: '"+r+"' parameter is undefined.");else if(r in this){var n=this[r];n instanceof t.Color?n.set(i):n instanceof t.Vector3&&i instanceof t.Vector3?n.copy(i):this[r]="overdraw"==r?Number(i):i}}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};""!==this.name&&(e.name=this.name);this instanceof t.MeshBasicMaterial?(e.color=this.color.getHex(),this.vertexColors!==t.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==t.NormalBlending&&(e.blending=this.blending),this.side!==t.FrontSide&&(e.side=this.side)):this instanceof t.MeshLambertMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),this.vertexColors!==t.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==t.SmoothShading&&(e.shading=this.shading),this.blending!==t.NormalBlending&&(e.blending=this.blending),this.side!==t.FrontSide&&(e.side=this.side)):this instanceof t.MeshPhongMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),e.specular=this.specular.getHex(),e.shininess=this.shininess,this.vertexColors!==t.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==t.SmoothShading&&(e.shading=this.shading),this.blending!==t.NormalBlending&&(e.blending=this.blending),this.side!==t.FrontSide&&(e.side=this.side)):this instanceof t.MeshNormalMaterial?(this.blending!==t.NormalBlending&&(e.blending=this.blending),this.side!==t.FrontSide&&(e.side=this.side)):this instanceof t.MeshDepthMaterial?(this.blending!==t.NormalBlending&&(e.blending=this.blending),this.side!==t.FrontSide&&(e.side=this.side)):this instanceof t.PointCloudMaterial?(e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.color=this.color.getHex(),this.vertexColors!==t.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==t.NormalBlending&&(e.blending=this.blending)):this instanceof t.ShaderMaterial?(e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader):this instanceof t.SpriteMaterial&&(e.color=this.color.getHex());1>this.opacity&&(e.opacity=this.opacity);!1!==this.transparent&&(e.transparent=this.transparent);!1!==this.wireframe&&(e.wireframe=this.wireframe);return e},clone:function(e){void 0===e&&(e=new t.Material);e.name=this.name;e.side=this.side;e.opacity=this.opacity;e.transparent=this.transparent;e.blending=this.blending;e.blendSrc=this.blendSrc;e.blendDst=this.blendDst;e.blendEquation=this.blendEquation;e.blendSrcAlpha=this.blendSrcAlpha;e.blendDstAlpha=this.blendDstAlpha;e.blendEquationAlpha=this.blendEquationAlpha;e.depthTest=this.depthTest;e.depthWrite=this.depthWrite;e.polygonOffset=this.polygonOffset;e.polygonOffsetFactor=this.polygonOffsetFactor;e.polygonOffsetUnits=this.polygonOffsetUnits;e.alphaTest=this.alphaTest;e.overdraw=this.overdraw;e.visible=this.visible;return e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};t.EventDispatcher.prototype.apply(t.Material.prototype);t.MaterialIdCount=0;t.LineBasicMaterial=function(e){t.Material.call(this);this.type="LineBasicMaterial";this.color=new t.Color(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.vertexColors=t.NoColors;this.fog=!0;this.setValues(e)};t.LineBasicMaterial.prototype=Object.create(t.Material.prototype);t.LineBasicMaterial.prototype.constructor=t.LineBasicMaterial;t.LineBasicMaterial.prototype.clone=function(){var e=new t.LineBasicMaterial;t.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.linecap=this.linecap;e.linejoin=this.linejoin;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};t.LineDashedMaterial=function(e){t.Material.call(this);this.type="LineDashedMaterial";this.color=new t.Color(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.vertexColors=!1;this.fog=!0;this.setValues(e)};t.LineDashedMaterial.prototype=Object.create(t.Material.prototype);t.LineDashedMaterial.prototype.constructor=t.LineDashedMaterial;t.LineDashedMaterial.prototype.clone=function(){var e=new t.LineDashedMaterial;t.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.scale=this.scale;e.dashSize=this.dashSize;e.gapSize=this.gapSize;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};t.MeshBasicMaterial=function(e){t.Material.call(this);this.type="MeshBasicMaterial";this.color=new t.Color(16777215);this.envMap=this.alphaMap=this.specularMap=this.lightMap=this.map=null;this.combine=t.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=t.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=t.NoColors;this.morphTargets=this.skinning=!1;this.setValues(e)};t.MeshBasicMaterial.prototype=Object.create(t.Material.prototype);t.MeshBasicMaterial.prototype.constructor=t.MeshBasicMaterial;t.MeshBasicMaterial.prototype.clone=function(){var e=new t.MeshBasicMaterial;t.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;return e};t.MeshLambertMaterial=function(e){t.Material.call(this);this.type="MeshLambertMaterial";this.color=new t.Color(16777215);this.emissive=new t.Color(0);this.wrapAround=!1;this.wrapRGB=new t.Vector3(1,1,1);this.envMap=this.alphaMap=this.specularMap=this.lightMap=this.map=null;this.combine=t.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=t.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=t.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(e)};t.MeshLambertMaterial.prototype=Object.create(t.Material.prototype);t.MeshLambertMaterial.prototype.constructor=t.MeshLambertMaterial;t.MeshLambertMaterial.prototype.clone=function(){var e=new t.MeshLambertMaterial;t.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.emissive.copy(this.emissive);e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};t.MeshPhongMaterial=function(e){t.Material.call(this);this.type="MeshPhongMaterial";this.color=new t.Color(16777215);this.emissive=new t.Color(0);this.specular=new t.Color(1118481);this.shininess=30;this.wrapAround=this.metal=!1;this.wrapRGB=new t.Vector3(1,1,1);this.bumpMap=this.lightMap=this.map=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new t.Vector2(1,1);this.envMap=this.alphaMap=this.specularMap=null;this.combine=t.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=t.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=t.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(e)};t.MeshPhongMaterial.prototype=Object.create(t.Material.prototype);t.MeshPhongMaterial.prototype.constructor=t.MeshPhongMaterial;t.MeshPhongMaterial.prototype.clone=function(){var e=new t.MeshPhongMaterial;t.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.emissive.copy(this.emissive);e.specular.copy(this.specular);e.shininess=this.shininess;e.metal=this.metal;e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.bumpMap=this.bumpMap;e.bumpScale=this.bumpScale;e.normalMap=this.normalMap;e.normalScale.copy(this.normalScale);e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};t.MeshDepthMaterial=function(e){t.Material.call(this);this.type="MeshDepthMaterial";this.wireframe=this.morphTargets=!1;this.wireframeLinewidth=1;this.setValues(e)};t.MeshDepthMaterial.prototype=Object.create(t.Material.prototype);t.MeshDepthMaterial.prototype.constructor=t.MeshDepthMaterial;t.MeshDepthMaterial.prototype.clone=function(){var e=new t.MeshDepthMaterial;t.Material.prototype.clone.call(this,e);e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};t.MeshNormalMaterial=function(e){t.Material.call(this,e);this.type="MeshNormalMaterial";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=!1;this.setValues(e)};t.MeshNormalMaterial.prototype=Object.create(t.Material.prototype);t.MeshNormalMaterial.prototype.constructor=t.MeshNormalMaterial;t.MeshNormalMaterial.prototype.clone=function(){var e=new t.MeshNormalMaterial;t.Material.prototype.clone.call(this,e);e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};t.MeshFaceMaterial=function(e){this.uuid=t.Math.generateUUID();this.type="MeshFaceMaterial";this.materials=e instanceof Array?e:[]};t.MeshFaceMaterial.prototype={constructor:t.MeshFaceMaterial,toJSON:function(){for(var t={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},e=0,r=this.materials.length;e<r;e++)t.materials.push(this.materials[e].toJSON());return t},clone:function(){for(var e=new t.MeshFaceMaterial,r=0;r<this.materials.length;r++)e.materials.push(this.materials[r].clone());return e}};t.PointCloudMaterial=function(e){t.Material.call(this);this.type="PointCloudMaterial";this.color=new t.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.vertexColors=t.NoColors;this.fog=!0;this.setValues(e)};t.PointCloudMaterial.prototype=Object.create(t.Material.prototype);t.PointCloudMaterial.prototype.constructor=t.PointCloudMaterial;t.PointCloudMaterial.prototype.clone=function(){var e=new t.PointCloudMaterial;t.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.size=this.size;e.sizeAttenuation=this.sizeAttenuation;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};t.ParticleBasicMaterial=function(e){t.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.");return new t.PointCloudMaterial(e)};t.ParticleSystemMaterial=function(e){t.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.");return new t.PointCloudMaterial(e)};t.ShaderMaterial=function(e){t.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.attributes=null;this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=t.SmoothShading;this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.vertexColors=t.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;this.setValues(e)};t.ShaderMaterial.prototype=Object.create(t.Material.prototype);t.ShaderMaterial.prototype.constructor=t.ShaderMaterial;t.ShaderMaterial.prototype.clone=function(){var e=new t.ShaderMaterial;t.Material.prototype.clone.call(this,e);e.fragmentShader=this.fragmentShader;e.vertexShader=this.vertexShader;e.uniforms=t.UniformsUtils.clone(this.uniforms);e.attributes=this.attributes;e.defines=this.defines;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.fog=this.fog;e.lights=this.lights;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};t.RawShaderMaterial=function(e){t.ShaderMaterial.call(this,e);this.type="RawShaderMaterial"};t.RawShaderMaterial.prototype=Object.create(t.ShaderMaterial.prototype);t.RawShaderMaterial.prototype.constructor=t.RawShaderMaterial;t.RawShaderMaterial.prototype.clone=function(){var e=new t.RawShaderMaterial;t.ShaderMaterial.prototype.clone.call(this,e);return e};t.SpriteMaterial=function(e){t.Material.call(this);this.type="SpriteMaterial";this.color=new t.Color(16777215);this.map=null;this.rotation=0;this.fog=!1;this.setValues(e)};t.SpriteMaterial.prototype=Object.create(t.Material.prototype);t.SpriteMaterial.prototype.constructor=t.SpriteMaterial;t.SpriteMaterial.prototype.clone=function(){var e=new t.SpriteMaterial;t.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.rotation=this.rotation;e.fog=this.fog;return e};t.Texture=function(e,r,i,n,o,a,s,h,l){Object.defineProperty(this,"id",{value:t.TextureIdCount++});this.uuid=t.Math.generateUUID();this.sourceFile=this.name="";this.image=void 0!==e?e:t.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==r?r:t.Texture.DEFAULT_MAPPING;this.wrapS=void 0!==i?i:t.ClampToEdgeWrapping;this.wrapT=void 0!==n?n:t.ClampToEdgeWrapping;this.magFilter=void 0!==o?o:t.LinearFilter;this.minFilter=void 0!==a?a:t.LinearMipMapLinearFilter;this.anisotropy=void 0!==l?l:1;this.format=void 0!==s?s:t.RGBAFormat;this.type=void 0!==h?h:t.UnsignedByteType;this.offset=new t.Vector2(0,0);this.repeat=new t.Vector2(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this._needsUpdate=!1;this.onUpdate=null};t.Texture.DEFAULT_IMAGE=void 0;t.Texture.DEFAULT_MAPPING=t.UVMapping;t.Texture.prototype={constructor:t.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(t){!0===t&&this.update();this._needsUpdate=t},clone:function(e){void 0===e&&(e=new t.Texture);e.image=this.image;e.mipmaps=this.mipmaps.slice(0);e.mapping=this.mapping;e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.format=this.format;e.type=this.type;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.generateMipmaps=this.generateMipmaps;e.premultiplyAlpha=this.premultiplyAlpha;e.flipY=this.flipY;e.unpackAlignment=this.unpackAlignment;return e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};t.EventDispatcher.prototype.apply(t.Texture.prototype);t.TextureIdCount=0;t.CubeTexture=function(e,r,i,n,o,a,s,h,l){r=void 0!==r?r:t.CubeReflectionMapping;t.Texture.call(this,e,r,i,n,o,a,s,h,l);this.images=e};t.CubeTexture.prototype=Object.create(t.Texture.prototype);t.CubeTexture.prototype.constructor=t.CubeTexture;t.CubeTexture.clone=function(e){void 0===e&&(e=new t.CubeTexture);t.Texture.prototype.clone.call(this,e);e.images=this.images;return e};t.CompressedTexture=function(e,r,i,n,o,a,s,h,l,c,u){t.Texture.call(this,null,a,s,h,l,c,n,o,u);this.image={width:r,height:i};this.mipmaps=e;this.generateMipmaps=this.flipY=!1};t.CompressedTexture.prototype=Object.create(t.Texture.prototype);t.CompressedTexture.prototype.constructor=t.CompressedTexture;t.CompressedTexture.prototype.clone=function(){var e=new t.CompressedTexture;t.Texture.prototype.clone.call(this,e);return e};t.DataTexture=function(e,r,i,n,o,a,s,h,l,c,u){t.Texture.call(this,null,a,s,h,l,c,n,o,u);this.image={data:e,width:r,height:i}};t.DataTexture.prototype=Object.create(t.Texture.prototype);t.DataTexture.prototype.constructor=t.DataTexture;t.DataTexture.prototype.clone=function(){var e=new t.DataTexture;t.Texture.prototype.clone.call(this,e);return e};t.VideoTexture=function(e,r,i,n,o,a,s,h,l){t.Texture.call(this,e,r,i,n,o,a,s,h,l);this.generateMipmaps=!1;var c=this,u=function(){requestAnimationFrame(u);e.readyState===e.HAVE_ENOUGH_DATA&&(c.needsUpdate=!0)};u()};t.VideoTexture.prototype=Object.create(t.Texture.prototype);t.VideoTexture.prototype.constructor=t.VideoTexture;t.Group=function(){t.Object3D.call(this);this.type="Group"};t.Group.prototype=Object.create(t.Object3D.prototype);t.Group.prototype.constructor=t.Group;t.PointCloud=function(e,r){t.Object3D.call(this);this.type="PointCloud";this.geometry=void 0!==e?e:new t.Geometry;this.material=void 0!==r?r:new t.PointCloudMaterial({color:16777215*Math.random()})};t.PointCloud.prototype=Object.create(t.Object3D.prototype);t.PointCloud.prototype.constructor=t.PointCloud;t.PointCloud.prototype.raycast=function(){var e=new t.Matrix4,r=new t.Ray;return function(i,n){var o=this,a=o.geometry,s=i.params.PointCloud.threshold;e.getInverse(this.matrixWorld);r.copy(i.ray).applyMatrix4(e);if(null===a.boundingBox||!1!==r.isIntersectionBox(a.boundingBox)){var h=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=new t.Vector3,s=function(t,e){var a=r.distanceToPoint(t);if(a<h){var s=r.closestPointToPoint(t);s.applyMatrix4(o.matrixWorld);var l=i.ray.origin.distanceTo(s);n.push({distance:l,distanceToRay:a,point:s.clone(),index:e,face:null,object:o})}};if(a instanceof t.BufferGeometry){var c=a.attributes,u=c.position.array;if(void 0!==c.index){var c=c.index.array,f=a.offsets;0===f.length&&(f=[{start:0,count:c.length,index:0}]);for(var p=0,d=f.length;p<d;++p)for(var m=f[p].start,g=f[p].index,a=m,m=m+f[p].count;a<m;a++){var y=g+c[a];l.fromArray(u,3*y);s(l,y)}}else for(c=u.length/3,a=0;a<c;a++)l.set(u[3*a],u[3*a+1],u[3*a+2]),s(l,a)}else for(l=this.geometry.vertices,a=0;a<l.length;a++)s(l[a],a)}}}();t.PointCloud.prototype.clone=function(e){void 0===e&&(e=new t.PointCloud(this.geometry,this.material));t.Object3D.prototype.clone.call(this,e);return e};t.ParticleSystem=function(e,r){t.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud.");return new t.PointCloud(e,r)};t.Line=function(e,r,i){t.Object3D.call(this);this.type="Line";this.geometry=void 0!==e?e:new t.Geometry;this.material=void 0!==r?r:new t.LineBasicMaterial({color:16777215*Math.random()});this.mode=void 0!==i?i:t.LineStrip};t.LineStrip=0;t.LinePieces=1;t.Line.prototype=Object.create(t.Object3D.prototype);t.Line.prototype.constructor=t.Line;t.Line.prototype.raycast=function(){var e=new t.Matrix4,r=new t.Ray,i=new t.Sphere;return function(n,o){var a=n.linePrecision,a=a*a,s=this.geometry;null===s.boundingSphere&&s.computeBoundingSphere();i.copy(s.boundingSphere);i.applyMatrix4(this.matrixWorld);if(!1!==n.ray.isIntersectionSphere(i)){e.getInverse(this.matrixWorld);r.copy(n.ray).applyMatrix4(e);var h=new t.Vector3,l=new t.Vector3,c=new t.Vector3,u=new t.Vector3,f=this.mode===t.LineStrip?1:2;if(s instanceof t.BufferGeometry){var p=s.attributes;if(void 0!==p.index){var d=p.index.array,p=p.position.array,m=s.offsets;0===m.length&&(m=[{start:0,count:d.length,index:0}]);for(var g=0;g<m.length;g++)for(var y=m[g].start,v=m[g].count,x=m[g].index,s=y;s<y+v-1;s+=f){var b=x+d[s+1];h.fromArray(p,3*(x+d[s]));l.fromArray(p,3*b);b=r.distanceSqToSegment(h,l,u,c);b>a||(b=r.origin.distanceTo(u),b<n.near||b>n.far||o.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:s,offsetIndex:g,face:null,faceIndex:null,object:this}))}}else for(p=p.position.array,s=0;s<p.length/3-1;s+=f)h.fromArray(p,3*s),l.fromArray(p,3*s+3),b=r.distanceSqToSegment(h,l,u,c),b>a||(b=r.origin.distanceTo(u),b<n.near||b>n.far||o.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this}))}else if(s instanceof t.Geometry)for(h=s.vertices,l=h.length,s=0;s<l-1;s+=f)b=r.distanceSqToSegment(h[s],h[s+1],u,c),b>a||(b=r.origin.distanceTo(u),b<n.near||b>n.far||o.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this}))}}}();t.Line.prototype.clone=function(e){void 0===e&&(e=new t.Line(this.geometry,this.material,this.mode));t.Object3D.prototype.clone.call(this,e);return e};t.Mesh=function(e,r){t.Object3D.call(this);this.type="Mesh";this.geometry=void 0!==e?e:new t.Geometry;this.material=void 0!==r?r:new t.MeshBasicMaterial({color:16777215*Math.random()});this.updateMorphTargets()};t.Mesh.prototype=Object.create(t.Object3D.prototype);t.Mesh.prototype.constructor=t.Mesh;t.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var t=0,e=this.geometry.morphTargets.length;t<e;t++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[t].name]=t}};t.Mesh.prototype.getMorphTargetIndexByName=function(e){if(void 0!==this.morphTargetDictionary[e])return this.morphTargetDictionary[e];t.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0.");return 0};t.Mesh.prototype.raycast=function(){var e=new t.Matrix4,r=new t.Ray,i=new t.Sphere,n=new t.Vector3,o=new t.Vector3,a=new t.Vector3;return function(s,h){var l=this.geometry;null===l.boundingSphere&&l.computeBoundingSphere();i.copy(l.boundingSphere);i.applyMatrix4(this.matrixWorld);if(!1!==s.ray.isIntersectionSphere(i)&&(e.getInverse(this.matrixWorld),r.copy(s.ray).applyMatrix4(e),null===l.boundingBox||!1!==r.isIntersectionBox(l.boundingBox)))if(l instanceof t.BufferGeometry){var c=this.material;if(void 0!==c){var u=l.attributes,f,p,d=s.precision;if(void 0!==u.index){var m=u.index.array,g=u.position.array,y=l.offsets;0===y.length&&(y=[{start:0,count:m.length,index:0}]);for(var v=0,x=y.length;v<x;++v)for(var u=y[v].start,b=y[v].index,l=u,_=u+y[v].count;l<_;l+=3){u=b+m[l];f=b+m[l+1];p=b+m[l+2];n.fromArray(g,3*u);o.fromArray(g,3*f);a.fromArray(g,3*p);var w=c.side===t.BackSide?r.intersectTriangle(a,o,n,!0):r.intersectTriangle(n,o,a,c.side!==t.DoubleSide);if(null!==w){w.applyMatrix4(this.matrixWorld);var M=s.ray.origin.distanceTo(w);M<d||M<s.near||M>s.far||h.push({distance:M,point:w,face:new t.Face3(u,f,p,t.Triangle.normal(n,o,a)),faceIndex:null,object:this})}}}else for(g=u.position.array,m=l=0,_=g.length;l<_;l+=3,m+=9)u=l,f=l+1,p=l+2,n.fromArray(g,m),o.fromArray(g,m+3),a.fromArray(g,m+6),w=c.side===t.BackSide?r.intersectTriangle(a,o,n,!0):r.intersectTriangle(n,o,a,c.side!==t.DoubleSide),null!==w&&(w.applyMatrix4(this.matrixWorld),M=s.ray.origin.distanceTo(w),M<d||M<s.near||M>s.far||h.push({distance:M,point:w,face:new t.Face3(u,f,p,t.Triangle.normal(n,o,a)),faceIndex:null,object:this}))}}else if(l instanceof t.Geometry)for(m=this.material instanceof t.MeshFaceMaterial,g=!0===m?this.material.materials:null,d=s.precision,y=l.vertices,v=0,x=l.faces.length;v<x;v++)if(b=l.faces[v],c=!0===m?g[b.materialIndex]:this.material,void 0!==c){u=y[b.a];f=y[b.b];p=y[b.c];if(!0===c.morphTargets){w=l.morphTargets;M=this.morphTargetInfluences;n.set(0,0,0);o.set(0,0,0);a.set(0,0,0);for(var _=0,S=w.length;_<S;_++){var T=M[_];if(0!==T){var E=w[_].vertices;n.x+=(E[b.a].x-u.x)*T;n.y+=(E[b.a].y-u.y)*T;n.z+=(E[b.a].z-u.z)*T;o.x+=(E[b.b].x-f.x)*T;o.y+=(E[b.b].y-f.y)*T;o.z+=(E[b.b].z-f.z)*T;a.x+=(E[b.c].x-p.x)*T;a.y+=(E[b.c].y-p.y)*T;a.z+=(E[b.c].z-p.z)*T}}n.add(u);o.add(f);a.add(p);u=n;f=o;p=a}w=c.side===t.BackSide?r.intersectTriangle(p,f,u,!0):r.intersectTriangle(u,f,p,c.side!==t.DoubleSide);null!==w&&(w.applyMatrix4(this.matrixWorld),M=s.ray.origin.distanceTo(w),M<d||M<s.near||M>s.far||h.push({distance:M,point:w,face:b,faceIndex:v,object:this}))}}}();t.Mesh.prototype.clone=function(e,r){void 0===e&&(e=new t.Mesh(this.geometry,this.material));t.Object3D.prototype.clone.call(this,e,r);return e};t.Bone=function(e){t.Object3D.call(this);this.type="Bone";this.skin=e};t.Bone.prototype=Object.create(t.Object3D.prototype);t.Bone.prototype.constructor=t.Bone;t.Skeleton=function(e,r,i){this.useVertexTexture=void 0!==i?i:!0;this.identityMatrix=new t.Matrix4;e=e||[];this.bones=e.slice(0);this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=e=256<this.bones.length?64:64<this.bones.length?32:16<this.bones.length?16:8,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new t.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,t.RGBAFormat,t.FloatType),this.boneTexture.minFilter=t.NearestFilter,this.boneTexture.magFilter=t.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*this.bones.length);
if(void 0===r)this.calculateInverses();else if(this.bones.length===r.length)this.boneInverses=r.slice(0);else for(t.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],r=0,e=this.bones.length;r<e;r++)this.boneInverses.push(new t.Matrix4)};t.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,r=this.bones.length;e<r;e++){var i=new t.Matrix4;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld);this.boneInverses.push(i)}};t.Skeleton.prototype.pose=function(){for(var t,e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);e=0;for(r=this.bones.length;e<r;e++)if(t=this.bones[e])t.parent?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale)};t.Skeleton.prototype.update=function(){var e=new t.Matrix4;return function(){for(var t=0,r=this.bones.length;t<r;t++)e.multiplyMatrices(this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix,this.boneInverses[t]),e.flattenToArrayOffset(this.boneMatrices,16*t);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}();t.SkinnedMesh=function(e,r,i){t.Mesh.call(this,e,r);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new t.Matrix4;this.bindMatrixInverse=new t.Matrix4;e=[];if(this.geometry&&void 0!==this.geometry.bones){for(var n,o,a,s,h=0,l=this.geometry.bones.length;h<l;++h)n=this.geometry.bones[h],o=n.pos,a=n.rotq,s=n.scl,r=new t.Bone(this),e.push(r),r.name=n.name,r.position.set(o[0],o[1],o[2]),r.quaternion.set(a[0],a[1],a[2],a[3]),void 0!==s?r.scale.set(s[0],s[1],s[2]):r.scale.set(1,1,1);h=0;for(l=this.geometry.bones.length;h<l;++h)n=this.geometry.bones[h],-1!==n.parent?e[n.parent].add(e[h]):this.add(e[h])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new t.Skeleton(e,(void 0),i))};t.SkinnedMesh.prototype=Object.create(t.Mesh.prototype);t.SkinnedMesh.prototype.constructor=t.SkinnedMesh;t.SkinnedMesh.prototype.bind=function(t,e){this.skeleton=t;void 0===e&&(this.updateMatrixWorld(!0),e=this.matrixWorld);this.bindMatrix.copy(e);this.bindMatrixInverse.getInverse(e)};t.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};t.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof t.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var r=this.geometry.skinWeights[e],i=1/r.lengthManhattan();Infinity!==i?r.multiplyScalar(i):r.set(1)}};t.SkinnedMesh.prototype.updateMatrixWorld=function(e){t.Mesh.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):t.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)};t.SkinnedMesh.prototype.clone=function(e){void 0===e&&(e=new t.SkinnedMesh(this.geometry,this.material,this.useVertexTexture));t.Mesh.prototype.clone.call(this,e);return e};t.MorphAnimMesh=function(e,r){t.Mesh.call(this,e,r);this.type="MorphAnimMesh";this.duration=1e3;this.mirroredLoop=!1;this.currentKeyframe=this.lastKeyframe=this.time=0;this.direction=1;this.directionBackwards=!1;this.setFrameRange(0,this.geometry.morphTargets.length-1)};t.MorphAnimMesh.prototype=Object.create(t.Mesh.prototype);t.MorphAnimMesh.prototype.constructor=t.MorphAnimMesh;t.MorphAnimMesh.prototype.setFrameRange=function(t,e){this.startKeyframe=t;this.endKeyframe=e;this.length=this.endKeyframe-this.startKeyframe+1};t.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=!1};t.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=!0};t.MorphAnimMesh.prototype.parseAnimations=function(){var t=this.geometry;t.animations||(t.animations={});for(var e,r=t.animations,i=/([a-z]+)_?(\d+)/,n=0,o=t.morphTargets.length;n<o;n++){var a=t.morphTargets[n].name.match(i);if(a&&1<a.length){a=a[1];r[a]||(r[a]={start:Infinity,end:-Infinity});var s=r[a];n<s.start&&(s.start=n);n>s.end&&(s.end=n);e||(e=a)}}t.firstAnimation=e};t.MorphAnimMesh.prototype.setAnimationLabel=function(t,e,r){this.geometry.animations||(this.geometry.animations={});this.geometry.animations[t]={start:e,end:r}};t.MorphAnimMesh.prototype.playAnimation=function(e,r){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=(i.end-i.start)/r*1e3,this.time=0):t.warn("THREE.MorphAnimMesh: animation["+e+"] undefined in .playAnimation()")};t.MorphAnimMesh.prototype.updateAnimation=function(e){var r=this.duration/this.length;this.time+=this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||0>this.time)this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)}else this.time%=this.duration,0>this.time&&(this.time+=this.duration);e=this.startKeyframe+t.Math.clamp(Math.floor(this.time/r),0,this.length-1);e!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[e]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=e);r=this.time%r/r;this.directionBackwards&&(r=1-r);this.morphTargetInfluences[this.currentKeyframe]=r;this.morphTargetInfluences[this.lastKeyframe]=1-r};t.MorphAnimMesh.prototype.interpolateTargets=function(t,e,r){for(var i=this.morphTargetInfluences,n=0,o=i.length;n<o;n++)i[n]=0;-1<t&&(i[t]=1-r);-1<e&&(i[e]=r)};t.MorphAnimMesh.prototype.clone=function(e){void 0===e&&(e=new t.MorphAnimMesh(this.geometry,this.material));e.duration=this.duration;e.mirroredLoop=this.mirroredLoop;e.time=this.time;e.lastKeyframe=this.lastKeyframe;e.currentKeyframe=this.currentKeyframe;e.direction=this.direction;e.directionBackwards=this.directionBackwards;t.Mesh.prototype.clone.call(this,e);return e};t.LOD=function(){t.Object3D.call(this);this.objects=[]};t.LOD.prototype=Object.create(t.Object3D.prototype);t.LOD.prototype.constructor=t.LOD;t.LOD.prototype.addLevel=function(t,e){void 0===e&&(e=0);e=Math.abs(e);for(var r=0;r<this.objects.length&&!(e<this.objects[r].distance);r++);this.objects.splice(r,0,{distance:e,object:t});this.add(t)};t.LOD.prototype.getObjectForDistance=function(t){for(var e=1,r=this.objects.length;e<r&&!(t<this.objects[e].distance);e++);return this.objects[e-1].object};t.LOD.prototype.raycast=function(){var e=new t.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(t,r)}}();t.LOD.prototype.update=function(){var e=new t.Vector3,r=new t.Vector3;return function(t){if(1<this.objects.length){e.setFromMatrixPosition(t.matrixWorld);r.setFromMatrixPosition(this.matrixWorld);t=e.distanceTo(r);this.objects[0].object.visible=!0;for(var i=1,n=this.objects.length;i<n;i++)if(t>=this.objects[i].distance)this.objects[i-1].object.visible=!1,this.objects[i].object.visible=!0;else break;for(;i<n;i++)this.objects[i].object.visible=!1}}}();t.LOD.prototype.clone=function(e){void 0===e&&(e=new t.LOD);t.Object3D.prototype.clone.call(this,e);for(var r=0,i=this.objects.length;r<i;r++){var n=this.objects[r].object.clone();n.visible=0===r;e.addLevel(n,this.objects[r].distance)}return e};t.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]),r=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),i=new Float32Array([0,0,1,0,1,1,0,1]),n=new t.BufferGeometry;n.addAttribute("index",new t.BufferAttribute(e,1));n.addAttribute("position",new t.BufferAttribute(r,3));n.addAttribute("uv",new t.BufferAttribute(i,2));return function(e){t.Object3D.call(this);this.type="Sprite";this.geometry=n;this.material=void 0!==e?e:new t.SpriteMaterial}}();t.Sprite.prototype=Object.create(t.Object3D.prototype);t.Sprite.prototype.constructor=t.Sprite;t.Sprite.prototype.raycast=function(){var e=new t.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.distanceToPoint(e);i>this.scale.x||r.push({distance:i,point:this.position,face:null,object:this})}}();t.Sprite.prototype.clone=function(e){void 0===e&&(e=new t.Sprite(this.material));t.Object3D.prototype.clone.call(this,e);return e};t.Particle=t.Sprite;t.LensFlare=function(e,r,i,n,o){t.Object3D.call(this);this.lensFlares=[];this.positionScreen=new t.Vector3;this.customUpdateCallback=void 0;void 0!==e&&this.add(e,r,i,n,o)};t.LensFlare.prototype=Object.create(t.Object3D.prototype);t.LensFlare.prototype.constructor=t.LensFlare;t.LensFlare.prototype.add=function(e,r,i,n,o,a){void 0===r&&(r=-1);void 0===i&&(i=0);void 0===a&&(a=1);void 0===o&&(o=new t.Color(16777215));void 0===n&&(n=t.NormalBlending);i=Math.min(i,Math.max(0,i));this.lensFlares.push({texture:e,size:r,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:a,color:o,blending:n})};t.LensFlare.prototype.updateLensFlares=function(){var t,e=this.lensFlares.length,r,i=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(t=0;t<e;t++)r=this.lensFlares[t],r.x=this.positionScreen.x+i*r.distance,r.y=this.positionScreen.y+n*r.distance,r.wantedRotation=r.x*Math.PI*.25,r.rotation+=.25*(r.wantedRotation-r.rotation)};t.Scene=function(){t.Object3D.call(this);this.type="Scene";this.overrideMaterial=this.fog=null;this.autoUpdate=!0};t.Scene.prototype=Object.create(t.Object3D.prototype);t.Scene.prototype.constructor=t.Scene;t.Scene.prototype.clone=function(e){void 0===e&&(e=new t.Scene);t.Object3D.prototype.clone.call(this,e);null!==this.fog&&(e.fog=this.fog.clone());null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone());e.autoUpdate=this.autoUpdate;e.matrixAutoUpdate=this.matrixAutoUpdate;return e};t.Fog=function(e,r,i){this.name="";this.color=new t.Color(e);this.near=void 0!==r?r:1;this.far=void 0!==i?i:1e3};t.Fog.prototype.clone=function(){return new t.Fog(this.color.getHex(),this.near,this.far)};t.FogExp2=function(e,r){this.name="";this.color=new t.Color(e);this.density=void 0!==r?r:25e-5};t.FogExp2.prototype.clone=function(){return new t.FogExp2(this.color.getHex(),this.density)};t.ShaderChunk={};t.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\n\treturn point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\tif ( decayExponent > 0.0 ) {\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n\t}\n\treturn 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\n";t.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n";t.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack += ambientLightColor;\n\n#endif\n";t.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n";t.ShaderChunk.default_vertex="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n";t.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif";t.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n";t.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif";t.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif";t.ShaderChunk.lights_phong_fragment="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalDiffuseLight += hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\n#ifdef METAL\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n";t.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif";t.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif";t.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n";t.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";t.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n";t.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n";t.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif";t.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif";t.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif";t.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif";t.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif";t.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n";t.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n";t.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\tvColor.xyz = inputToLinear( color.xyz );\n\n#endif";t.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n";t.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n";t.ShaderChunk.linear_to_gamma_fragment="\n\toutgoingLight = linearToOutput( outgoingLight );\n";t.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif";t.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n";
t.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n";t.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n";t.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif";t.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif";t.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif";t.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif";t.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n\t\tfogFactor = whiteCompliment( fogFactor );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif";t.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n";t.ShaderChunk.defaultnormal_vertex="#ifdef USE_SKINNING\n\n\tvec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n\tvec3 objectNormal = morphedNormal;\n\n#else\n\n\tvec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n";t.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n";t.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";t.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";t.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif";t.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";t.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif";t.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif";t.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n";t.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n\tshadowColor = inputToLinear( shadowColor );\n\n\toutgoingLight = outgoingLight * shadowColor;\n\n#endif\n";t.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#elif defined( USE_MORPHTARGETS )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif\n";t.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif";t.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n";t.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif";t.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";t.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n";t.UniformsUtils={merge:function(t){for(var e={},r=0;r<t.length;r++){var i=this.clone(t[r]),n;for(n in i)e[n]=i[n]}return e},clone:function(e){var r={},i;for(i in e){r[i]={};for(var n in e[i]){var o=e[i][n];r[i][n]=o instanceof t.Color||o instanceof t.Vector2||o instanceof t.Vector3||o instanceof t.Vector4||o instanceof t.Matrix4||o instanceof t.Texture?o.clone():o instanceof Array?o.slice():o}}return r}};t.UniformsLib={common:{diffuse:{type:"c",value:new t.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new t.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new t.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new t.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new t.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new t.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new t.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};t.ShaderLib={basic:{uniforms:t.UniformsUtils.merge([t.UniformsLib.common,t.UniformsLib.fog,t.UniformsLib.shadowmap]),vertexShader:[t.ShaderChunk.common,t.ShaderChunk.map_pars_vertex,t.ShaderChunk.lightmap_pars_vertex,t.ShaderChunk.envmap_pars_vertex,t.ShaderChunk.color_pars_vertex,t.ShaderChunk.morphtarget_pars_vertex,t.ShaderChunk.skinning_pars_vertex,t.ShaderChunk.shadowmap_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.map_vertex,t.ShaderChunk.lightmap_vertex,t.ShaderChunk.color_vertex,t.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",t.ShaderChunk.morphnormal_vertex,t.ShaderChunk.skinnormal_vertex,t.ShaderChunk.defaultnormal_vertex,"\t#endif",t.ShaderChunk.morphtarget_vertex,t.ShaderChunk.skinning_vertex,t.ShaderChunk.default_vertex,t.ShaderChunk.logdepthbuf_vertex,t.ShaderChunk.worldpos_vertex,t.ShaderChunk.envmap_vertex,t.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",t.ShaderChunk.common,t.ShaderChunk.color_pars_fragment,t.ShaderChunk.map_pars_fragment,t.ShaderChunk.alphamap_pars_fragment,t.ShaderChunk.lightmap_pars_fragment,t.ShaderChunk.envmap_pars_fragment,t.ShaderChunk.fog_pars_fragment,t.ShaderChunk.shadowmap_pars_fragment,t.ShaderChunk.specularmap_pars_fragment,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );",t.ShaderChunk.logdepthbuf_fragment,t.ShaderChunk.map_fragment,t.ShaderChunk.color_fragment,t.ShaderChunk.alphamap_fragment,t.ShaderChunk.alphatest_fragment,t.ShaderChunk.specularmap_fragment,"\toutgoingLight = diffuseColor.rgb;",t.ShaderChunk.lightmap_fragment,t.ShaderChunk.envmap_fragment,t.ShaderChunk.shadowmap_fragment,t.ShaderChunk.linear_to_gamma_fragment,t.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},lambert:{uniforms:t.UniformsUtils.merge([t.UniformsLib.common,t.UniformsLib.fog,t.UniformsLib.lights,t.UniformsLib.shadowmap,{emissive:{type:"c",value:new t.Color(0)},wrapRGB:{type:"v3",value:new t.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif",t.ShaderChunk.common,t.ShaderChunk.map_pars_vertex,t.ShaderChunk.lightmap_pars_vertex,t.ShaderChunk.envmap_pars_vertex,t.ShaderChunk.lights_lambert_pars_vertex,t.ShaderChunk.color_pars_vertex,t.ShaderChunk.morphtarget_pars_vertex,t.ShaderChunk.skinning_pars_vertex,t.ShaderChunk.shadowmap_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.map_vertex,t.ShaderChunk.lightmap_vertex,t.ShaderChunk.color_vertex,t.ShaderChunk.morphnormal_vertex,t.ShaderChunk.skinbase_vertex,t.ShaderChunk.skinnormal_vertex,t.ShaderChunk.defaultnormal_vertex,t.ShaderChunk.morphtarget_vertex,t.ShaderChunk.skinning_vertex,t.ShaderChunk.default_vertex,t.ShaderChunk.logdepthbuf_vertex,t.ShaderChunk.worldpos_vertex,t.ShaderChunk.envmap_vertex,t.ShaderChunk.lights_lambert_vertex,t.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif",t.ShaderChunk.common,t.ShaderChunk.color_pars_fragment,t.ShaderChunk.map_pars_fragment,t.ShaderChunk.alphamap_pars_fragment,t.ShaderChunk.lightmap_pars_fragment,t.ShaderChunk.envmap_pars_fragment,t.ShaderChunk.fog_pars_fragment,t.ShaderChunk.shadowmap_pars_fragment,t.ShaderChunk.specularmap_pars_fragment,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );",t.ShaderChunk.logdepthbuf_fragment,t.ShaderChunk.map_fragment,t.ShaderChunk.color_fragment,t.ShaderChunk.alphamap_fragment,t.ShaderChunk.alphatest_fragment,t.ShaderChunk.specularmap_fragment,"\t#ifdef DOUBLE_SIDED\n\t\tif ( gl_FrontFacing )\n\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\n\t\telse\n\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;\n\t#else\n\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\n\t#endif",t.ShaderChunk.lightmap_fragment,t.ShaderChunk.envmap_fragment,t.ShaderChunk.shadowmap_fragment,t.ShaderChunk.linear_to_gamma_fragment,t.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},phong:{uniforms:t.UniformsUtils.merge([t.UniformsLib.common,t.UniformsLib.bump,t.UniformsLib.normalmap,t.UniformsLib.fog,t.UniformsLib.lights,t.UniformsLib.shadowmap,{emissive:{type:"c",value:new t.Color(0)},specular:{type:"c",value:new t.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new t.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif",t.ShaderChunk.common,t.ShaderChunk.map_pars_vertex,t.ShaderChunk.lightmap_pars_vertex,t.ShaderChunk.envmap_pars_vertex,t.ShaderChunk.lights_phong_pars_vertex,t.ShaderChunk.color_pars_vertex,t.ShaderChunk.morphtarget_pars_vertex,t.ShaderChunk.skinning_pars_vertex,t.ShaderChunk.shadowmap_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.map_vertex,t.ShaderChunk.lightmap_vertex,t.ShaderChunk.color_vertex,t.ShaderChunk.morphnormal_vertex,t.ShaderChunk.skinbase_vertex,t.ShaderChunk.skinnormal_vertex,t.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif",t.ShaderChunk.morphtarget_vertex,t.ShaderChunk.skinning_vertex,t.ShaderChunk.default_vertex,t.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = -mvPosition.xyz;",t.ShaderChunk.worldpos_vertex,t.ShaderChunk.envmap_vertex,t.ShaderChunk.lights_phong_vertex,t.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;",t.ShaderChunk.common,t.ShaderChunk.color_pars_fragment,t.ShaderChunk.map_pars_fragment,t.ShaderChunk.alphamap_pars_fragment,t.ShaderChunk.lightmap_pars_fragment,t.ShaderChunk.envmap_pars_fragment,t.ShaderChunk.fog_pars_fragment,t.ShaderChunk.lights_phong_pars_fragment,t.ShaderChunk.shadowmap_pars_fragment,t.ShaderChunk.bumpmap_pars_fragment,t.ShaderChunk.normalmap_pars_fragment,t.ShaderChunk.specularmap_pars_fragment,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );",t.ShaderChunk.logdepthbuf_fragment,t.ShaderChunk.map_fragment,t.ShaderChunk.color_fragment,t.ShaderChunk.alphamap_fragment,t.ShaderChunk.alphatest_fragment,t.ShaderChunk.specularmap_fragment,t.ShaderChunk.lights_phong_fragment,t.ShaderChunk.lightmap_fragment,t.ShaderChunk.envmap_fragment,t.ShaderChunk.shadowmap_fragment,t.ShaderChunk.linear_to_gamma_fragment,t.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},particle_basic:{uniforms:t.UniformsUtils.merge([t.UniformsLib.particle,t.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",t.ShaderChunk.common,t.ShaderChunk.color_pars_vertex,t.ShaderChunk.shadowmap_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\tgl_Position = projectionMatrix * mvPosition;",t.ShaderChunk.logdepthbuf_vertex,t.ShaderChunk.worldpos_vertex,t.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",t.ShaderChunk.common,t.ShaderChunk.color_pars_fragment,t.ShaderChunk.map_particle_pars_fragment,t.ShaderChunk.fog_pars_fragment,t.ShaderChunk.shadowmap_pars_fragment,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( psColor, opacity );",t.ShaderChunk.logdepthbuf_fragment,t.ShaderChunk.map_particle_fragment,t.ShaderChunk.color_fragment,t.ShaderChunk.alphatest_fragment,"\toutgoingLight = diffuseColor.rgb;",t.ShaderChunk.shadowmap_fragment,t.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},dashed:{uniforms:t.UniformsUtils.merge([t.UniformsLib.common,t.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",t.ShaderChunk.common,t.ShaderChunk.color_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;",t.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",t.ShaderChunk.common,t.ShaderChunk.color_pars_fragment,t.ShaderChunk.fog_pars_fragment,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );",t.ShaderChunk.logdepthbuf_fragment,t.ShaderChunk.color_fragment,"\toutgoingLight = diffuseColor.rgb;",t.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[t.ShaderChunk.common,t.ShaderChunk.morphtarget_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.morphtarget_vertex,t.ShaderChunk.default_vertex,t.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;\nuniform float mFar;\nuniform float opacity;",t.ShaderChunk.common,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",t.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\n\tgl_FragColor = vec4( vec3( color ), opacity );\n}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",t.ShaderChunk.common,t.ShaderChunk.morphtarget_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n\tvNormal = normalize( normalMatrix * normal );",t.ShaderChunk.morphtarget_vertex,t.ShaderChunk.default_vertex,t.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),
fragmentShader:["uniform float opacity;\nvarying vec3 vNormal;",t.ShaderChunk.common,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",t.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",t.ShaderChunk.common,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",t.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",t.ShaderChunk.common,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",t.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",t.ShaderChunk.common,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",t.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",t.ShaderChunk.common,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\nvec3 direction = normalize( vWorldPosition );\nvec2 sampleUV;\nsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\nsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\ngl_FragColor = texture2D( tEquirect, sampleUV );",t.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[t.ShaderChunk.common,t.ShaderChunk.morphtarget_pars_vertex,t.ShaderChunk.skinning_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.skinbase_vertex,t.ShaderChunk.morphtarget_vertex,t.ShaderChunk.skinning_vertex,t.ShaderChunk.default_vertex,t.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[t.ShaderChunk.common,t.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\nvoid main() {",t.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\n\t#else\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n\t#endif\n}"].join("\n")}};t.WebGLRenderer=function(e){function r(t){var e=t.geometry;t=t.material;var r=e.vertices.length;if(t.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var i in t.attributes){var n=t.attributes[i];if(!n.__webglInitialized||n.createUniqueBuffers){n.__webglInitialized=!0;var o=1;"v2"===n.type?o=2:"v3"===n.type?o=3:"v4"===n.type?o=4:"c"===n.type&&(o=3);n.size=o;n.array=new Float32Array(r*o);n.buffer=mt.createBuffer();n.buffer.belongsToAttribute=i;n.needsUpdate=!0}e.__webglCustomAttributesList.push(n)}}}function i(e,r){return e.material instanceof t.MeshFaceMaterial?e.material.materials[r.materialIndex]:e.material}function n(t,e,r,i){r=r.attributes;var n=e.attributes;e=e.attributesKeys;for(var o=0,a=e.length;o<a;o++){var s=e[o],h=n[s];if(0<=h){var l=r[s];void 0!==l?(s=l.itemSize,mt.bindBuffer(mt.ARRAY_BUFFER,l.buffer),vt.enableAttribute(h),mt.vertexAttribPointer(h,s,mt.FLOAT,!1,0,i*s*4)):void 0!==t.defaultAttributeValues&&(2===t.defaultAttributeValues[s].length?mt.vertexAttrib2fv(h,t.defaultAttributeValues[s]):3===t.defaultAttributeValues[s].length&&mt.vertexAttrib3fv(h,t.defaultAttributeValues[s]))}}vt.disableUnusedAttributes()}function o(t,e){return t.object.renderOrder!==e.object.renderOrder?t.object.renderOrder-e.object.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function a(t,e){return t.object.renderOrder!==e.object.renderOrder?t.object.renderOrder-e.object.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function s(t,e){return e[0]-t[0]}function h(e){if(!1!==e.visible){if(!(e instanceof t.Scene||e instanceof t.Group)){void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new t.Matrix4,e._normalMatrix=new t.Matrix3,e.addEventListener("removed",Nt));var i=e.geometry;if(void 0!==i&&void 0===i.__webglInit)if(i.__webglInit=!0,i.addEventListener("dispose",Ot),i instanceof t.BufferGeometry)K.info.memory.geometries++;else if(e instanceof t.Mesh)f(e,i);else if(e instanceof t.Line){if(void 0===i.__webglVertexBuffer){i.__webglVertexBuffer=mt.createBuffer();i.__webglColorBuffer=mt.createBuffer();i.__webglLineDistanceBuffer=mt.createBuffer();K.info.memory.geometries++;var n=i.vertices.length;i.__vertexArray=new Float32Array(3*n);i.__colorArray=new Float32Array(3*n);i.__lineDistanceArray=new Float32Array(1*n);i.__webglLineCount=n;r(e);i.verticesNeedUpdate=!0;i.colorsNeedUpdate=!0;i.lineDistancesNeedUpdate=!0}}else e instanceof t.PointCloud&&void 0===i.__webglVertexBuffer&&(i.__webglVertexBuffer=mt.createBuffer(),i.__webglColorBuffer=mt.createBuffer(),K.info.memory.geometries++,n=i.vertices.length,i.__vertexArray=new Float32Array(3*n),i.__colorArray=new Float32Array(3*n),i.__webglParticleCount=n,r(e),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0);if(void 0===e.__webglActive)if(e.__webglActive=!0,e instanceof t.Mesh)if(i instanceof t.BufferGeometry)p(H,i,e);else{if(i instanceof t.Geometry)for(var i=Xt[i.id],n=0,o=i.length;n<o;n++)p(H,i[n],e)}else e instanceof t.Line||e instanceof t.PointCloud?p(H,i,e):(e instanceof t.ImmediateRenderObject||e.immediateRenderCallback)&&W.push({id:null,object:e,opaque:null,transparent:null,z:0});if(e instanceof t.Light)G.push(e);else if(e instanceof t.Sprite)q.push(e);else if(e instanceof t.LensFlare)Y.push(e);else if((i=H[e.id])&&(!1===e.frustumCulled||!0===lt.intersectsObject(e)))for(n=0,o=i.length;n<o;n++){var a=i[n],s=a,l=s.object,c=s.buffer,u=l.geometry,l=l.material;l instanceof t.MeshFaceMaterial?(l=l.materials[u instanceof t.BufferGeometry?0:c.materialIndex],s.material=l,l.transparent?X.push(s):j.push(s)):l&&(s.material=l,l.transparent?X.push(s):j.push(s));a.render=!0;!0===K.sortObjects&&(ut.setFromMatrixPosition(e.matrixWorld),ut.applyProjection(ct),a.z=ut.z)}}n=0;for(o=e.children.length;n<o;n++)h(e.children[n])}}function l(e,r,i,n,o){for(var a,s=0,h=e.length;s<h;s++){a=e[s];var l=a.object,c=a.buffer;_(l,r);if(o)a=o;else{a=a.material;if(!a)continue;y(a)}K.setMaterialFaces(a);c instanceof t.BufferGeometry?K.renderBufferDirect(r,i,n,a,c,l):K.renderBuffer(r,i,n,a,c,l)}}function c(t,e,r,i,n,o){for(var a,s=0,h=t.length;s<h;s++){a=t[s];var l=a.object;if(l.visible){if(o)a=o;else{a=a[e];if(!a)continue;y(a)}K.renderImmediateObject(r,i,n,a,l)}}}function u(t){var e=t.object.material;e.transparent?(t.transparent=e,t.opaque=null):(t.opaque=e,t.transparent=null)}function f(e,r){var n=e.material,o=!1;if(void 0===Xt[r.id]||!0===r.groupsNeedUpdate){delete H[e.id];for(var a=Xt,s=r.id,n=n instanceof t.MeshFaceMaterial,h=xt.get("OES_element_index_uint")?4294967296:65535,l,o={},c=r.morphTargets.length,u=r.morphNormals.length,f,d={},m=[],g=0,y=r.faces.length;g<y;g++){l=r.faces[g];var v=n?l.materialIndex:0;v in o||(o[v]={hash:v,counter:0});l=o[v].hash+"_"+o[v].counter;l in d||(f={id:qt++,faces3:[],materialIndex:v,vertices:0,numMorphTargets:c,numMorphNormals:u},d[l]=f,m.push(f));d[l].vertices+3>h&&(o[v].counter+=1,l=o[v].hash+"_"+o[v].counter,l in d||(f={id:qt++,faces3:[],materialIndex:v,vertices:0,numMorphTargets:c,numMorphNormals:u},d[l]=f,m.push(f)));d[l].faces3.push(g);d[l].vertices+=3}a[s]=m;r.groupsNeedUpdate=!1}a=Xt[r.id];s=0;for(n=a.length;s<n;s++){h=a[s];if(void 0===h.__webglVertexBuffer){o=h;o.__webglVertexBuffer=mt.createBuffer();o.__webglNormalBuffer=mt.createBuffer();o.__webglTangentBuffer=mt.createBuffer();o.__webglColorBuffer=mt.createBuffer();o.__webglUVBuffer=mt.createBuffer();o.__webglUV2Buffer=mt.createBuffer();o.__webglSkinIndicesBuffer=mt.createBuffer();o.__webglSkinWeightsBuffer=mt.createBuffer();o.__webglFaceBuffer=mt.createBuffer();o.__webglLineBuffer=mt.createBuffer();if(u=o.numMorphTargets)for(o.__webglMorphTargetsBuffers=[],c=0;c<u;c++)o.__webglMorphTargetsBuffers.push(mt.createBuffer());if(u=o.numMorphNormals)for(o.__webglMorphNormalsBuffers=[],c=0;c<u;c++)o.__webglMorphNormalsBuffers.push(mt.createBuffer());K.info.memory.geometries++;o=h;g=e;y=g.geometry;u=o.faces3;c=3*u.length;d=1*u.length;m=3*u.length;u=i(g,o);o.__vertexArray=new Float32Array(3*c);o.__normalArray=new Float32Array(3*c);o.__colorArray=new Float32Array(3*c);o.__uvArray=new Float32Array(2*c);1<y.faceVertexUvs.length&&(o.__uv2Array=new Float32Array(2*c));y.hasTangents&&(o.__tangentArray=new Float32Array(4*c));g.geometry.skinWeights.length&&g.geometry.skinIndices.length&&(o.__skinIndexArray=new Float32Array(4*c),o.__skinWeightArray=new Float32Array(4*c));g=null!==xt.get("OES_element_index_uint")&&21845<d?Uint32Array:Uint16Array;o.__typeArray=g;o.__faceArray=new g(3*d);o.__lineArray=new g(2*m);if(y=o.numMorphTargets)for(o.__morphTargetsArrays=[],g=0;g<y;g++)o.__morphTargetsArrays.push(new Float32Array(3*c));if(y=o.numMorphNormals)for(o.__morphNormalsArrays=[],g=0;g<y;g++)o.__morphNormalsArrays.push(new Float32Array(3*c));o.__webglFaceCount=3*d;o.__webglLineCount=2*m;if(u.attributes)for(d in void 0===o.__webglCustomAttributesList&&(o.__webglCustomAttributesList=[]),d=void 0,u.attributes){var m=u.attributes[d],g={},x;for(x in m)g[x]=m[x];if(!g.__webglInitialized||g.createUniqueBuffers)g.__webglInitialized=!0,y=1,"v2"===g.type?y=2:"v3"===g.type?y=3:"v4"===g.type?y=4:"c"===g.type&&(y=3),g.size=y,g.array=new Float32Array(c*y),g.buffer=mt.createBuffer(),g.buffer.belongsToAttribute=d,m.needsUpdate=!0,g.__original=m;o.__webglCustomAttributesList.push(g)}o.__inittedArrays=!0;r.verticesNeedUpdate=!0;r.morphTargetsNeedUpdate=!0;r.elementsNeedUpdate=!0;r.uvsNeedUpdate=!0;r.normalsNeedUpdate=!0;r.tangentsNeedUpdate=!0;o=r.colorsNeedUpdate=!0}else o=!1;(o||void 0===e.__webglActive)&&p(H,h,e)}e.__webglActive=!0}function p(t,e,r){var i=r.id;t[i]=t[i]||[];t[i].push({id:i,buffer:e,object:r,material:null,z:0})}function d(e){var r=e.geometry;if(r instanceof t.BufferGeometry)for(var n=r.attributes,o=r.attributesKeys,a=0,s=o.length;a<s;a++){var h=o[a],l=n[h],c="index"===h?mt.ELEMENT_ARRAY_BUFFER:mt.ARRAY_BUFFER;void 0===l.buffer?(l.buffer=mt.createBuffer(),mt.bindBuffer(c,l.buffer),mt.bufferData(c,l.array,l instanceof t.DynamicBufferAttribute?mt.DYNAMIC_DRAW:mt.STATIC_DRAW),l.needsUpdate=!1):!0===l.needsUpdate&&(mt.bindBuffer(c,l.buffer),void 0===l.updateRange||-1===l.updateRange.count?mt.bufferSubData(c,0,l.array):0===l.updateRange.count?console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually."):(mt.bufferSubData(c,l.updateRange.offset*l.array.BYTES_PER_ELEMENT,l.array.subarray(l.updateRange.offset,l.updateRange.offset+l.updateRange.count)),l.updateRange.count=0),l.needsUpdate=!1)}else if(e instanceof t.Mesh){!0===r.groupsNeedUpdate&&f(e,r);for(var u=Xt[r.id],a=0,p=u.length;a<p;a++){var d=u[a],y=i(e,d),v=y.attributes&&m(y);if(r.verticesNeedUpdate||r.morphTargetsNeedUpdate||r.elementsNeedUpdate||r.uvsNeedUpdate||r.normalsNeedUpdate||r.colorsNeedUpdate||r.tangentsNeedUpdate||v){var x=d,b=e,_=mt.DYNAMIC_DRAW,w=!r.dynamic,M=y;if(x.__inittedArrays){var S=!1===M instanceof t.MeshPhongMaterial&&M.shading===t.FlatShading,T=void 0,E=void 0,A=void 0,C=void 0,L=void 0,P=void 0,R=void 0,F=void 0,U=void 0,B=void 0,D=void 0,V=void 0,z=void 0,k=void 0,N=void 0,O=void 0,I=void 0,G=void 0,H=void 0,W=void 0,j=void 0,X=void 0,q=void 0,Y=void 0,K=void 0,Q=void 0,Z=void 0,J=void 0,$=void 0,tt=void 0,et=void 0,rt=void 0,it=void 0,nt=void 0,ot=void 0,at=void 0,st=void 0,ht=void 0,lt=void 0,ct=void 0,ut=0,ft=0,pt=0,dt=0,gt=0,yt=0,vt=0,xt=0,bt=0,_t=0,wt=0,Mt=0,St=void 0,Tt=x.__vertexArray,Et=x.__uvArray,At=x.__uv2Array,Ct=x.__normalArray,Lt=x.__tangentArray,Pt=x.__colorArray,Rt=x.__skinIndexArray,Ft=x.__skinWeightArray,Ut=x.__morphTargetsArrays,Bt=x.__morphNormalsArrays,Dt=x.__webglCustomAttributesList,Vt=void 0,zt=x.__faceArray,kt=x.__lineArray,Nt=b.geometry,Ot=Nt.elementsNeedUpdate,It=Nt.uvsNeedUpdate,Gt=Nt.normalsNeedUpdate,Ht=Nt.tangentsNeedUpdate,Wt=Nt.colorsNeedUpdate,jt=Nt.morphTargetsNeedUpdate,qt=Nt.vertices,Yt=x.faces3,Kt=Nt.faces,Qt=Nt.faceVertexUvs[0],Zt=Nt.faceVertexUvs[1],Jt=Nt.skinIndices,$t=Nt.skinWeights,te=Nt.morphTargets,ee=Nt.morphNormals;if(Nt.verticesNeedUpdate){T=0;for(E=Yt.length;T<E;T++)C=Kt[Yt[T]],V=qt[C.a],z=qt[C.b],k=qt[C.c],Tt[ft]=V.x,Tt[ft+1]=V.y,Tt[ft+2]=V.z,Tt[ft+3]=z.x,Tt[ft+4]=z.y,Tt[ft+5]=z.z,Tt[ft+6]=k.x,Tt[ft+7]=k.y,Tt[ft+8]=k.z,ft+=9;mt.bindBuffer(mt.ARRAY_BUFFER,x.__webglVertexBuffer);mt.bufferData(mt.ARRAY_BUFFER,Tt,_)}if(jt)for(ot=0,at=te.length;ot<at;ot++){T=wt=0;for(E=Yt.length;T<E;T++)lt=Yt[T],C=Kt[lt],V=te[ot].vertices[C.a],z=te[ot].vertices[C.b],k=te[ot].vertices[C.c],st=Ut[ot],st[wt]=V.x,st[wt+1]=V.y,st[wt+2]=V.z,st[wt+3]=z.x,st[wt+4]=z.y,st[wt+5]=z.z,st[wt+6]=k.x,st[wt+7]=k.y,st[wt+8]=k.z,M.morphNormals&&(S?W=H=G=ee[ot].faceNormals[lt]:(ct=ee[ot].vertexNormals[lt],G=ct.a,H=ct.b,W=ct.c),ht=Bt[ot],ht[wt]=G.x,ht[wt+1]=G.y,ht[wt+2]=G.z,ht[wt+3]=H.x,ht[wt+4]=H.y,ht[wt+5]=H.z,ht[wt+6]=W.x,ht[wt+7]=W.y,ht[wt+8]=W.z),wt+=9;mt.bindBuffer(mt.ARRAY_BUFFER,x.__webglMorphTargetsBuffers[ot]);mt.bufferData(mt.ARRAY_BUFFER,Ut[ot],_);M.morphNormals&&(mt.bindBuffer(mt.ARRAY_BUFFER,x.__webglMorphNormalsBuffers[ot]),mt.bufferData(mt.ARRAY_BUFFER,Bt[ot],_))}if($t.length){T=0;for(E=Yt.length;T<E;T++)C=Kt[Yt[T]],Y=$t[C.a],K=$t[C.b],Q=$t[C.c],Ft[_t]=Y.x,Ft[_t+1]=Y.y,Ft[_t+2]=Y.z,Ft[_t+3]=Y.w,Ft[_t+4]=K.x,Ft[_t+5]=K.y,Ft[_t+6]=K.z,Ft[_t+7]=K.w,Ft[_t+8]=Q.x,Ft[_t+9]=Q.y,Ft[_t+10]=Q.z,Ft[_t+11]=Q.w,Z=Jt[C.a],J=Jt[C.b],$=Jt[C.c],Rt[_t]=Z.x,Rt[_t+1]=Z.y,Rt[_t+2]=Z.z,Rt[_t+3]=Z.w,Rt[_t+4]=J.x,Rt[_t+5]=J.y,Rt[_t+6]=J.z,Rt[_t+7]=J.w,Rt[_t+8]=$.x,Rt[_t+9]=$.y,Rt[_t+10]=$.z,Rt[_t+11]=$.w,_t+=12;0<_t&&(mt.bindBuffer(mt.ARRAY_BUFFER,x.__webglSkinIndicesBuffer),mt.bufferData(mt.ARRAY_BUFFER,Rt,_),mt.bindBuffer(mt.ARRAY_BUFFER,x.__webglSkinWeightsBuffer),mt.bufferData(mt.ARRAY_BUFFER,Ft,_))}if(Wt){T=0;for(E=Yt.length;T<E;T++)C=Kt[Yt[T]],R=C.vertexColors,F=C.color,3===R.length&&M.vertexColors===t.VertexColors?(j=R[0],X=R[1],q=R[2]):q=X=j=F,Pt[bt]=j.r,Pt[bt+1]=j.g,Pt[bt+2]=j.b,Pt[bt+3]=X.r,Pt[bt+4]=X.g,Pt[bt+5]=X.b,Pt[bt+6]=q.r,Pt[bt+7]=q.g,Pt[bt+8]=q.b,bt+=9;0<bt&&(mt.bindBuffer(mt.ARRAY_BUFFER,x.__webglColorBuffer),mt.bufferData(mt.ARRAY_BUFFER,Pt,_))}if(Ht&&Nt.hasTangents){T=0;for(E=Yt.length;T<E;T++)C=Kt[Yt[T]],U=C.vertexTangents,N=U[0],O=U[1],I=U[2],Lt[vt]=N.x,Lt[vt+1]=N.y,Lt[vt+2]=N.z,Lt[vt+3]=N.w,Lt[vt+4]=O.x,Lt[vt+5]=O.y,Lt[vt+6]=O.z,Lt[vt+7]=O.w,Lt[vt+8]=I.x,Lt[vt+9]=I.y,Lt[vt+10]=I.z,Lt[vt+11]=I.w,vt+=12;mt.bindBuffer(mt.ARRAY_BUFFER,x.__webglTangentBuffer);mt.bufferData(mt.ARRAY_BUFFER,Lt,_)}if(Gt){T=0;for(E=Yt.length;T<E;T++)if(C=Kt[Yt[T]],L=C.vertexNormals,P=C.normal,3===L.length&&!1===S)for(tt=0;3>tt;tt++)rt=L[tt],Ct[yt]=rt.x,Ct[yt+1]=rt.y,Ct[yt+2]=rt.z,yt+=3;else for(tt=0;3>tt;tt++)Ct[yt]=P.x,Ct[yt+1]=P.y,Ct[yt+2]=P.z,yt+=3;mt.bindBuffer(mt.ARRAY_BUFFER,x.__webglNormalBuffer);mt.bufferData(mt.ARRAY_BUFFER,Ct,_)}if(It&&Qt){T=0;for(E=Yt.length;T<E;T++)if(A=Yt[T],B=Qt[A],void 0!==B)for(tt=0;3>tt;tt++)it=B[tt],Et[pt]=it.x,Et[pt+1]=it.y,pt+=2;0<pt&&(mt.bindBuffer(mt.ARRAY_BUFFER,x.__webglUVBuffer),mt.bufferData(mt.ARRAY_BUFFER,Et,_))}if(It&&Zt){T=0;for(E=Yt.length;T<E;T++)if(A=Yt[T],D=Zt[A],void 0!==D)for(tt=0;3>tt;tt++)nt=D[tt],At[dt]=nt.x,At[dt+1]=nt.y,dt+=2;0<dt&&(mt.bindBuffer(mt.ARRAY_BUFFER,x.__webglUV2Buffer),mt.bufferData(mt.ARRAY_BUFFER,At,_))}if(Ot){T=0;for(E=Yt.length;T<E;T++)zt[gt]=ut,zt[gt+1]=ut+1,zt[gt+2]=ut+2,gt+=3,kt[xt]=ut,kt[xt+1]=ut+1,kt[xt+2]=ut,kt[xt+3]=ut+2,kt[xt+4]=ut+1,kt[xt+5]=ut+2,xt+=6,ut+=3;mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,x.__webglFaceBuffer);mt.bufferData(mt.ELEMENT_ARRAY_BUFFER,zt,_);mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,x.__webglLineBuffer);mt.bufferData(mt.ELEMENT_ARRAY_BUFFER,kt,_)}if(Dt)for(tt=0,et=Dt.length;tt<et;tt++)if(Vt=Dt[tt],Vt.__original.needsUpdate){Mt=0;if(1===Vt.size)if(void 0===Vt.boundTo||"vertices"===Vt.boundTo)for(T=0,E=Yt.length;T<E;T++)C=Kt[Yt[T]],Vt.array[Mt]=Vt.value[C.a],Vt.array[Mt+1]=Vt.value[C.b],Vt.array[Mt+2]=Vt.value[C.c],Mt+=3;else{if("faces"===Vt.boundTo)for(T=0,E=Yt.length;T<E;T++)St=Vt.value[Yt[T]],Vt.array[Mt]=St,Vt.array[Mt+1]=St,Vt.array[Mt+2]=St,Mt+=3}else if(2===Vt.size)if(void 0===Vt.boundTo||"vertices"===Vt.boundTo)for(T=0,E=Yt.length;T<E;T++)C=Kt[Yt[T]],V=Vt.value[C.a],z=Vt.value[C.b],k=Vt.value[C.c],Vt.array[Mt]=V.x,Vt.array[Mt+1]=V.y,Vt.array[Mt+2]=z.x,Vt.array[Mt+3]=z.y,Vt.array[Mt+4]=k.x,Vt.array[Mt+5]=k.y,Mt+=6;else{if("faces"===Vt.boundTo)for(T=0,E=Yt.length;T<E;T++)k=z=V=St=Vt.value[Yt[T]],Vt.array[Mt]=V.x,Vt.array[Mt+1]=V.y,Vt.array[Mt+2]=z.x,Vt.array[Mt+3]=z.y,Vt.array[Mt+4]=k.x,Vt.array[Mt+5]=k.y,Mt+=6}else if(3===Vt.size){var re;re="c"===Vt.type?["r","g","b"]:["x","y","z"];if(void 0===Vt.boundTo||"vertices"===Vt.boundTo)for(T=0,E=Yt.length;T<E;T++)C=Kt[Yt[T]],V=Vt.value[C.a],z=Vt.value[C.b],k=Vt.value[C.c],Vt.array[Mt]=V[re[0]],Vt.array[Mt+1]=V[re[1]],Vt.array[Mt+2]=V[re[2]],Vt.array[Mt+3]=z[re[0]],Vt.array[Mt+4]=z[re[1]],Vt.array[Mt+5]=z[re[2]],Vt.array[Mt+6]=k[re[0]],Vt.array[Mt+7]=k[re[1]],Vt.array[Mt+8]=k[re[2]],Mt+=9;else if("faces"===Vt.boundTo)for(T=0,E=Yt.length;T<E;T++)k=z=V=St=Vt.value[Yt[T]],Vt.array[Mt]=V[re[0]],Vt.array[Mt+1]=V[re[1]],Vt.array[Mt+2]=V[re[2]],Vt.array[Mt+3]=z[re[0]],Vt.array[Mt+4]=z[re[1]],Vt.array[Mt+5]=z[re[2]],Vt.array[Mt+6]=k[re[0]],Vt.array[Mt+7]=k[re[1]],Vt.array[Mt+8]=k[re[2]],Mt+=9;else if("faceVertices"===Vt.boundTo)for(T=0,E=Yt.length;T<E;T++)St=Vt.value[Yt[T]],V=St[0],z=St[1],k=St[2],Vt.array[Mt]=V[re[0]],Vt.array[Mt+1]=V[re[1]],Vt.array[Mt+2]=V[re[2]],Vt.array[Mt+3]=z[re[0]],Vt.array[Mt+4]=z[re[1]],Vt.array[Mt+5]=z[re[2]],Vt.array[Mt+6]=k[re[0]],Vt.array[Mt+7]=k[re[1]],Vt.array[Mt+8]=k[re[2]],Mt+=9}else if(4===Vt.size)if(void 0===Vt.boundTo||"vertices"===Vt.boundTo)for(T=0,E=Yt.length;T<E;T++)C=Kt[Yt[T]],V=Vt.value[C.a],z=Vt.value[C.b],k=Vt.value[C.c],Vt.array[Mt]=V.x,Vt.array[Mt+1]=V.y,Vt.array[Mt+2]=V.z,Vt.array[Mt+3]=V.w,Vt.array[Mt+4]=z.x,Vt.array[Mt+5]=z.y,Vt.array[Mt+6]=z.z,Vt.array[Mt+7]=z.w,Vt.array[Mt+8]=k.x,Vt.array[Mt+9]=k.y,Vt.array[Mt+10]=k.z,Vt.array[Mt+11]=k.w,Mt+=12;else if("faces"===Vt.boundTo)for(T=0,E=Yt.length;T<E;T++)k=z=V=St=Vt.value[Yt[T]],Vt.array[Mt]=V.x,Vt.array[Mt+1]=V.y,Vt.array[Mt+2]=V.z,Vt.array[Mt+3]=V.w,Vt.array[Mt+4]=z.x,Vt.array[Mt+5]=z.y,Vt.array[Mt+6]=z.z,Vt.array[Mt+7]=z.w,Vt.array[Mt+8]=k.x,Vt.array[Mt+9]=k.y,Vt.array[Mt+10]=k.z,Vt.array[Mt+11]=k.w,Mt+=12;else if("faceVertices"===Vt.boundTo)for(T=0,E=Yt.length;T<E;T++)St=Vt.value[Yt[T]],V=St[0],z=St[1],k=St[2],Vt.array[Mt]=V.x,Vt.array[Mt+1]=V.y,Vt.array[Mt+2]=V.z,Vt.array[Mt+3]=V.w,Vt.array[Mt+4]=z.x,Vt.array[Mt+5]=z.y,Vt.array[Mt+6]=z.z,Vt.array[Mt+7]=z.w,Vt.array[Mt+8]=k.x,Vt.array[Mt+9]=k.y,Vt.array[Mt+10]=k.z,Vt.array[Mt+11]=k.w,Mt+=12;mt.bindBuffer(mt.ARRAY_BUFFER,Vt.buffer);mt.bufferData(mt.ARRAY_BUFFER,Vt.array,_)}w&&(delete x.__inittedArrays,delete x.__colorArray,delete x.__normalArray,delete x.__tangentArray,delete x.__uvArray,delete x.__uv2Array,delete x.__faceArray,delete x.__vertexArray,delete x.__lineArray,delete x.__skinIndexArray,delete x.__skinWeightArray)}}}r.verticesNeedUpdate=!1;r.morphTargetsNeedUpdate=!1;r.elementsNeedUpdate=!1;r.uvsNeedUpdate=!1;r.normalsNeedUpdate=!1;r.colorsNeedUpdate=!1;r.tangentsNeedUpdate=!1;y.attributes&&g(y)}else if(e instanceof t.Line){y=i(e,r);v=y.attributes&&m(y);if(r.verticesNeedUpdate||r.colorsNeedUpdate||r.lineDistancesNeedUpdate||v){var ie=mt.DYNAMIC_DRAW,ne,oe,ae,se,he,le,ce=r.vertices,ue=r.colors,fe=r.lineDistances,pe=ce.length,de=ue.length,me=fe.length,ge=r.__vertexArray,ye=r.__colorArray,ve=r.__lineDistanceArray,xe=r.colorsNeedUpdate,be=r.lineDistancesNeedUpdate,_e=r.__webglCustomAttributesList,we,Me,Se,Te,Ee,Ae;if(r.verticesNeedUpdate){for(ne=0;ne<pe;ne++)se=ce[ne],he=3*ne,ge[he]=se.x,ge[he+1]=se.y,ge[he+2]=se.z;mt.bindBuffer(mt.ARRAY_BUFFER,r.__webglVertexBuffer);mt.bufferData(mt.ARRAY_BUFFER,ge,ie)}if(xe){for(oe=0;oe<de;oe++)le=ue[oe],he=3*oe,ye[he]=le.r,ye[he+1]=le.g,ye[he+2]=le.b;mt.bindBuffer(mt.ARRAY_BUFFER,r.__webglColorBuffer);mt.bufferData(mt.ARRAY_BUFFER,ye,ie)}if(be){for(ae=0;ae<me;ae++)ve[ae]=fe[ae];mt.bindBuffer(mt.ARRAY_BUFFER,r.__webglLineDistanceBuffer);mt.bufferData(mt.ARRAY_BUFFER,ve,ie)}if(_e)for(we=0,Me=_e.length;we<Me;we++)if(Ae=_e[we],Ae.needsUpdate&&(void 0===Ae.boundTo||"vertices"===Ae.boundTo)){he=0;Te=Ae.value.length;if(1===Ae.size)for(Se=0;Se<Te;Se++)Ae.array[Se]=Ae.value[Se];else if(2===Ae.size)for(Se=0;Se<Te;Se++)Ee=Ae.value[Se],Ae.array[he]=Ee.x,Ae.array[he+1]=Ee.y,he+=2;else if(3===Ae.size)if("c"===Ae.type)for(Se=0;Se<Te;Se++)Ee=Ae.value[Se],Ae.array[he]=Ee.r,Ae.array[he+1]=Ee.g,Ae.array[he+2]=Ee.b,he+=3;else for(Se=0;Se<Te;Se++)Ee=Ae.value[Se],Ae.array[he]=Ee.x,Ae.array[he+1]=Ee.y,Ae.array[he+2]=Ee.z,he+=3;else if(4===Ae.size)for(Se=0;Se<Te;Se++)Ee=Ae.value[Se],Ae.array[he]=Ee.x,Ae.array[he+1]=Ee.y,Ae.array[he+2]=Ee.z,Ae.array[he+3]=Ee.w,he+=4;mt.bindBuffer(mt.ARRAY_BUFFER,Ae.buffer);mt.bufferData(mt.ARRAY_BUFFER,Ae.array,ie);Ae.needsUpdate=!1}}r.verticesNeedUpdate=!1;r.colorsNeedUpdate=!1;r.lineDistancesNeedUpdate=!1;y.attributes&&g(y)}else if(e instanceof t.PointCloud){y=i(e,r);v=y.attributes&&m(y);if(r.verticesNeedUpdate||r.colorsNeedUpdate||v){var Ce=mt.DYNAMIC_DRAW,Le,Pe,Re,Fe,Ue,Be=r.vertices,De=Be.length,Ve=r.colors,ze=Ve.length,ke=r.__vertexArray,Ne=r.__colorArray,Oe=r.colorsNeedUpdate,Ie=r.__webglCustomAttributesList,Ge,He,We,je,Xe,qe;if(r.verticesNeedUpdate){for(Le=0;Le<De;Le++)Re=Be[Le],Fe=3*Le,ke[Fe]=Re.x,ke[Fe+1]=Re.y,ke[Fe+2]=Re.z;mt.bindBuffer(mt.ARRAY_BUFFER,r.__webglVertexBuffer);mt.bufferData(mt.ARRAY_BUFFER,ke,Ce)}if(Oe){for(Pe=0;Pe<ze;Pe++)Ue=Ve[Pe],Fe=3*Pe,Ne[Fe]=Ue.r,Ne[Fe+1]=Ue.g,Ne[Fe+2]=Ue.b;mt.bindBuffer(mt.ARRAY_BUFFER,r.__webglColorBuffer);mt.bufferData(mt.ARRAY_BUFFER,Ne,Ce)}if(Ie)for(Ge=0,He=Ie.length;Ge<He;Ge++){qe=Ie[Ge];if(qe.needsUpdate&&(void 0===qe.boundTo||"vertices"===qe.boundTo))if(je=qe.value.length,Fe=0,1===qe.size)for(We=0;We<je;We++)qe.array[We]=qe.value[We];else if(2===qe.size)for(We=0;We<je;We++)Xe=qe.value[We],qe.array[Fe]=Xe.x,qe.array[Fe+1]=Xe.y,Fe+=2;else if(3===qe.size)if("c"===qe.type)for(We=0;We<je;We++)Xe=qe.value[We],qe.array[Fe]=Xe.r,qe.array[Fe+1]=Xe.g,qe.array[Fe+2]=Xe.b,Fe+=3;else for(We=0;We<je;We++)Xe=qe.value[We],qe.array[Fe]=Xe.x,qe.array[Fe+1]=Xe.y,qe.array[Fe+2]=Xe.z,Fe+=3;else if(4===qe.size)for(We=0;We<je;We++)Xe=qe.value[We],qe.array[Fe]=Xe.x,qe.array[Fe+1]=Xe.y,qe.array[Fe+2]=Xe.z,qe.array[Fe+3]=Xe.w,Fe+=4;mt.bindBuffer(mt.ARRAY_BUFFER,qe.buffer);mt.bufferData(mt.ARRAY_BUFFER,qe.array,Ce);qe.needsUpdate=!1}}r.verticesNeedUpdate=!1;r.colorsNeedUpdate=!1;y.attributes&&g(y)}}function m(t){for(var e in t.attributes)if(t.attributes[e].needsUpdate)return!0;return!1}function g(t){for(var e in t.attributes)t.attributes[e].needsUpdate=!1}function y(e){!0===e.transparent?vt.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):vt.setBlending(t.NoBlending);vt.setDepthTest(e.depthTest);vt.setDepthWrite(e.depthWrite);vt.setColorWrite(e.colorWrite);vt.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function v(e,r,i,n,o){var a,s,h,l;rt=0;if(n.needsUpdate){n.program&&jt(n);n.addEventListener("dispose",Ht);var c=Yt[n.type];if(c){var u=t.ShaderLib[c];n.__webglShader={uniforms:t.UniformsUtils.clone(u.uniforms),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}}else n.__webglShader={uniforms:n.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader};for(var f=0,p=0,d=0,m=0,g=0,y=r.length;g<y;g++){var v=r[g];v.onlyShadow||!1===v.visible||(v instanceof t.DirectionalLight&&f++,v instanceof t.PointLight&&p++,v instanceof t.SpotLight&&d++,v instanceof t.HemisphereLight&&m++)}a=f;s=p;h=d;l=m;for(var _,T=0,E=0,A=r.length;E<A;E++){var P=r[E];P.castShadow&&(P instanceof t.SpotLight&&T++,P instanceof t.DirectionalLight&&!P.shadowCascade&&T++)}_=T;var R;if(Ct&&o&&o.skeleton&&o.skeleton.useVertexTexture)R=1024;else{var U=mt.getParameter(mt.MAX_VERTEX_UNIFORM_VECTORS),B=Math.floor((U-20)/4);void 0!==o&&o instanceof t.SkinnedMesh&&(B=Math.min(o.skeleton.bones.length,B),B<o.skeleton.bones.length&&t.warn("WebGLRenderer: too many bones - "+o.skeleton.bones.length+", this GPU supports just "+B+" (try OpenGL instead of ANGLE)"));R=B}var D={precision:F,supportsVertexTextures:At,map:!!n.map,envMap:!!n.envMap,envMapMode:n.envMap&&n.envMap.mapping,lightMap:!!n.lightMap,bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,specularMap:!!n.specularMap,alphaMap:!!n.alphaMap,combine:n.combine,vertexColors:n.vertexColors,fog:i,useFog:n.fog,fogExp:i instanceof t.FogExp2,flatShading:n.shading===t.FlatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:N,skinning:n.skinning,maxBones:R,useVertexTexture:Ct&&o&&o.skeleton&&o.skeleton.useVertexTexture,morphTargets:n.morphTargets,morphNormals:n.morphNormals,maxMorphTargets:K.maxMorphTargets,maxMorphNormals:K.maxMorphNormals,maxDirLights:a,maxPointLights:s,maxSpotLights:h,maxHemiLights:l,maxShadows:_,shadowMapEnabled:K.shadowMapEnabled&&o.receiveShadow&&0<_,shadowMapType:K.shadowMapType,shadowMapDebug:K.shadowMapDebug,shadowMapCascade:K.shadowMapCascade,alphaTest:n.alphaTest,metal:n.metal,wrapAround:n.wrapAround,doubleSided:n.side===t.DoubleSide,flipSided:n.side===t.BackSide},V=[];c?V.push(c):(V.push(n.fragmentShader),V.push(n.vertexShader));if(void 0!==n.defines)for(var z in n.defines)V.push(z),V.push(n.defines[z]);for(z in D)V.push(z),V.push(D[z]);for(var k=V.join(),O,I=0,G=Q.length;I<G;I++){var H=Q[I];if(H.code===k){O=H;O.usedTimes++;break}}void 0===O&&(O=new t.WebGLProgram(K,k,n,D),Q.push(O),K.info.memory.programs=Q.length);n.program=O;var W=O.attributes;if(n.morphTargets){n.numSupportedMorphTargets=0;for(var j,X="morphTarget",q=0;q<K.maxMorphTargets;q++)j=X+q,0<=W[j]&&n.numSupportedMorphTargets++}if(n.morphNormals)for(n.numSupportedMorphNormals=0,X="morphNormal",q=0;q<K.maxMorphNormals;q++)j=X+q,0<=W[j]&&n.numSupportedMorphNormals++;n.uniformsList=[];for(var Y in n.__webglShader.uniforms){var J=n.program.uniforms[Y];J&&n.uniformsList.push([n.__webglShader.uniforms[Y],J])}n.needsUpdate=!1}n.morphTargets&&!o.__webglMorphTargetInfluences&&(o.__webglMorphTargetInfluences=new Float32Array(K.maxMorphTargets));var tt=!1,it=!1,nt=!1,ot=n.program,at=ot.uniforms,st=n.__webglShader.uniforms;ot.id!==Z&&(mt.useProgram(ot.program),Z=ot.id,nt=it=tt=!0);n.id!==$&&(-1===$&&(nt=!0),$=n.id,it=!0);if(tt||e!==et)mt.uniformMatrix4fv(at.projectionMatrix,!1,e.projectionMatrix.elements),N&&mt.uniform1f(at.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==et&&(et=e),(n instanceof t.ShaderMaterial||n instanceof t.MeshPhongMaterial||n.envMap)&&null!==at.cameraPosition&&(ut.setFromMatrixPosition(e.matrixWorld),mt.uniform3f(at.cameraPosition,ut.x,ut.y,ut.z)),(n instanceof t.MeshPhongMaterial||n instanceof t.MeshLambertMaterial||n instanceof t.MeshBasicMaterial||n instanceof t.ShaderMaterial||n.skinning)&&null!==at.viewMatrix&&mt.uniformMatrix4fv(at.viewMatrix,!1,e.matrixWorldInverse.elements);if(n.skinning)if(o.bindMatrix&&null!==at.bindMatrix&&mt.uniformMatrix4fv(at.bindMatrix,!1,o.bindMatrix.elements),o.bindMatrixInverse&&null!==at.bindMatrixInverse&&mt.uniformMatrix4fv(at.bindMatrixInverse,!1,o.bindMatrixInverse.elements),Ct&&o.skeleton&&o.skeleton.useVertexTexture){if(null!==at.boneTexture){var ht=b();mt.uniform1i(at.boneTexture,ht);K.setTexture(o.skeleton.boneTexture,ht)}null!==at.boneTextureWidth&&mt.uniform1i(at.boneTextureWidth,o.skeleton.boneTextureWidth);null!==at.boneTextureHeight&&mt.uniform1i(at.boneTextureHeight,o.skeleton.boneTextureHeight)}else o.skeleton&&o.skeleton.boneMatrices&&null!==at.boneGlobalMatrices&&mt.uniformMatrix4fv(at.boneGlobalMatrices,!1,o.skeleton.boneMatrices);if(it){i&&n.fog&&(st.fogColor.value=i.color,i instanceof t.Fog?(st.fogNear.value=i.near,st.fogFar.value=i.far):i instanceof t.FogExp2&&(st.fogDensity.value=i.density));if(n instanceof t.MeshPhongMaterial||n instanceof t.MeshLambertMaterial||n.lights){if(pt){var nt=!0,lt,ct,gt,yt=0,vt=0,xt=0,bt,_t,wt,Mt,St,Tt=dt,Lt=Tt.directional.colors,Pt=Tt.directional.positions,Rt=Tt.point.colors,Ft=Tt.point.positions,Bt=Tt.point.distances,Dt=Tt.point.decays,Vt=Tt.spot.colors,zt=Tt.spot.positions,kt=Tt.spot.distances,Nt=Tt.spot.directions,Ot=Tt.spot.anglesCos,Gt=Tt.spot.exponents,Wt=Tt.spot.decays,Xt=Tt.hemi.skyColors,qt=Tt.hemi.groundColors,Kt=Tt.hemi.positions,Qt=0,Zt=0,Jt=0,$t=0,te=0,ee=0,re=0,ie=0,ne=0,oe=0,ae=0,se=0;lt=0;for(ct=r.length;lt<ct;lt++)gt=r[lt],gt.onlyShadow||(bt=gt.color,Mt=gt.intensity,St=gt.distance,gt instanceof t.AmbientLight?gt.visible&&(yt+=bt.r,vt+=bt.g,xt+=bt.b):gt instanceof t.DirectionalLight?(te+=1,gt.visible&&(ft.setFromMatrixPosition(gt.matrixWorld),ut.setFromMatrixPosition(gt.target.matrixWorld),ft.sub(ut),ft.normalize(),ne=3*Qt,Pt[ne]=ft.x,Pt[ne+1]=ft.y,Pt[ne+2]=ft.z,w(Lt,ne,bt,Mt),Qt+=1)):gt instanceof t.PointLight?(ee+=1,gt.visible&&(oe=3*Zt,w(Rt,oe,bt,Mt),ut.setFromMatrixPosition(gt.matrixWorld),Ft[oe]=ut.x,Ft[oe+1]=ut.y,Ft[oe+2]=ut.z,Bt[Zt]=St,Dt[Zt]=0===gt.distance?0:gt.decay,Zt+=1)):gt instanceof t.SpotLight?(re+=1,gt.visible&&(ae=3*Jt,w(Vt,ae,bt,Mt),ft.setFromMatrixPosition(gt.matrixWorld),zt[ae]=ft.x,zt[ae+1]=ft.y,zt[ae+2]=ft.z,kt[Jt]=St,ut.setFromMatrixPosition(gt.target.matrixWorld),ft.sub(ut),ft.normalize(),Nt[ae]=ft.x,Nt[ae+1]=ft.y,Nt[ae+2]=ft.z,Ot[Jt]=Math.cos(gt.angle),Gt[Jt]=gt.exponent,Wt[Jt]=0===gt.distance?0:gt.decay,Jt+=1)):gt instanceof t.HemisphereLight&&(ie+=1,gt.visible&&(ft.setFromMatrixPosition(gt.matrixWorld),ft.normalize(),se=3*$t,Kt[se]=ft.x,Kt[se+1]=ft.y,Kt[se+2]=ft.z,_t=gt.color,wt=gt.groundColor,w(Xt,se,_t,Mt),w(qt,se,wt,Mt),$t+=1)));lt=3*Qt;for(ct=Math.max(Lt.length,3*te);lt<ct;lt++)Lt[lt]=0;lt=3*Zt;for(ct=Math.max(Rt.length,3*ee);lt<ct;lt++)Rt[lt]=0;lt=3*Jt;for(ct=Math.max(Vt.length,3*re);lt<ct;lt++)Vt[lt]=0;lt=3*$t;for(ct=Math.max(Xt.length,3*ie);lt<ct;lt++)Xt[lt]=0;lt=3*$t;for(ct=Math.max(qt.length,3*ie);lt<ct;lt++)qt[lt]=0;Tt.directional.length=Qt;Tt.point.length=Zt;Tt.spot.length=Jt;Tt.hemi.length=$t;Tt.ambient[0]=yt;Tt.ambient[1]=vt;Tt.ambient[2]=xt;pt=!1}if(nt){var he=dt;st.ambientLightColor.value=he.ambient;st.directionalLightColor.value=he.directional.colors;st.directionalLightDirection.value=he.directional.positions;st.pointLightColor.value=he.point.colors;st.pointLightPosition.value=he.point.positions;st.pointLightDistance.value=he.point.distances;st.pointLightDecay.value=he.point.decays;st.spotLightColor.value=he.spot.colors;st.spotLightPosition.value=he.spot.positions;st.spotLightDistance.value=he.spot.distances;st.spotLightDirection.value=he.spot.directions;st.spotLightAngleCos.value=he.spot.anglesCos;st.spotLightExponent.value=he.spot.exponents;st.spotLightDecay.value=he.spot.decays;st.hemisphereLightSkyColor.value=he.hemi.skyColors;st.hemisphereLightGroundColor.value=he.hemi.groundColors;st.hemisphereLightDirection.value=he.hemi.positions;x(st,!0)}else x(st,!1)}if(n instanceof t.MeshBasicMaterial||n instanceof t.MeshLambertMaterial||n instanceof t.MeshPhongMaterial){st.opacity.value=n.opacity;st.diffuse.value=n.color;st.map.value=n.map;st.lightMap.value=n.lightMap;st.specularMap.value=n.specularMap;st.alphaMap.value=n.alphaMap;n.bumpMap&&(st.bumpMap.value=n.bumpMap,st.bumpScale.value=n.bumpScale);n.normalMap&&(st.normalMap.value=n.normalMap,st.normalScale.value.copy(n.normalScale));var le;n.map?le=n.map:n.specularMap?le=n.specularMap:n.normalMap?le=n.normalMap:n.bumpMap?le=n.bumpMap:n.alphaMap&&(le=n.alphaMap);
if(void 0!==le){var ce=le.offset,ue=le.repeat;st.offsetRepeat.value.set(ce.x,ce.y,ue.x,ue.y)}st.envMap.value=n.envMap;st.flipEnvMap.value=n.envMap instanceof t.WebGLRenderTargetCube?1:-1;st.reflectivity.value=n.reflectivity;st.refractionRatio.value=n.refractionRatio}if(n instanceof t.LineBasicMaterial)st.diffuse.value=n.color,st.opacity.value=n.opacity;else if(n instanceof t.LineDashedMaterial)st.diffuse.value=n.color,st.opacity.value=n.opacity,st.dashSize.value=n.dashSize,st.totalSize.value=n.dashSize+n.gapSize,st.scale.value=n.scale;else if(n instanceof t.PointCloudMaterial){if(st.psColor.value=n.color,st.opacity.value=n.opacity,st.size.value=n.size,st.scale.value=L.height/2,st.map.value=n.map,null!==n.map){var fe=n.map.offset,pe=n.map.repeat;st.offsetRepeat.value.set(fe.x,fe.y,pe.x,pe.y)}}else n instanceof t.MeshPhongMaterial?(st.shininess.value=n.shininess,st.emissive.value=n.emissive,st.specular.value=n.specular,n.wrapAround&&st.wrapRGB.value.copy(n.wrapRGB)):n instanceof t.MeshLambertMaterial?(st.emissive.value=n.emissive,n.wrapAround&&st.wrapRGB.value.copy(n.wrapRGB)):n instanceof t.MeshDepthMaterial?(st.mNear.value=e.near,st.mFar.value=e.far,st.opacity.value=n.opacity):n instanceof t.MeshNormalMaterial&&(st.opacity.value=n.opacity);if(o.receiveShadow&&!n._shadowPass&&st.shadowMatrix)for(var de=0,me=0,ge=r.length;me<ge;me++){var ye=r[me];ye.castShadow&&(ye instanceof t.SpotLight||ye instanceof t.DirectionalLight&&!ye.shadowCascade)&&(st.shadowMap.value[de]=ye.shadowMap,st.shadowMapSize.value[de]=ye.shadowMapSize,st.shadowMatrix.value[de]=ye.shadowMatrix,st.shadowDarkness.value[de]=ye.shadowDarkness,st.shadowBias.value[de]=ye.shadowBias,de++)}for(var ve=n.uniformsList,xe,be,_e,we=0,Me=ve.length;we<Me;we++){var Se=ve[we][0];if(!1!==Se.needsUpdate){var Te=Se.type,Ee=Se.value,Ae=ve[we][1];switch(Te){case"1i":mt.uniform1i(Ae,Ee);break;case"1f":mt.uniform1f(Ae,Ee);break;case"2f":mt.uniform2f(Ae,Ee[0],Ee[1]);break;case"3f":mt.uniform3f(Ae,Ee[0],Ee[1],Ee[2]);break;case"4f":mt.uniform4f(Ae,Ee[0],Ee[1],Ee[2],Ee[3]);break;case"1iv":mt.uniform1iv(Ae,Ee);break;case"3iv":mt.uniform3iv(Ae,Ee);break;case"1fv":mt.uniform1fv(Ae,Ee);break;case"2fv":mt.uniform2fv(Ae,Ee);break;case"3fv":mt.uniform3fv(Ae,Ee);break;case"4fv":mt.uniform4fv(Ae,Ee);break;case"Matrix3fv":mt.uniformMatrix3fv(Ae,!1,Ee);break;case"Matrix4fv":mt.uniformMatrix4fv(Ae,!1,Ee);break;case"i":mt.uniform1i(Ae,Ee);break;case"f":mt.uniform1f(Ae,Ee);break;case"v2":mt.uniform2f(Ae,Ee.x,Ee.y);break;case"v3":mt.uniform3f(Ae,Ee.x,Ee.y,Ee.z);break;case"v4":mt.uniform4f(Ae,Ee.x,Ee.y,Ee.z,Ee.w);break;case"c":mt.uniform3f(Ae,Ee.r,Ee.g,Ee.b);break;case"iv1":mt.uniform1iv(Ae,Ee);break;case"iv":mt.uniform3iv(Ae,Ee);break;case"fv1":mt.uniform1fv(Ae,Ee);break;case"fv":mt.uniform3fv(Ae,Ee);break;case"v2v":void 0===Se._array&&(Se._array=new Float32Array(2*Ee.length));for(var Ce=0,Le=Ee.length;Ce<Le;Ce++)_e=2*Ce,Se._array[_e]=Ee[Ce].x,Se._array[_e+1]=Ee[Ce].y;mt.uniform2fv(Ae,Se._array);break;case"v3v":void 0===Se._array&&(Se._array=new Float32Array(3*Ee.length));Ce=0;for(Le=Ee.length;Ce<Le;Ce++)_e=3*Ce,Se._array[_e]=Ee[Ce].x,Se._array[_e+1]=Ee[Ce].y,Se._array[_e+2]=Ee[Ce].z;mt.uniform3fv(Ae,Se._array);break;case"v4v":void 0===Se._array&&(Se._array=new Float32Array(4*Ee.length));Ce=0;for(Le=Ee.length;Ce<Le;Ce++)_e=4*Ce,Se._array[_e]=Ee[Ce].x,Se._array[_e+1]=Ee[Ce].y,Se._array[_e+2]=Ee[Ce].z,Se._array[_e+3]=Ee[Ce].w;mt.uniform4fv(Ae,Se._array);break;case"m3":mt.uniformMatrix3fv(Ae,!1,Ee.elements);break;case"m3v":void 0===Se._array&&(Se._array=new Float32Array(9*Ee.length));Ce=0;for(Le=Ee.length;Ce<Le;Ce++)Ee[Ce].flattenToArrayOffset(Se._array,9*Ce);mt.uniformMatrix3fv(Ae,!1,Se._array);break;case"m4":mt.uniformMatrix4fv(Ae,!1,Ee.elements);break;case"m4v":void 0===Se._array&&(Se._array=new Float32Array(16*Ee.length));Ce=0;for(Le=Ee.length;Ce<Le;Ce++)Ee[Ce].flattenToArrayOffset(Se._array,16*Ce);mt.uniformMatrix4fv(Ae,!1,Se._array);break;case"t":xe=Ee;be=b();mt.uniform1i(Ae,be);if(!xe)continue;if(xe instanceof t.CubeTexture||xe.image instanceof Array&&6===xe.image.length){var Pe=xe,Re=be;if(6===Pe.image.length)if(Pe.needsUpdate){Pe.image.__webglTextureCube||(Pe.addEventListener("dispose",It),Pe.image.__webglTextureCube=mt.createTexture(),K.info.memory.textures++);mt.activeTexture(mt.TEXTURE0+Re);mt.bindTexture(mt.TEXTURE_CUBE_MAP,Pe.image.__webglTextureCube);mt.pixelStorei(mt.UNPACK_FLIP_Y_WEBGL,Pe.flipY);for(var Fe=Pe instanceof t.CompressedTexture,Ue=Pe.image[0]instanceof t.DataTexture,Be=[],De=0;6>De;De++)Be[De]=!K.autoScaleCubemaps||Fe||Ue?Ue?Pe.image[De].image:Pe.image[De]:S(Pe.image[De],Et);var Ve=Be[0],ze=t.Math.isPowerOfTwo(Ve.width)&&t.Math.isPowerOfTwo(Ve.height),ke=C(Pe.format),Ne=C(Pe.type);M(mt.TEXTURE_CUBE_MAP,Pe,ze);for(De=0;6>De;De++)if(Fe)for(var Oe,Ie=Be[De].mipmaps,Ge=0,He=Ie.length;Ge<He;Ge++)Oe=Ie[Ge],Pe.format!==t.RGBAFormat&&Pe.format!==t.RGBFormat?-1<Ut().indexOf(ke)?mt.compressedTexImage2D(mt.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ge,ke,Oe.width,Oe.height,0,Oe.data):t.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):mt.texImage2D(mt.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ge,ke,Oe.width,Oe.height,0,ke,Ne,Oe.data);else Ue?mt.texImage2D(mt.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,ke,Be[De].width,Be[De].height,0,ke,Ne,Be[De].data):mt.texImage2D(mt.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,ke,ke,Ne,Be[De]);Pe.generateMipmaps&&ze&&mt.generateMipmap(mt.TEXTURE_CUBE_MAP);Pe.needsUpdate=!1;if(Pe.onUpdate)Pe.onUpdate()}else mt.activeTexture(mt.TEXTURE0+Re),mt.bindTexture(mt.TEXTURE_CUBE_MAP,Pe.image.__webglTextureCube)}else if(xe instanceof t.WebGLRenderTargetCube){var We=xe;mt.activeTexture(mt.TEXTURE0+be);mt.bindTexture(mt.TEXTURE_CUBE_MAP,We.__webglTexture)}else K.setTexture(xe,be);break;case"tv":void 0===Se._array&&(Se._array=[]);Ce=0;for(Le=Se.value.length;Ce<Le;Ce++)Se._array[Ce]=b();mt.uniform1iv(Ae,Se._array);Ce=0;for(Le=Se.value.length;Ce<Le;Ce++)xe=Se.value[Ce],be=Se._array[Ce],xe&&K.setTexture(xe,be);break;default:t.warn("THREE.WebGLRenderer: Unknown uniform type: "+Te)}}}}mt.uniformMatrix4fv(at.modelViewMatrix,!1,o._modelViewMatrix.elements);at.normalMatrix&&mt.uniformMatrix3fv(at.normalMatrix,!1,o._normalMatrix.elements);null!==at.modelMatrix&&mt.uniformMatrix4fv(at.modelMatrix,!1,o.matrixWorld.elements);return ot}function x(t,e){t.ambientLightColor.needsUpdate=e;t.directionalLightColor.needsUpdate=e;t.directionalLightDirection.needsUpdate=e;t.pointLightColor.needsUpdate=e;t.pointLightPosition.needsUpdate=e;t.pointLightDistance.needsUpdate=e;t.pointLightDecay.needsUpdate=e;t.spotLightColor.needsUpdate=e;t.spotLightPosition.needsUpdate=e;t.spotLightDistance.needsUpdate=e;t.spotLightDirection.needsUpdate=e;t.spotLightAngleCos.needsUpdate=e;t.spotLightExponent.needsUpdate=e;t.spotLightDecay.needsUpdate=e;t.hemisphereLightSkyColor.needsUpdate=e;t.hemisphereLightGroundColor.needsUpdate=e;t.hemisphereLightDirection.needsUpdate=e}function b(){var e=rt;e>=Mt&&t.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Mt);rt+=1;return e}function _(t,e){t._modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld);t._normalMatrix.getNormalMatrix(t._modelViewMatrix)}function w(t,e,r,i){t[e]=r.r*i;t[e+1]=r.g*i;t[e+2]=r.b*i}function M(e,r,i){i?(mt.texParameteri(e,mt.TEXTURE_WRAP_S,C(r.wrapS)),mt.texParameteri(e,mt.TEXTURE_WRAP_T,C(r.wrapT)),mt.texParameteri(e,mt.TEXTURE_MAG_FILTER,C(r.magFilter)),mt.texParameteri(e,mt.TEXTURE_MIN_FILTER,C(r.minFilter))):(mt.texParameteri(e,mt.TEXTURE_WRAP_S,mt.CLAMP_TO_EDGE),mt.texParameteri(e,mt.TEXTURE_WRAP_T,mt.CLAMP_TO_EDGE),r.wrapS===t.ClampToEdgeWrapping&&r.wrapT===t.ClampToEdgeWrapping||t.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+r.sourceFile+" )"),mt.texParameteri(e,mt.TEXTURE_MAG_FILTER,A(r.magFilter)),mt.texParameteri(e,mt.TEXTURE_MIN_FILTER,A(r.minFilter)),r.minFilter!==t.NearestFilter&&r.minFilter!==t.LinearFilter&&t.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+r.sourceFile+" )"));(i=xt.get("EXT_texture_filter_anisotropic"))&&r.type!==t.FloatType&&r.type!==t.HalfFloatType&&(1<r.anisotropy||r.__currentAnisotropy)&&(mt.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r.anisotropy,K.getMaxAnisotropy())),r.__currentAnisotropy=r.anisotropy)}function S(e,r){if(e.width>r||e.height>r){var i=r/Math.max(e.width,e.height),n=document.createElement("canvas");n.width=Math.floor(e.width*i);n.height=Math.floor(e.height*i);n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height);t.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e);return n}return e}function T(t,e){mt.bindRenderbuffer(mt.RENDERBUFFER,t);e.depthBuffer&&!e.stencilBuffer?(mt.renderbufferStorage(mt.RENDERBUFFER,mt.DEPTH_COMPONENT16,e.width,e.height),mt.framebufferRenderbuffer(mt.FRAMEBUFFER,mt.DEPTH_ATTACHMENT,mt.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(mt.renderbufferStorage(mt.RENDERBUFFER,mt.DEPTH_STENCIL,e.width,e.height),mt.framebufferRenderbuffer(mt.FRAMEBUFFER,mt.DEPTH_STENCIL_ATTACHMENT,mt.RENDERBUFFER,t)):mt.renderbufferStorage(mt.RENDERBUFFER,mt.RGBA4,e.width,e.height)}function E(e){e instanceof t.WebGLRenderTargetCube?(mt.bindTexture(mt.TEXTURE_CUBE_MAP,e.__webglTexture),mt.generateMipmap(mt.TEXTURE_CUBE_MAP),mt.bindTexture(mt.TEXTURE_CUBE_MAP,null)):(mt.bindTexture(mt.TEXTURE_2D,e.__webglTexture),mt.generateMipmap(mt.TEXTURE_2D),mt.bindTexture(mt.TEXTURE_2D,null))}function A(e){return e===t.NearestFilter||e===t.NearestMipMapNearestFilter||e===t.NearestMipMapLinearFilter?mt.NEAREST:mt.LINEAR}function C(e){var r;if(e===t.RepeatWrapping)return mt.REPEAT;if(e===t.ClampToEdgeWrapping)return mt.CLAMP_TO_EDGE;if(e===t.MirroredRepeatWrapping)return mt.MIRRORED_REPEAT;if(e===t.NearestFilter)return mt.NEAREST;if(e===t.NearestMipMapNearestFilter)return mt.NEAREST_MIPMAP_NEAREST;if(e===t.NearestMipMapLinearFilter)return mt.NEAREST_MIPMAP_LINEAR;if(e===t.LinearFilter)return mt.LINEAR;if(e===t.LinearMipMapNearestFilter)return mt.LINEAR_MIPMAP_NEAREST;if(e===t.LinearMipMapLinearFilter)return mt.LINEAR_MIPMAP_LINEAR;if(e===t.UnsignedByteType)return mt.UNSIGNED_BYTE;if(e===t.UnsignedShort4444Type)return mt.UNSIGNED_SHORT_4_4_4_4;if(e===t.UnsignedShort5551Type)return mt.UNSIGNED_SHORT_5_5_5_1;if(e===t.UnsignedShort565Type)return mt.UNSIGNED_SHORT_5_6_5;if(e===t.ByteType)return mt.BYTE;if(e===t.ShortType)return mt.SHORT;if(e===t.UnsignedShortType)return mt.UNSIGNED_SHORT;if(e===t.IntType)return mt.INT;if(e===t.UnsignedIntType)return mt.UNSIGNED_INT;if(e===t.FloatType)return mt.FLOAT;r=xt.get("OES_texture_half_float");if(null!==r&&e===t.HalfFloatType)return r.HALF_FLOAT_OES;if(e===t.AlphaFormat)return mt.ALPHA;if(e===t.RGBFormat)return mt.RGB;if(e===t.RGBAFormat)return mt.RGBA;if(e===t.LuminanceFormat)return mt.LUMINANCE;if(e===t.LuminanceAlphaFormat)return mt.LUMINANCE_ALPHA;if(e===t.AddEquation)return mt.FUNC_ADD;if(e===t.SubtractEquation)return mt.FUNC_SUBTRACT;if(e===t.ReverseSubtractEquation)return mt.FUNC_REVERSE_SUBTRACT;if(e===t.ZeroFactor)return mt.ZERO;if(e===t.OneFactor)return mt.ONE;if(e===t.SrcColorFactor)return mt.SRC_COLOR;if(e===t.OneMinusSrcColorFactor)return mt.ONE_MINUS_SRC_COLOR;if(e===t.SrcAlphaFactor)return mt.SRC_ALPHA;if(e===t.OneMinusSrcAlphaFactor)return mt.ONE_MINUS_SRC_ALPHA;if(e===t.DstAlphaFactor)return mt.DST_ALPHA;if(e===t.OneMinusDstAlphaFactor)return mt.ONE_MINUS_DST_ALPHA;if(e===t.DstColorFactor)return mt.DST_COLOR;if(e===t.OneMinusDstColorFactor)return mt.ONE_MINUS_DST_COLOR;if(e===t.SrcAlphaSaturateFactor)return mt.SRC_ALPHA_SATURATE;r=xt.get("WEBGL_compressed_texture_s3tc");if(null!==r){if(e===t.RGB_S3TC_DXT1_Format)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===t.RGBA_S3TC_DXT1_Format)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===t.RGBA_S3TC_DXT3_Format)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===t.RGBA_S3TC_DXT5_Format)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}r=xt.get("WEBGL_compressed_texture_pvrtc");if(null!==r){if(e===t.RGB_PVRTC_4BPPV1_Format)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===t.RGB_PVRTC_2BPPV1_Format)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===t.RGBA_PVRTC_4BPPV1_Format)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===t.RGBA_PVRTC_2BPPV1_Format)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}r=xt.get("EXT_blend_minmax");if(null!==r){if(e===t.MinEquation)return r.MIN_EXT;if(e===t.MaxEquation)return r.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",t.REVISION);e=e||{};var L=void 0!==e.canvas?e.canvas:document.createElement("canvas"),P=void 0!==e.context?e.context:null,R=1,F=void 0!==e.precision?e.precision:"highp",U=void 0!==e.alpha?e.alpha:!1,B=void 0!==e.depth?e.depth:!0,D=void 0!==e.stencil?e.stencil:!0,V=void 0!==e.antialias?e.antialias:!1,z=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,k=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,N=void 0!==e.logarithmicDepthBuffer?e.logarithmicDepthBuffer:!1,O=new t.Color(0),I=0,G=[],H={},W=[],j=[],X=[],q=[],Y=[];this.domElement=L;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.gammaFactor=2;this.shadowMapEnabled=this.gammaOutput=this.gammaInput=!1;this.shadowMapType=t.PCFShadowMap;this.shadowMapCullFace=t.CullFaceFront;this.shadowMapCascade=this.shadowMapDebug=!1;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=!0;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var K=this,Q=[],Z=null,J=null,$=-1,tt="",et=null,rt=0,it=0,nt=0,ot=L.width,at=L.height,st=0,ht=0,lt=new t.Frustum,ct=new t.Matrix4,ut=new t.Vector3,ft=new t.Vector3,pt=!0,dt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},mt;try{var gt={alpha:U,depth:B,stencil:D,antialias:V,premultipliedAlpha:z,preserveDrawingBuffer:k};mt=P||L.getContext("webgl",gt)||L.getContext("experimental-webgl",gt);if(null===mt){if(null!==L.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context."}L.addEventListener("webglcontextlost",function(t){t.preventDefault();wt();_t();H={}},!1)}catch(yt){t.error("THREE.WebGLRenderer: "+yt)}var vt=new t.WebGLState(mt,C);void 0===mt.getShaderPrecisionFormat&&(mt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var xt=new t.WebGLExtensions(mt);xt.get("OES_texture_float");xt.get("OES_texture_float_linear");xt.get("OES_texture_half_float");xt.get("OES_texture_half_float_linear");xt.get("OES_standard_derivatives");N&&xt.get("EXT_frag_depth");var bt=function(t,e,r,i){!0===z&&(t*=i,e*=i,r*=i);mt.clearColor(t,e,r,i)},_t=function(){mt.clearColor(0,0,0,1);mt.clearDepth(1);mt.clearStencil(0);mt.enable(mt.DEPTH_TEST);mt.depthFunc(mt.LEQUAL);mt.frontFace(mt.CCW);mt.cullFace(mt.BACK);mt.enable(mt.CULL_FACE);mt.enable(mt.BLEND);mt.blendEquation(mt.FUNC_ADD);mt.blendFunc(mt.SRC_ALPHA,mt.ONE_MINUS_SRC_ALPHA);mt.viewport(it,nt,ot,at);bt(O.r,O.g,O.b,I)},wt=function(){et=Z=null;tt="";$=-1;pt=!0;vt.reset()};_t();this.context=mt;this.state=vt;var Mt=mt.getParameter(mt.MAX_TEXTURE_IMAGE_UNITS),St=mt.getParameter(mt.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Tt=mt.getParameter(mt.MAX_TEXTURE_SIZE),Et=mt.getParameter(mt.MAX_CUBE_MAP_TEXTURE_SIZE),At=0<St,Ct=At&&xt.get("OES_texture_float"),Lt=mt.getShaderPrecisionFormat(mt.VERTEX_SHADER,mt.HIGH_FLOAT),Pt=mt.getShaderPrecisionFormat(mt.VERTEX_SHADER,mt.MEDIUM_FLOAT),Rt=mt.getShaderPrecisionFormat(mt.FRAGMENT_SHADER,mt.HIGH_FLOAT),Ft=mt.getShaderPrecisionFormat(mt.FRAGMENT_SHADER,mt.MEDIUM_FLOAT),Ut=function(){var t;return function(){if(void 0!==t)return t;t=[];if(xt.get("WEBGL_compressed_texture_pvrtc")||xt.get("WEBGL_compressed_texture_s3tc"))for(var e=mt.getParameter(mt.COMPRESSED_TEXTURE_FORMATS),r=0;r<e.length;r++)t.push(e[r]);return t}}(),Bt=0<Lt.precision&&0<Rt.precision,Dt=0<Pt.precision&&0<Ft.precision;"highp"!==F||Bt||(Dt?(F="mediump",t.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(F="lowp",t.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp.")));"mediump"!==F||Dt||(F="lowp",t.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var Vt=new t.ShadowMapPlugin(this,G,H,W),zt=new t.SpritePlugin(this,q),kt=new t.LensFlarePlugin(this,Y);this.getContext=function(){return mt};this.forceContextLoss=function(){xt.get("WEBGL_lose_context").loseContext()};this.supportsVertexTextures=function(){return At};this.supportsFloatTextures=function(){return xt.get("OES_texture_float")};this.supportsHalfFloatTextures=function(){return xt.get("OES_texture_half_float")};this.supportsStandardDerivatives=function(){return xt.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){return xt.get("WEBGL_compressed_texture_s3tc")};this.supportsCompressedTexturePVRTC=function(){return xt.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){return xt.get("EXT_blend_minmax")};this.getMaxAnisotropy=function(){var t;return function(){if(void 0!==t)return t;var e=xt.get("EXT_texture_filter_anisotropic");return t=null!==e?mt.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}();this.getPrecision=function(){return F};this.getPixelRatio=function(){return R};this.setPixelRatio=function(t){R=t};this.setSize=function(t,e,r){L.width=t*R;L.height=e*R;!1!==r&&(L.style.width=t+"px",L.style.height=e+"px");this.setViewport(0,0,t,e)};this.setViewport=function(t,e,r,i){it=t*R;nt=e*R;ot=r*R;at=i*R;mt.viewport(it,nt,ot,at)};this.setScissor=function(t,e,r,i){mt.scissor(t*R,e*R,r*R,i*R)};this.enableScissorTest=function(t){t?mt.enable(mt.SCISSOR_TEST):mt.disable(mt.SCISSOR_TEST)};this.getClearColor=function(){return O};this.setClearColor=function(t,e){O.set(t);I=void 0!==e?e:1;bt(O.r,O.g,O.b,I)};this.getClearAlpha=function(){return I};this.setClearAlpha=function(t){I=t;bt(O.r,O.g,O.b,I)};this.clear=function(t,e,r){var i=0;if(void 0===t||t)i|=mt.COLOR_BUFFER_BIT;if(void 0===e||e)i|=mt.DEPTH_BUFFER_BIT;if(void 0===r||r)i|=mt.STENCIL_BUFFER_BIT;mt.clear(i)};this.clearColor=function(){mt.clear(mt.COLOR_BUFFER_BIT)};this.clearDepth=function(){mt.clear(mt.DEPTH_BUFFER_BIT)};this.clearStencil=function(){mt.clear(mt.STENCIL_BUFFER_BIT)};this.clearTarget=function(t,e,r,i){this.setRenderTarget(t);this.clear(e,r,i)};this.resetGLState=wt;var Nt=function(e){e.target.traverse(function(e){e.removeEventListener("remove",Nt);if(e instanceof t.Mesh||e instanceof t.PointCloud||e instanceof t.Line)delete H[e.id];else if(e instanceof t.ImmediateRenderObject||e.immediateRenderCallback)for(var r=W,i=r.length-1;0<=i;i--)r[i].object===e&&r.splice(i,1);delete e.__webglInit;delete e._modelViewMatrix;delete e._normalMatrix;delete e.__webglActive})},Ot=function(e){e=e.target;e.removeEventListener("dispose",Ot);delete e.__webglInit;if(e instanceof t.BufferGeometry){for(var r in e.attributes){var i=e.attributes[r];void 0!==i.buffer&&(mt.deleteBuffer(i.buffer),delete i.buffer)}K.info.memory.geometries--}else if(r=Xt[e.id],void 0!==r){for(var i=0,n=r.length;i<n;i++){var o=r[i];if(void 0!==o.numMorphTargets){for(var a=0,s=o.numMorphTargets;a<s;a++)mt.deleteBuffer(o.__webglMorphTargetsBuffers[a]);delete o.__webglMorphTargetsBuffers}if(void 0!==o.numMorphNormals){a=0;for(s=o.numMorphNormals;a<s;a++)mt.deleteBuffer(o.__webglMorphNormalsBuffers[a]);delete o.__webglMorphNormalsBuffers}Wt(o)}delete Xt[e.id]}else Wt(e);tt=""},It=function(t){t=t.target;t.removeEventListener("dispose",It);t.image&&t.image.__webglTextureCube?(mt.deleteTexture(t.image.__webglTextureCube),delete t.image.__webglTextureCube):void 0!==t.__webglInit&&(mt.deleteTexture(t.__webglTexture),delete t.__webglTexture,delete t.__webglInit);K.info.memory.textures--},Gt=function(e){e=e.target;e.removeEventListener("dispose",Gt);if(e&&void 0!==e.__webglTexture){mt.deleteTexture(e.__webglTexture);delete e.__webglTexture;if(e instanceof t.WebGLRenderTargetCube)for(var r=0;6>r;r++)mt.deleteFramebuffer(e.__webglFramebuffer[r]),mt.deleteRenderbuffer(e.__webglRenderbuffer[r]);else mt.deleteFramebuffer(e.__webglFramebuffer),mt.deleteRenderbuffer(e.__webglRenderbuffer);delete e.__webglFramebuffer;delete e.__webglRenderbuffer}K.info.memory.textures--},Ht=function(t){t=t.target;t.removeEventListener("dispose",Ht);jt(t)},Wt=function(t){for(var e="__webglVertexBuffer __webglNormalBuffer __webglTangentBuffer __webglColorBuffer __webglUVBuffer __webglUV2Buffer __webglSkinIndicesBuffer __webglSkinWeightsBuffer __webglFaceBuffer __webglLineBuffer __webglLineDistanceBuffer".split(" "),r=0,i=e.length;r<i;r++){var n=e[r];void 0!==t[n]&&(mt.deleteBuffer(t[n]),delete t[n])}if(void 0!==t.__webglCustomAttributesList){for(n in t.__webglCustomAttributesList)mt.deleteBuffer(t.__webglCustomAttributesList[n].buffer);delete t.__webglCustomAttributesList}K.info.memory.geometries--},jt=function(t){var e=t.program.program;if(void 0!==e){t.program=void 0;var r,i,n=!1;t=0;for(r=Q.length;t<r;t++)if(i=Q[t],i.program===e){i.usedTimes--;0===i.usedTimes&&(n=!0);break}if(!0===n){n=[];t=0;for(r=Q.length;t<r;t++)i=Q[t],i.program!==e&&n.push(i);Q=n;mt.deleteProgram(e);K.info.memory.programs--}}};this.renderBufferImmediate=function(e,r,i){vt.initAttributes();e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=mt.createBuffer());e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=mt.createBuffer());e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=mt.createBuffer());e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=mt.createBuffer());e.hasPositions&&(mt.bindBuffer(mt.ARRAY_BUFFER,e.__webglVertexBuffer),mt.bufferData(mt.ARRAY_BUFFER,e.positionArray,mt.DYNAMIC_DRAW),vt.enableAttribute(r.attributes.position),mt.vertexAttribPointer(r.attributes.position,3,mt.FLOAT,!1,0,0));if(e.hasNormals){mt.bindBuffer(mt.ARRAY_BUFFER,e.__webglNormalBuffer);if(!1===i instanceof t.MeshPhongMaterial&&i.shading===t.FlatShading){var n,o,a,s,h,l,c,u,f,p,d,m=3*e.count;for(d=0;d<m;d+=9)p=e.normalArray,n=p[d],o=p[d+1],a=p[d+2],s=p[d+3],l=p[d+4],u=p[d+5],h=p[d+6],c=p[d+7],f=p[d+8],n=(n+s+h)/3,o=(o+l+c)/3,a=(a+u+f)/3,p[d]=n,p[d+1]=o,p[d+2]=a,p[d+3]=n,p[d+4]=o,p[d+5]=a,p[d+6]=n,p[d+7]=o,p[d+8]=a}mt.bufferData(mt.ARRAY_BUFFER,e.normalArray,mt.DYNAMIC_DRAW);vt.enableAttribute(r.attributes.normal);mt.vertexAttribPointer(r.attributes.normal,3,mt.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(mt.bindBuffer(mt.ARRAY_BUFFER,e.__webglUvBuffer),mt.bufferData(mt.ARRAY_BUFFER,e.uvArray,mt.DYNAMIC_DRAW),vt.enableAttribute(r.attributes.uv),mt.vertexAttribPointer(r.attributes.uv,2,mt.FLOAT,!1,0,0));e.hasColors&&i.vertexColors!==t.NoColors&&(mt.bindBuffer(mt.ARRAY_BUFFER,e.__webglColorBuffer),mt.bufferData(mt.ARRAY_BUFFER,e.colorArray,mt.DYNAMIC_DRAW),vt.enableAttribute(r.attributes.color),mt.vertexAttribPointer(r.attributes.color,3,mt.FLOAT,!1,0,0));vt.disableUnusedAttributes();mt.drawArrays(mt.TRIANGLES,0,e.count);e.count=0};this.renderBufferDirect=function(e,r,i,o,a,s){if(!1!==o.visible)if(d(s),e=v(e,r,i,o,s),r=!1,i="direct_"+a.id+"_"+e.id+"_"+(o.wireframe?1:0),i!==tt&&(tt=i,r=!0),r&&vt.initAttributes(),s instanceof t.Mesh){s=!0===o.wireframe?mt.LINES:mt.TRIANGLES;var h=a.attributes.index;if(h){var l,c;h.array instanceof Uint32Array&&xt.get("OES_element_index_uint")?(l=mt.UNSIGNED_INT,c=4):(l=mt.UNSIGNED_SHORT,c=2);i=a.offsets;if(0===i.length)r&&(n(o,e,a,0),mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,h.buffer)),mt.drawElements(s,h.array.length,l,0),K.info.render.calls++,K.info.render.vertices+=h.array.length,K.info.render.faces+=h.array.length/3;else{r=!0;for(var u=0,f=i.length;u<f;u++){var p=i[u].index;r&&(n(o,e,a,p),mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,h.buffer));mt.drawElements(s,i[u].count,l,i[u].start*c);K.info.render.calls++;K.info.render.vertices+=i[u].count;K.info.render.faces+=i[u].count/3}}}else r&&n(o,e,a,0),o=a.attributes.position,mt.drawArrays(s,0,o.array.length/o.itemSize),K.info.render.calls++,K.info.render.vertices+=o.array.length/o.itemSize,K.info.render.faces+=o.array.length/(3*o.itemSize)}else if(s instanceof t.PointCloud)if(s=mt.POINTS,h=a.attributes.index)if(h.array instanceof Uint32Array&&xt.get("OES_element_index_uint")?(l=mt.UNSIGNED_INT,c=4):(l=mt.UNSIGNED_SHORT,c=2),i=a.offsets,0===i.length)r&&(n(o,e,a,0),mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,h.buffer)),mt.drawElements(s,h.array.length,l,0),K.info.render.calls++,K.info.render.points+=h.array.length;else for(1<i.length&&(r=!0),u=0,f=i.length;u<f;u++)p=i[u].index,r&&(n(o,e,a,p),mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,h.buffer)),mt.drawElements(s,i[u].count,l,i[u].start*c),K.info.render.calls++,K.info.render.points+=i[u].count;else if(r&&n(o,e,a,0),o=a.attributes.position,i=a.offsets,0===i.length)mt.drawArrays(s,0,o.array.length/3),K.info.render.calls++,K.info.render.points+=o.array.length/3;else for(u=0,f=i.length;u<f;u++)mt.drawArrays(s,i[u].index,i[u].count),K.info.render.calls++,K.info.render.points+=i[u].count;else if(s instanceof t.Line)if(s=s.mode===t.LineStrip?mt.LINE_STRIP:mt.LINES,vt.setLineWidth(o.linewidth*R),h=a.attributes.index)if(h.array instanceof Uint32Array?(l=mt.UNSIGNED_INT,c=4):(l=mt.UNSIGNED_SHORT,c=2),i=a.offsets,0===i.length)r&&(n(o,e,a,0),mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,h.buffer)),mt.drawElements(s,h.array.length,l,0),K.info.render.calls++,K.info.render.vertices+=h.array.length;else for(1<i.length&&(r=!0),u=0,f=i.length;u<f;u++)p=i[u].index,r&&(n(o,e,a,p),mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,h.buffer)),mt.drawElements(s,i[u].count,l,i[u].start*c),K.info.render.calls++,K.info.render.vertices+=i[u].count;else if(r&&n(o,e,a,0),o=a.attributes.position,i=a.offsets,0===i.length)mt.drawArrays(s,0,o.array.length/3),K.info.render.calls++,K.info.render.vertices+=o.array.length/3;else for(u=0,f=i.length;u<f;u++)mt.drawArrays(s,i[u].index,i[u].count),K.info.render.calls++,K.info.render.vertices+=i[u].count};this.renderBuffer=function(e,r,i,n,o,a){if(!1!==n.visible){d(a);i=v(e,r,i,n,a);r=i.attributes;e=!1;i=o.id+"_"+i.id+"_"+(n.wireframe?1:0);i!==tt&&(tt=i,e=!0);e&&vt.initAttributes();if(!n.morphTargets&&0<=r.position)e&&(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglVertexBuffer),vt.enableAttribute(r.position),mt.vertexAttribPointer(r.position,3,mt.FLOAT,!1,0,0));else if(a.morphTargetBase){i=n.program.attributes;-1!==a.morphTargetBase&&0<=i.position?(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[a.morphTargetBase]),vt.enableAttribute(i.position),mt.vertexAttribPointer(i.position,3,mt.FLOAT,!1,0,0)):0<=i.position&&(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglVertexBuffer),vt.enableAttribute(i.position),mt.vertexAttribPointer(i.position,3,mt.FLOAT,!1,0,0));if(a.morphTargetForcedOrder.length)for(var h=0,l=a.morphTargetForcedOrder,c=a.morphTargetInfluences,u;h<n.numSupportedMorphTargets&&h<l.length;)u=i["morphTarget"+h],0<=u&&(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[l[h]]),vt.enableAttribute(u),mt.vertexAttribPointer(u,3,mt.FLOAT,!1,0,0)),u=i["morphNormal"+h],0<=u&&n.morphNormals&&(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglMorphNormalsBuffers[l[h]]),vt.enableAttribute(u),mt.vertexAttribPointer(u,3,mt.FLOAT,!1,0,0)),a.__webglMorphTargetInfluences[h]=c[l[h]],h++;else{l=[];c=a.morphTargetInfluences;h=a.geometry.morphTargets;c.length>h.length&&(console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array."),c.length=h.length);h=0;for(u=c.length;h<u;h++)l.push([c[h],h]);l.length>n.numSupportedMorphTargets?(l.sort(s),l.length=n.numSupportedMorphTargets):l.length>n.numSupportedMorphNormals?l.sort(s):0===l.length&&l.push([0,0]);for(var h=0,f=n.numSupportedMorphTargets;h<f;h++)if(l[h]){var p=l[h][1];u=i["morphTarget"+h];0<=u&&(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[p]),vt.enableAttribute(u),mt.vertexAttribPointer(u,3,mt.FLOAT,!1,0,0));u=i["morphNormal"+h];0<=u&&n.morphNormals&&(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglMorphNormalsBuffers[p]),vt.enableAttribute(u),mt.vertexAttribPointer(u,3,mt.FLOAT,!1,0,0));a.__webglMorphTargetInfluences[h]=c[p]}else a.__webglMorphTargetInfluences[h]=0}null!==n.program.uniforms.morphTargetInfluences&&mt.uniform1fv(n.program.uniforms.morphTargetInfluences,a.__webglMorphTargetInfluences)}if(e){if(o.__webglCustomAttributesList)for(i=0,c=o.__webglCustomAttributesList.length;i<c;i++)l=o.__webglCustomAttributesList[i],0<=r[l.buffer.belongsToAttribute]&&(mt.bindBuffer(mt.ARRAY_BUFFER,l.buffer),vt.enableAttribute(r[l.buffer.belongsToAttribute]),mt.vertexAttribPointer(r[l.buffer.belongsToAttribute],l.size,mt.FLOAT,!1,0,0));0<=r.color&&(0<a.geometry.colors.length||0<a.geometry.faces.length?(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglColorBuffer),vt.enableAttribute(r.color),mt.vertexAttribPointer(r.color,3,mt.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&mt.vertexAttrib3fv(r.color,n.defaultAttributeValues.color));0<=r.normal&&(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglNormalBuffer),vt.enableAttribute(r.normal),mt.vertexAttribPointer(r.normal,3,mt.FLOAT,!1,0,0));0<=r.tangent&&(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglTangentBuffer),vt.enableAttribute(r.tangent),mt.vertexAttribPointer(r.tangent,4,mt.FLOAT,!1,0,0));0<=r.uv&&(a.geometry.faceVertexUvs[0]?(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglUVBuffer),vt.enableAttribute(r.uv),mt.vertexAttribPointer(r.uv,2,mt.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&mt.vertexAttrib2fv(r.uv,n.defaultAttributeValues.uv));0<=r.uv2&&(a.geometry.faceVertexUvs[1]?(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglUV2Buffer),vt.enableAttribute(r.uv2),mt.vertexAttribPointer(r.uv2,2,mt.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&mt.vertexAttrib2fv(r.uv2,n.defaultAttributeValues.uv2));n.skinning&&0<=r.skinIndex&&0<=r.skinWeight&&(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),vt.enableAttribute(r.skinIndex),mt.vertexAttribPointer(r.skinIndex,4,mt.FLOAT,!1,0,0),mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),vt.enableAttribute(r.skinWeight),mt.vertexAttribPointer(r.skinWeight,4,mt.FLOAT,!1,0,0));0<=r.lineDistance&&(mt.bindBuffer(mt.ARRAY_BUFFER,o.__webglLineDistanceBuffer),vt.enableAttribute(r.lineDistance),mt.vertexAttribPointer(r.lineDistance,1,mt.FLOAT,!1,0,0))}vt.disableUnusedAttributes();a instanceof t.Mesh?(a=o.__typeArray===Uint32Array?mt.UNSIGNED_INT:mt.UNSIGNED_SHORT,n.wireframe?(vt.setLineWidth(n.wireframeLinewidth*R),e&&mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),mt.drawElements(mt.LINES,o.__webglLineCount,a,0)):(e&&mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),mt.drawElements(mt.TRIANGLES,o.__webglFaceCount,a,0)),K.info.render.calls++,K.info.render.vertices+=o.__webglFaceCount,K.info.render.faces+=o.__webglFaceCount/3):a instanceof t.Line?(a=a.mode===t.LineStrip?mt.LINE_STRIP:mt.LINES,vt.setLineWidth(n.linewidth*R),mt.drawArrays(a,0,o.__webglLineCount),K.info.render.calls++):a instanceof t.PointCloud&&(mt.drawArrays(mt.POINTS,0,o.__webglParticleCount),K.info.render.calls++,K.info.render.points+=o.__webglParticleCount)}};this.render=function(e,r,i,n){if(!1===r instanceof t.Camera)t.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var s=e.fog;tt="";$=-1;et=null;pt=!0;!0===e.autoUpdate&&e.updateMatrixWorld();void 0===r.parent&&r.updateMatrixWorld();e.traverse(function(e){e instanceof t.SkinnedMesh&&e.skeleton.update()});r.matrixWorldInverse.getInverse(r.matrixWorld);ct.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse);lt.setFromMatrix(ct);G.length=0;j.length=0;X.length=0;q.length=0;Y.length=0;h(e);!0===K.sortObjects&&(j.sort(o),X.sort(a));Vt.render(e,r);K.info.render.calls=0;K.info.render.vertices=0;K.info.render.faces=0;K.info.render.points=0;this.setRenderTarget(i);(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);n=0;for(var f=W.length;n<f;n++){
var p=W[n],d=p.object;d.visible&&(_(d,r),u(p))}e.overrideMaterial?(n=e.overrideMaterial,y(n),l(j,r,G,s,n),l(X,r,G,s,n),c(W,"",r,G,s,n)):(vt.setBlending(t.NoBlending),l(j,r,G,s,null),c(W,"opaque",r,G,s,null),l(X,r,G,s,null),c(W,"transparent",r,G,s,null));zt.render(e,r);kt.render(e,r,st,ht);i&&i.generateMipmaps&&i.minFilter!==t.NearestFilter&&i.minFilter!==t.LinearFilter&&E(i);vt.setDepthTest(!0);vt.setDepthWrite(!0);vt.setColorWrite(!0)}};this.renderImmediateObject=function(t,e,r,i,n){var o=v(t,e,r,i,n);tt="";K.setMaterialFaces(i);n.immediateRenderCallback?n.immediateRenderCallback(o,mt,lt):n.render(function(t){K.renderBufferImmediate(t,o,i)})};var Xt={},qt=0,Yt={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};this.setFaceCulling=function(e,r){e===t.CullFaceNone?mt.disable(mt.CULL_FACE):(r===t.FrontFaceDirectionCW?mt.frontFace(mt.CW):mt.frontFace(mt.CCW),e===t.CullFaceBack?mt.cullFace(mt.BACK):e===t.CullFaceFront?mt.cullFace(mt.FRONT):mt.cullFace(mt.FRONT_AND_BACK),mt.enable(mt.CULL_FACE))};this.setMaterialFaces=function(e){vt.setDoubleSided(e.side===t.DoubleSide);vt.setFlipSided(e.side===t.BackSide)};this.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",It),e.__webglTexture=mt.createTexture(),K.info.memory.textures++);mt.bindTexture(mt.TEXTURE_2D,e.__webglTexture);mt.pixelStorei(mt.UNPACK_FLIP_Y_WEBGL,e.flipY);mt.pixelStorei(mt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);mt.pixelStorei(mt.UNPACK_ALIGNMENT,e.unpackAlignment);e.image=S(e.image,Tt);var r=e.image,i=t.Math.isPowerOfTwo(r.width)&&t.Math.isPowerOfTwo(r.height),n=C(e.format),o=C(e.type);M(mt.TEXTURE_2D,e,i);var a=e.mipmaps;if(e instanceof t.DataTexture)if(0<a.length&&i){for(var s=0,h=a.length;s<h;s++)r=a[s],mt.texImage2D(mt.TEXTURE_2D,s,n,r.width,r.height,0,n,o,r.data);e.generateMipmaps=!1}else mt.texImage2D(mt.TEXTURE_2D,0,n,r.width,r.height,0,n,o,r.data);else if(e instanceof t.CompressedTexture)for(s=0,h=a.length;s<h;s++)r=a[s],e.format!==t.RGBAFormat&&e.format!==t.RGBFormat?-1<Ut().indexOf(n)?mt.compressedTexImage2D(mt.TEXTURE_2D,s,n,r.width,r.height,0,r.data):t.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):mt.texImage2D(mt.TEXTURE_2D,s,n,r.width,r.height,0,n,o,r.data);else if(0<a.length&&i){s=0;for(h=a.length;s<h;s++)r=a[s],mt.texImage2D(mt.TEXTURE_2D,s,n,n,o,r);e.generateMipmaps=!1}else mt.texImage2D(mt.TEXTURE_2D,0,n,n,o,e.image);e.generateMipmaps&&i&&mt.generateMipmap(mt.TEXTURE_2D);e.needsUpdate=!1;if(e.onUpdate)e.onUpdate()};this.setTexture=function(t,e){mt.activeTexture(mt.TEXTURE0+e);t.needsUpdate?K.uploadTexture(t):mt.bindTexture(mt.TEXTURE_2D,t.__webglTexture)};this.setRenderTarget=function(e){var r=e instanceof t.WebGLRenderTargetCube;if(e&&void 0===e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0);void 0===e.stencilBuffer&&(e.stencilBuffer=!0);e.addEventListener("dispose",Gt);e.__webglTexture=mt.createTexture();K.info.memory.textures++;var i=t.Math.isPowerOfTwo(e.width)&&t.Math.isPowerOfTwo(e.height),n=C(e.format),o=C(e.type);if(r){e.__webglFramebuffer=[];e.__webglRenderbuffer=[];mt.bindTexture(mt.TEXTURE_CUBE_MAP,e.__webglTexture);M(mt.TEXTURE_CUBE_MAP,e,i);for(var a=0;6>a;a++){e.__webglFramebuffer[a]=mt.createFramebuffer();e.__webglRenderbuffer[a]=mt.createRenderbuffer();mt.texImage2D(mt.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,n,e.width,e.height,0,n,o,null);var s=e,h=mt.TEXTURE_CUBE_MAP_POSITIVE_X+a;mt.bindFramebuffer(mt.FRAMEBUFFER,e.__webglFramebuffer[a]);mt.framebufferTexture2D(mt.FRAMEBUFFER,mt.COLOR_ATTACHMENT0,h,s.__webglTexture,0);T(e.__webglRenderbuffer[a],e)}i&&mt.generateMipmap(mt.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=mt.createFramebuffer(),e.__webglRenderbuffer=e.shareDepthFrom?e.shareDepthFrom.__webglRenderbuffer:mt.createRenderbuffer(),mt.bindTexture(mt.TEXTURE_2D,e.__webglTexture),M(mt.TEXTURE_2D,e,i),mt.texImage2D(mt.TEXTURE_2D,0,n,e.width,e.height,0,n,o,null),n=mt.TEXTURE_2D,mt.bindFramebuffer(mt.FRAMEBUFFER,e.__webglFramebuffer),mt.framebufferTexture2D(mt.FRAMEBUFFER,mt.COLOR_ATTACHMENT0,n,e.__webglTexture,0),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?mt.framebufferRenderbuffer(mt.FRAMEBUFFER,mt.DEPTH_ATTACHMENT,mt.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&mt.framebufferRenderbuffer(mt.FRAMEBUFFER,mt.DEPTH_STENCIL_ATTACHMENT,mt.RENDERBUFFER,e.__webglRenderbuffer):T(e.__webglRenderbuffer,e),i&&mt.generateMipmap(mt.TEXTURE_2D);r?mt.bindTexture(mt.TEXTURE_CUBE_MAP,null):mt.bindTexture(mt.TEXTURE_2D,null);mt.bindRenderbuffer(mt.RENDERBUFFER,null);mt.bindFramebuffer(mt.FRAMEBUFFER,null)}e?(r=r?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,i=e.width,e=e.height,o=n=0):(r=null,i=ot,e=at,n=it,o=nt);r!==J&&(mt.bindFramebuffer(mt.FRAMEBUFFER,r),mt.viewport(n,o,i,e),J=r);st=i;ht=e};this.readRenderTargetPixels=function(e,r,i,n,o,a){if(!(e instanceof t.WebGLRenderTarget))console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else if(e.__webglFramebuffer)if(e.format!==t.RGBAFormat)console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");else{var s=!1;e.__webglFramebuffer!==J&&(mt.bindFramebuffer(mt.FRAMEBUFFER,e.__webglFramebuffer),s=!0);mt.checkFramebufferStatus(mt.FRAMEBUFFER)===mt.FRAMEBUFFER_COMPLETE?mt.readPixels(r,i,n,o,mt.RGBA,mt.UNSIGNED_BYTE,a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.");s&&mt.bindFramebuffer(mt.FRAMEBUFFER,J)}};this.initMaterial=function(){t.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){t.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){t.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};this.updateShadowMap=function(){t.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}};t.WebGLRenderTarget=function(e,r,i){this.width=e;this.height=r;i=i||{};this.wrapS=void 0!==i.wrapS?i.wrapS:t.ClampToEdgeWrapping;this.wrapT=void 0!==i.wrapT?i.wrapT:t.ClampToEdgeWrapping;this.magFilter=void 0!==i.magFilter?i.magFilter:t.LinearFilter;this.minFilter=void 0!==i.minFilter?i.minFilter:t.LinearMipMapLinearFilter;this.anisotropy=void 0!==i.anisotropy?i.anisotropy:1;this.offset=new t.Vector2(0,0);this.repeat=new t.Vector2(1,1);this.format=void 0!==i.format?i.format:t.RGBAFormat;this.type=void 0!==i.type?i.type:t.UnsignedByteType;this.depthBuffer=void 0!==i.depthBuffer?i.depthBuffer:!0;this.stencilBuffer=void 0!==i.stencilBuffer?i.stencilBuffer:!0;this.generateMipmaps=!0;this.shareDepthFrom=void 0!==i.shareDepthFrom?i.shareDepthFrom:null};t.WebGLRenderTarget.prototype={constructor:t.WebGLRenderTarget,setSize:function(t,e){this.width=t;this.height=e},clone:function(){var e=new t.WebGLRenderTarget(this.width,this.height);e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.format=this.format;e.type=this.type;e.depthBuffer=this.depthBuffer;e.stencilBuffer=this.stencilBuffer;e.generateMipmaps=this.generateMipmaps;e.shareDepthFrom=this.shareDepthFrom;return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};t.EventDispatcher.prototype.apply(t.WebGLRenderTarget.prototype);t.WebGLRenderTargetCube=function(e,r,i){t.WebGLRenderTarget.call(this,e,r,i);this.activeCubeFace=0};t.WebGLRenderTargetCube.prototype=Object.create(t.WebGLRenderTarget.prototype);t.WebGLRenderTargetCube.prototype.constructor=t.WebGLRenderTargetCube;t.WebGLExtensions=function(e){var r={};this.get=function(i){if(void 0!==r[i])return r[i];var n;switch(i){case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}null===n&&t.warn("THREE.WebGLRenderer: "+i+" extension not supported.");return r[i]=n}};t.WebGLProgram=function(){var e=0;return function(r,i,n,o){var a=r.context,s=n.defines,h=n.__webglShader.uniforms,l=n.attributes,c=n.__webglShader.vertexShader,u=n.__webglShader.fragmentShader,f=n.index0AttributeName;void 0===f&&!0===o.morphTargets&&(f="position");var p="SHADOWMAP_TYPE_BASIC";o.shadowMapType===t.PCFShadowMap?p="SHADOWMAP_TYPE_PCF":o.shadowMapType===t.PCFSoftShadowMap&&(p="SHADOWMAP_TYPE_PCF_SOFT");var d="ENVMAP_TYPE_CUBE",m="ENVMAP_MODE_REFLECTION",g="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(n.envMap.mapping){case t.CubeReflectionMapping:case t.CubeRefractionMapping:d="ENVMAP_TYPE_CUBE";break;case t.EquirectangularReflectionMapping:case t.EquirectangularRefractionMapping:d="ENVMAP_TYPE_EQUIREC";break;case t.SphericalReflectionMapping:d="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case t.CubeRefractionMapping:case t.EquirectangularRefractionMapping:m="ENVMAP_MODE_REFRACTION"}switch(n.combine){case t.MultiplyOperation:g="ENVMAP_BLENDING_MULTIPLY";break;case t.MixOperation:g="ENVMAP_BLENDING_MIX";break;case t.AddOperation:g="ENVMAP_BLENDING_ADD"}}var y=0<r.gammaFactor?r.gammaFactor:1,v,x;v=[];for(var b in s)x=s[b],!1!==x&&(x="#define "+b+" "+x,v.push(x));v=v.join("\n");s=a.createProgram();n instanceof t.RawShaderMaterial?r=n="":(n=["precision "+o.precision+" float;","precision "+o.precision+" int;",v,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"",r.gammaInput?"#define GAMMA_INPUT":"",r.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,"#define MAX_DIR_LIGHTS "+o.maxDirLights,"#define MAX_POINT_LIGHTS "+o.maxPointLights,"#define MAX_SPOT_LIGHTS "+o.maxSpotLights,"#define MAX_HEMI_LIGHTS "+o.maxHemiLights,"#define MAX_SHADOWS "+o.maxShadows,"#define MAX_BONES "+o.maxBones,o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+m:"",o.lightMap?"#define USE_LIGHTMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals?"#define USE_MORPHNORMALS":"",o.wrapAround?"#define WRAP_AROUND":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+p:"",o.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",o.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\n\tattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\n\tattribute vec3 morphTarget0;\n\tattribute vec3 morphTarget1;\n\tattribute vec3 morphTarget2;\n\tattribute vec3 morphTarget3;\n\t#ifdef USE_MORPHNORMALS\n\t\tattribute vec3 morphNormal0;\n\t\tattribute vec3 morphNormal1;\n\t\tattribute vec3 morphNormal2;\n\t\tattribute vec3 morphNormal3;\n\t#else\n\t\tattribute vec3 morphTarget4;\n\t\tattribute vec3 morphTarget5;\n\t\tattribute vec3 morphTarget6;\n\t\tattribute vec3 morphTarget7;\n\t#endif\n#endif\n#ifdef USE_SKINNING\n\tattribute vec4 skinIndex;\n\tattribute vec4 skinWeight;\n#endif\n"].join("\n"),r=["precision "+o.precision+" float;","precision "+o.precision+" int;",o.bumpMap||o.normalMap||o.flatShading?"#extension GL_OES_standard_derivatives : enable":"",v,"#define MAX_DIR_LIGHTS "+o.maxDirLights,"#define MAX_POINT_LIGHTS "+o.maxPointLights,"#define MAX_SPOT_LIGHTS "+o.maxSpotLights,"#define MAX_HEMI_LIGHTS "+o.maxHemiLights,"#define MAX_SHADOWS "+o.maxShadows,o.alphaTest?"#define ALPHATEST "+o.alphaTest:"",r.gammaInput?"#define GAMMA_INPUT":"",r.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+d:"",o.envMap?"#define "+m:"",o.envMap?"#define "+g:"",o.lightMap?"#define USE_LIGHTMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.metal?"#define METAL":"",o.wrapAround?"#define WRAP_AROUND":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+p:"",o.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",o.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"));c=new t.WebGLShader(a,a.VERTEX_SHADER,n+c);u=new t.WebGLShader(a,a.FRAGMENT_SHADER,r+u);a.attachShader(s,c);a.attachShader(s,u);void 0!==f&&a.bindAttribLocation(s,0,f);a.linkProgram(s);f=a.getProgramInfoLog(s);!1===a.getProgramParameter(s,a.LINK_STATUS)&&t.error("THREE.WebGLProgram: shader error: "+a.getError(),"gl.VALIDATE_STATUS",a.getProgramParameter(s,a.VALIDATE_STATUS),"gl.getPRogramInfoLog",f);""!==f&&t.warn("THREE.WebGLProgram: gl.getProgramInfoLog()"+f);a.deleteShader(c);a.deleteShader(u);f="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences bindMatrix bindMatrixInverse".split(" ");o.useVertexTexture?(f.push("boneTexture"),f.push("boneTextureWidth"),f.push("boneTextureHeight")):f.push("boneGlobalMatrices");o.logarithmicDepthBuffer&&f.push("logDepthBufFC");for(var _ in h)f.push(_);h=f;_={};f=0;for(r=h.length;f<r;f++)p=h[f],_[p]=a.getUniformLocation(s,p);this.uniforms=_;f="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" ");for(h=0;h<o.maxMorphTargets;h++)f.push("morphTarget"+h);for(h=0;h<o.maxMorphNormals;h++)f.push("morphNormal"+h);for(var w in l)f.push(w);o=f;l={};w=0;for(h=o.length;w<h;w++)_=o[w],l[_]=a.getAttribLocation(s,_);this.attributes=l;this.attributesKeys=Object.keys(this.attributes);this.id=e++;this.code=i;this.usedTimes=1;this.program=s;this.vertexShader=c;this.fragmentShader=u;return this}}();t.WebGLShader=function(){var e=function(t){t=t.split("\n");for(var e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")};return function(r,i,n){i=r.createShader(i);r.shaderSource(i,n);r.compileShader(i);!1===r.getShaderParameter(i,r.COMPILE_STATUS)&&t.error("THREE.WebGLShader: Shader couldn't compile.");""!==r.getShaderInfoLog(i)&&t.warn("THREE.WebGLShader: gl.getShaderInfoLog()",r.getShaderInfoLog(i),e(n));return i}}();t.WebGLState=function(e,r){var i=new Uint8Array(16),n=new Uint8Array(16),o=null,a=null,s=null,h=null,l=null,c=null,u=null,f=null,p=null,d=null,m=null,g=null,y=null,v=null,x=null,b=null;this.initAttributes=function(){for(var t=0,e=i.length;t<e;t++)i[t]=0};this.enableAttribute=function(t){i[t]=1;0===n[t]&&(e.enableVertexAttribArray(t),n[t]=1)};this.disableUnusedAttributes=function(){for(var t=0,r=n.length;t<r;t++)n[t]!==i[t]&&(e.disableVertexAttribArray(t),n[t]=0)};this.setBlending=function(i,n,f,p,d,m,g){i!==o&&(i===t.NoBlending?e.disable(e.BLEND):i===t.AdditiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):i===t.SubtractiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):i===t.MultiplyBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):i===t.CustomBlending?e.enable(e.BLEND):(e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),o=i);if(i===t.CustomBlending){d=d||n;m=m||f;g=g||p;if(n!==a||d!==l)e.blendEquationSeparate(r(n),r(d)),a=n,l=d;if(f!==s||p!==h||m!==c||g!==u)e.blendFuncSeparate(r(f),r(p),r(m),r(g)),s=f,h=p,c=m,u=g}else u=c=l=h=s=a=null};this.setDepthTest=function(t){f!==t&&(t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),f=t)};this.setDepthWrite=function(t){p!==t&&(e.depthMask(t),p=t)};this.setColorWrite=function(t){d!==t&&(e.colorMask(t,t,t,t),d=t)};this.setDoubleSided=function(t){m!==t&&(t?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),m=t)};this.setFlipSided=function(t){g!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),g=t)};this.setLineWidth=function(t){t!==y&&(e.lineWidth(t),y=t)};this.setPolygonOffset=function(t,r,i){v!==t&&(t?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),v=t);!t||x===r&&b===i||(e.polygonOffset(r,i),x=r,b=i)};this.reset=function(){for(var t=0;t<n.length;t++)n[t]=0;g=m=d=p=f=o=null}};t.LensFlarePlugin=function(e,r){var i,n,o,a,s,h,l,c,u,f,p=e.context,d,m,g,y,v,x;this.render=function(b,_,w,M){if(0!==r.length){b=new t.Vector3;var S=M/w,T=.5*w,E=.5*M,A=16/M,C=new t.Vector2(A*S,A),L=new t.Vector3(1,1,0),P=new t.Vector2(1,1);if(void 0===g){var A=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),R=new Uint16Array([0,1,2,0,2,3]);d=p.createBuffer();m=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,d);p.bufferData(p.ARRAY_BUFFER,A,p.STATIC_DRAW);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,m);p.bufferData(p.ELEMENT_ARRAY_BUFFER,R,p.STATIC_DRAW);v=p.createTexture();x=p.createTexture();p.bindTexture(p.TEXTURE_2D,v);p.texImage2D(p.TEXTURE_2D,0,p.RGB,16,16,0,p.RGB,p.UNSIGNED_BYTE,null);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST);p.bindTexture(p.TEXTURE_2D,x);p.texImage2D(p.TEXTURE_2D,0,p.RGBA,16,16,0,p.RGBA,p.UNSIGNED_BYTE,null);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST);var A=(y=0<p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS))?{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},R=p.createProgram(),F=p.createShader(p.FRAGMENT_SHADER),U=p.createShader(p.VERTEX_SHADER),B="precision "+e.getPrecision()+" float;\n";p.shaderSource(F,B+A.fragmentShader);p.shaderSource(U,B+A.vertexShader);p.compileShader(F);p.compileShader(U);p.attachShader(R,F);p.attachShader(R,U);p.linkProgram(R);g=R;u=p.getAttribLocation(g,"position");f=p.getAttribLocation(g,"uv");i=p.getUniformLocation(g,"renderType");n=p.getUniformLocation(g,"map");o=p.getUniformLocation(g,"occlusionMap");a=p.getUniformLocation(g,"opacity");s=p.getUniformLocation(g,"color");h=p.getUniformLocation(g,"scale");l=p.getUniformLocation(g,"rotation");c=p.getUniformLocation(g,"screenPosition")}p.useProgram(g);p.enableVertexAttribArray(u);p.enableVertexAttribArray(f);p.uniform1i(o,0);p.uniform1i(n,1);p.bindBuffer(p.ARRAY_BUFFER,d);p.vertexAttribPointer(u,2,p.FLOAT,!1,16,0);p.vertexAttribPointer(f,2,p.FLOAT,!1,16,8);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,m);p.disable(p.CULL_FACE);p.depthMask(!1);R=0;for(F=r.length;R<F;R++)if(A=16/M,C.set(A*S,A),U=r[R],b.set(U.matrixWorld.elements[12],U.matrixWorld.elements[13],U.matrixWorld.elements[14]),b.applyMatrix4(_.matrixWorldInverse),b.applyProjection(_.projectionMatrix),L.copy(b),P.x=L.x*T+T,P.y=L.y*E+E,y||0<P.x&&P.x<w&&0<P.y&&P.y<M){p.activeTexture(p.TEXTURE1);p.bindTexture(p.TEXTURE_2D,v);p.copyTexImage2D(p.TEXTURE_2D,0,p.RGB,P.x-8,P.y-8,16,16,0);p.uniform1i(i,0);p.uniform2f(h,C.x,C.y);p.uniform3f(c,L.x,L.y,L.z);p.disable(p.BLEND);p.enable(p.DEPTH_TEST);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0);p.activeTexture(p.TEXTURE0);p.bindTexture(p.TEXTURE_2D,x);p.copyTexImage2D(p.TEXTURE_2D,0,p.RGBA,P.x-8,P.y-8,16,16,0);p.uniform1i(i,1);p.disable(p.DEPTH_TEST);p.activeTexture(p.TEXTURE1);p.bindTexture(p.TEXTURE_2D,v);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0);U.positionScreen.copy(L);U.customUpdateCallback?U.customUpdateCallback(U):U.updateLensFlares();p.uniform1i(i,2);p.enable(p.BLEND);for(var B=0,D=U.lensFlares.length;B<D;B++){var V=U.lensFlares[B];.001<V.opacity&&.001<V.scale&&(L.x=V.x,L.y=V.y,L.z=V.z,A=V.size*V.scale/M,C.x=A*S,C.y=A,p.uniform3f(c,L.x,L.y,L.z),p.uniform2f(h,C.x,C.y),p.uniform1f(l,V.rotation),p.uniform1f(a,V.opacity),p.uniform3f(s,V.color.r,V.color.g,V.color.b),e.state.setBlending(V.blending,V.blendEquation,V.blendSrc,V.blendDst),e.setTexture(V.texture,1),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0))}}p.enable(p.CULL_FACE);p.enable(p.DEPTH_TEST);p.depthMask(!0);e.resetGLState()}}};t.ShadowMapPlugin=function(e,r,i,n){function o(t,e,r){if(e.visible){var n=i[e.id];if(n&&e.castShadow&&(!1===e.frustumCulled||!0===u.intersectsObject(e)))for(var a=0,s=n.length;a<s;a++){var h=n[a];e._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld);g.push(h)}a=0;for(s=e.children.length;a<s;a++)o(t,e.children[a],r)}}var a=e.context,s,h,l,c,u=new t.Frustum,f=new t.Matrix4,p=new t.Vector3,d=new t.Vector3,m=new t.Vector3,g=[],y=t.ShaderLib.depthRGBA,v=t.UniformsUtils.clone(y.uniforms);s=new t.ShaderMaterial({uniforms:v,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader});h=new t.ShaderMaterial({uniforms:v,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,morphTargets:!0});l=new t.ShaderMaterial({uniforms:v,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,skinning:!0});c=new t.ShaderMaterial({uniforms:v,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,morphTargets:!0,skinning:!0});s._shadowPass=!0;h._shadowPass=!0;l._shadowPass=!0;c._shadowPass=!0;this.render=function(i,y){if(!1!==e.shadowMapEnabled){var v,x,b,_,w,M,S,T,E=[];_=0;a.clearColor(1,1,1,1);a.disable(a.BLEND);a.enable(a.CULL_FACE);a.frontFace(a.CCW);e.shadowMapCullFace===t.CullFaceFront?a.cullFace(a.FRONT):a.cullFace(a.BACK);e.state.setDepthTest(!0);v=0;for(x=r.length;v<x;v++)if(b=r[v],b.castShadow)if(b instanceof t.DirectionalLight&&b.shadowCascade)for(w=0;w<b.shadowCascadeCount;w++){var A;if(b.shadowCascadeArray[w])A=b.shadowCascadeArray[w];else{S=b;var C=w;A=new t.DirectionalLight;A.isVirtual=!0;A.onlyShadow=!0;A.castShadow=!0;A.shadowCameraNear=S.shadowCameraNear;A.shadowCameraFar=S.shadowCameraFar;A.shadowCameraLeft=S.shadowCameraLeft;A.shadowCameraRight=S.shadowCameraRight;A.shadowCameraBottom=S.shadowCameraBottom;A.shadowCameraTop=S.shadowCameraTop;A.shadowCameraVisible=S.shadowCameraVisible;A.shadowDarkness=S.shadowDarkness;A.shadowBias=S.shadowCascadeBias[C];A.shadowMapWidth=S.shadowCascadeWidth[C];A.shadowMapHeight=S.shadowCascadeHeight[C];A.pointsWorld=[];A.pointsFrustum=[];T=A.pointsWorld;M=A.pointsFrustum;for(var L=0;8>L;L++)T[L]=new t.Vector3,M[L]=new t.Vector3;T=S.shadowCascadeNearZ[C];S=S.shadowCascadeFarZ[C];M[0].set(-1,-1,T);M[1].set(1,-1,T);M[2].set(-1,1,T);M[3].set(1,1,T);M[4].set(-1,-1,S);M[5].set(1,-1,S);M[6].set(-1,1,S);M[7].set(1,1,S);A.originalCamera=y;M=new t.Gyroscope;M.position.copy(b.shadowCascadeOffset);M.add(A);M.add(A.target);y.add(M);b.shadowCascadeArray[w]=A}C=b;T=w;S=C.shadowCascadeArray[T];S.position.copy(C.position);S.target.position.copy(C.target.position);S.lookAt(S.target);S.shadowCameraVisible=C.shadowCameraVisible;S.shadowDarkness=C.shadowDarkness;S.shadowBias=C.shadowCascadeBias[T];M=C.shadowCascadeNearZ[T];C=C.shadowCascadeFarZ[T];S=S.pointsFrustum;S[0].z=M;S[1].z=M;S[2].z=M;S[3].z=M;S[4].z=C;S[5].z=C;S[6].z=C;S[7].z=C;E[_]=A;_++}else E[_]=b,_++;v=0;for(x=E.length;v<x;v++){b=E[v];b.shadowMap||(w=t.LinearFilter,e.shadowMapType===t.PCFSoftShadowMap&&(w=t.NearestFilter),b.shadowMap=new t.WebGLRenderTarget(b.shadowMapWidth,b.shadowMapHeight,{minFilter:w,magFilter:w,format:t.RGBAFormat}),b.shadowMapSize=new t.Vector2(b.shadowMapWidth,b.shadowMapHeight),b.shadowMatrix=new t.Matrix4);if(!b.shadowCamera){if(b instanceof t.SpotLight)b.shadowCamera=new t.PerspectiveCamera(b.shadowCameraFov,b.shadowMapWidth/b.shadowMapHeight,b.shadowCameraNear,b.shadowCameraFar);else if(b instanceof t.DirectionalLight)b.shadowCamera=new t.OrthographicCamera(b.shadowCameraLeft,b.shadowCameraRight,b.shadowCameraTop,b.shadowCameraBottom,b.shadowCameraNear,b.shadowCameraFar);else{t.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",b);continue}i.add(b.shadowCamera);!0===i.autoUpdate&&i.updateMatrixWorld()}b.shadowCameraVisible&&!b.cameraHelper&&(b.cameraHelper=new t.CameraHelper(b.shadowCamera),i.add(b.cameraHelper));if(b.isVirtual&&A.originalCamera==y){w=y;_=b.shadowCamera;M=b.pointsFrustum;S=b.pointsWorld;p.set(Infinity,Infinity,Infinity);d.set(-Infinity,-Infinity,-Infinity);for(C=0;8>C;C++)T=S[C],T.copy(M[C]),T.unproject(w),T.applyMatrix4(_.matrixWorldInverse),T.x<p.x&&(p.x=T.x),T.x>d.x&&(d.x=T.x),T.y<p.y&&(p.y=T.y),T.y>d.y&&(d.y=T.y),T.z<p.z&&(p.z=T.z),T.z>d.z&&(d.z=T.z);_.left=p.x;_.right=d.x;_.top=d.y;_.bottom=p.y;_.updateProjectionMatrix()}_=b.shadowMap;M=b.shadowMatrix;w=b.shadowCamera;w.position.setFromMatrixPosition(b.matrixWorld);m.setFromMatrixPosition(b.target.matrixWorld);w.lookAt(m);w.updateMatrixWorld();w.matrixWorldInverse.getInverse(w.matrixWorld);b.cameraHelper&&(b.cameraHelper.visible=b.shadowCameraVisible);b.shadowCameraVisible&&b.cameraHelper.update();M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);M.multiply(w.projectionMatrix);M.multiply(w.matrixWorldInverse);f.multiplyMatrices(w.projectionMatrix,w.matrixWorldInverse);u.setFromMatrix(f);e.setRenderTarget(_);e.clear();g.length=0;o(i,i,w);b=0;for(_=g.length;b<_;b++)S=g[b],M=S.object,S=S.buffer,C=M.material instanceof t.MeshFaceMaterial?M.material.materials[0]:M.material,T=void 0!==M.geometry.morphTargets&&0<M.geometry.morphTargets.length&&C.morphTargets,L=M instanceof t.SkinnedMesh&&C.skinning,T=M.customDepthMaterial?M.customDepthMaterial:L?T?c:l:T?h:s,e.setMaterialFaces(C),S instanceof t.BufferGeometry?e.renderBufferDirect(w,r,null,T,S,M):e.renderBuffer(w,r,null,T,S,M);b=0;for(_=n.length;b<_;b++)S=n[b],M=S.object,M.visible&&M.castShadow&&(M._modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,M.matrixWorld),e.renderImmediateObject(w,r,null,s,M))}v=e.getClearColor();x=e.getClearAlpha();a.clearColor(v.r,v.g,v.b,x);a.enable(a.BLEND);e.shadowMapCullFace===t.CullFaceFront&&a.cullFace(a.BACK);e.resetGLState()}}};t.SpritePlugin=function(e,r){var i,n,o,a,s,h,l,c,u,f,p,d,m,g,y,v,x;function b(t,e){return t.z!==e.z?e.z-t.z:e.id-t.id}var _=e.context,w,M,S,T,E=new t.Vector3,A=new t.Quaternion,C=new t.Vector3;this.render=function(L,P){if(0!==r.length){if(void 0===S){var R=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),F=new Uint16Array([0,1,2,0,2,3]);w=_.createBuffer();M=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,w);_.bufferData(_.ARRAY_BUFFER,R,_.STATIC_DRAW);_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,M);_.bufferData(_.ELEMENT_ARRAY_BUFFER,F,_.STATIC_DRAW);var R=_.createProgram(),F=_.createShader(_.VERTEX_SHADER),U=_.createShader(_.FRAGMENT_SHADER);_.shaderSource(F,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));_.shaderSource(U,["precision "+e.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
_.compileShader(F);_.compileShader(U);_.attachShader(R,F);_.attachShader(R,U);_.linkProgram(R);S=R;v=_.getAttribLocation(S,"position");x=_.getAttribLocation(S,"uv");i=_.getUniformLocation(S,"uvOffset");n=_.getUniformLocation(S,"uvScale");o=_.getUniformLocation(S,"rotation");a=_.getUniformLocation(S,"scale");s=_.getUniformLocation(S,"color");h=_.getUniformLocation(S,"map");l=_.getUniformLocation(S,"opacity");c=_.getUniformLocation(S,"modelViewMatrix");u=_.getUniformLocation(S,"projectionMatrix");f=_.getUniformLocation(S,"fogType");p=_.getUniformLocation(S,"fogDensity");d=_.getUniformLocation(S,"fogNear");m=_.getUniformLocation(S,"fogFar");g=_.getUniformLocation(S,"fogColor");y=_.getUniformLocation(S,"alphaTest");R=document.createElement("canvas");R.width=8;R.height=8;F=R.getContext("2d");F.fillStyle="white";F.fillRect(0,0,8,8);T=new t.Texture(R);T.needsUpdate=!0}_.useProgram(S);_.enableVertexAttribArray(v);_.enableVertexAttribArray(x);_.disable(_.CULL_FACE);_.enable(_.BLEND);_.bindBuffer(_.ARRAY_BUFFER,w);_.vertexAttribPointer(v,2,_.FLOAT,!1,16,0);_.vertexAttribPointer(x,2,_.FLOAT,!1,16,8);_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,M);_.uniformMatrix4fv(u,!1,P.projectionMatrix.elements);_.activeTexture(_.TEXTURE0);_.uniform1i(h,0);F=R=0;(U=L.fog)?(_.uniform3f(g,U.color.r,U.color.g,U.color.b),U instanceof t.Fog?(_.uniform1f(d,U.near),_.uniform1f(m,U.far),_.uniform1i(f,1),F=R=1):U instanceof t.FogExp2&&(_.uniform1f(p,U.density),_.uniform1i(f,2),F=R=2)):(_.uniform1i(f,0),F=R=0);for(var U=0,B=r.length;U<B;U++){var D=r[U];D._modelViewMatrix.multiplyMatrices(P.matrixWorldInverse,D.matrixWorld);D.z=-D._modelViewMatrix.elements[14]}r.sort(b);for(var V=[],U=0,B=r.length;U<B;U++){var D=r[U],z=D.material;_.uniform1f(y,z.alphaTest);_.uniformMatrix4fv(c,!1,D._modelViewMatrix.elements);D.matrixWorld.decompose(E,A,C);V[0]=C.x;V[1]=C.y;D=0;L.fog&&z.fog&&(D=F);R!==D&&(_.uniform1i(f,D),R=D);null!==z.map?(_.uniform2f(i,z.map.offset.x,z.map.offset.y),_.uniform2f(n,z.map.repeat.x,z.map.repeat.y)):(_.uniform2f(i,0,0),_.uniform2f(n,1,1));_.uniform1f(l,z.opacity);_.uniform3f(s,z.color.r,z.color.g,z.color.b);_.uniform1f(o,z.rotation);_.uniform2fv(a,V);e.state.setBlending(z.blending,z.blendEquation,z.blendSrc,z.blendDst);e.state.setDepthTest(z.depthTest);e.state.setDepthWrite(z.depthWrite);z.map&&z.map.image&&z.map.image.width?e.setTexture(z.map,0):e.setTexture(T,0);_.drawElements(_.TRIANGLES,6,_.UNSIGNED_SHORT,0)}_.enable(_.CULL_FACE);e.resetGLState()}}};t.GeometryUtils={merge:function(e,r,i){t.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;r instanceof t.Mesh&&(r.matrixAutoUpdate&&r.updateMatrix(),n=r.matrix,r=r.geometry);e.merge(r,n,i)},center:function(e){t.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return e.center()}};t.ImageUtils={crossOrigin:void 0,loadTexture:function(e,r,i,n){var o=new t.ImageLoader;o.crossOrigin=this.crossOrigin;var a=new t.Texture((void 0),r);o.load(e,function(t){a.image=t;a.needsUpdate=!0;i&&i(a)},void 0,function(t){n&&n(t)});a.sourceFile=e;return a},loadTextureCube:function(e,r,i,n){var o=new t.ImageLoader;o.crossOrigin=this.crossOrigin;var a=new t.CubeTexture([],r);a.flipY=!1;var s=0;r=function(t){o.load(e[t],function(e){a.images[t]=e;s+=1;6===s&&(a.needsUpdate=!0,i&&i(a))},void 0,n)};for(var h=0,l=e.length;h<l;++h)r(h);return a},loadCompressedTexture:function(){t.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){t.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(t,e){var r=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return[t[0]/e,t[1]/e,t[2]/e]};e|=1;var i=t.width,n=t.height,o=document.createElement("canvas");o.width=i;o.height=n;var a=o.getContext("2d");a.drawImage(t,0,0);for(var s=a.getImageData(0,0,i,n).data,h=a.createImageData(i,n),l=h.data,c=0;c<i;c++)for(var u=0;u<n;u++){var f=0>u-1?0:u-1,p=u+1>n-1?n-1:u+1,d=0>c-1?0:c-1,m=c+1>i-1?i-1:c+1,g=[],y=[0,0,s[4*(u*i+c)]/255*e];g.push([-1,0,s[4*(u*i+d)]/255*e]);g.push([-1,-1,s[4*(f*i+d)]/255*e]);g.push([0,-1,s[4*(f*i+c)]/255*e]);g.push([1,-1,s[4*(f*i+m)]/255*e]);g.push([1,0,s[4*(u*i+m)]/255*e]);g.push([1,1,s[4*(p*i+m)]/255*e]);g.push([0,1,s[4*(p*i+c)]/255*e]);g.push([-1,1,s[4*(p*i+d)]/255*e]);f=[];d=g.length;for(p=0;p<d;p++){var m=g[p],v=g[(p+1)%d],m=[m[0]-y[0],m[1]-y[1],m[2]-y[2]],v=[v[0]-y[0],v[1]-y[1],v[2]-y[2]];f.push(r([m[1]*v[2]-m[2]*v[1],m[2]*v[0]-m[0]*v[2],m[0]*v[1]-m[1]*v[0]]))}g=[0,0,0];for(p=0;p<f.length;p++)g[0]+=f[p][0],g[1]+=f[p][1],g[2]+=f[p][2];g[0]/=f.length;g[1]/=f.length;g[2]/=f.length;y=4*(u*i+c);l[y]=(g[0]+1)/2*255|0;l[y+1]=(g[1]+1)/2*255|0;l[y+2]=255*g[2]|0;l[y+3]=255}a.putImageData(h,0,0);return o},generateDataTexture:function(e,r,i){var n=e*r,o=new Uint8Array(3*n),a=Math.floor(255*i.r),s=Math.floor(255*i.g);i=Math.floor(255*i.b);for(var h=0;h<n;h++)o[3*h]=a,o[3*h+1]=s,o[3*h+2]=i;e=new t.DataTexture(o,e,r,t.RGBFormat);e.needsUpdate=!0;return e}};t.SceneUtils={createMultiMaterialObject:function(e,r){for(var i=new t.Object3D,n=0,o=r.length;n<o;n++)i.add(new t.Mesh(e,r[n]));return i},detach:function(t,e,r){t.applyMatrix(e.matrixWorld);e.remove(t);r.add(t)},attach:function(e,r,i){var n=new t.Matrix4;n.getInverse(i.matrixWorld);e.applyMatrix(n);r.remove(e);i.add(e)}};t.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(t){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(t){var e=t.familyName.toLowerCase();this.faces[e]=this.faces[e]||{};this.faces[e][t.cssFontWeight]=this.faces[e][t.cssFontWeight]||{};this.faces[e][t.cssFontWeight][t.cssFontStyle]=t;return this.faces[e][t.cssFontWeight][t.cssFontStyle]=t},drawText:function(e){var r=this.getFace(),i=this.size/r.resolution,n=0,o=String(e).split(""),a=o.length,s=[];for(e=0;e<a;e++){var h=new t.Path,h=this.extractGlyphPoints(o[e],r,i,n,h),n=n+h.offset;s.push(h.path)}return{paths:s,offset:n/2}},extractGlyphPoints:function(e,r,i,n,o){var a=[],s,h,l,c,u,f,p,d,m,g,y,v=r.glyphs[e]||r.glyphs["?"];if(v){if(v.o)for(r=v._cachedOutline||(v._cachedOutline=v.o.split(" ")),c=r.length,e=0;e<c;)switch(l=r[e++],l){case"m":l=r[e++]*i+n;u=r[e++]*i;o.moveTo(l,u);break;case"l":l=r[e++]*i+n;u=r[e++]*i;o.lineTo(l,u);break;case"q":l=r[e++]*i+n;u=r[e++]*i;d=r[e++]*i+n;m=r[e++]*i;o.quadraticCurveTo(d,m,l,u);if(s=a[a.length-1])for(f=s.x,p=s.y,s=1,h=this.divisions;s<=h;s++){var x=s/h;t.Shape.Utils.b2(x,f,d,l);t.Shape.Utils.b2(x,p,m,u)}break;case"b":if(l=r[e++]*i+n,u=r[e++]*i,d=r[e++]*i+n,m=r[e++]*i,g=r[e++]*i+n,y=r[e++]*i,o.bezierCurveTo(d,m,g,y,l,u),s=a[a.length-1])for(f=s.x,p=s.y,s=1,h=this.divisions;s<=h;s++)x=s/h,t.Shape.Utils.b3(x,f,d,g,l),t.Shape.Utils.b3(x,p,m,y,u)}return{offset:v.ha*i,path:o}}}};t.FontUtils.generateShapes=function(e,r){r=r||{};var i=void 0!==r.curveSegments?r.curveSegments:4,n=void 0!==r.font?r.font:"helvetiker",o=void 0!==r.weight?r.weight:"normal",a=void 0!==r.style?r.style:"normal";t.FontUtils.size=void 0!==r.size?r.size:100;t.FontUtils.divisions=i;t.FontUtils.face=n;t.FontUtils.weight=o;t.FontUtils.style=a;i=t.FontUtils.drawText(e).paths;n=[];o=0;for(a=i.length;o<a;o++)Array.prototype.push.apply(n,i[o].toShapes());return n};(function(e){var r=function(t){for(var e=t.length,r=0,i=e-1,n=0;n<e;i=n++)r+=t[i].x*t[n].y-t[n].x*t[i].y;return.5*r};e.Triangulate=function(e,i){var n=e.length;if(3>n)return null;var o=[],a=[],s=[],h,l,c;if(0<r(e))for(l=0;l<n;l++)a[l]=l;else for(l=0;l<n;l++)a[l]=n-1-l;var u=2*n;for(l=n-1;2<n;){if(0>=u--){t.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()");break}h=l;n<=h&&(h=0);l=h+1;n<=l&&(l=0);c=l+1;n<=c&&(c=0);var f;t:{var p=f=void 0,d=void 0,m=void 0,g=void 0,y=void 0,v=void 0,x=void 0,b=void 0,p=e[a[h]].x,d=e[a[h]].y,m=e[a[l]].x,g=e[a[l]].y,y=e[a[c]].x,v=e[a[c]].y;if(1e-10>(m-p)*(v-d)-(g-d)*(y-p))f=!1;else{var _=void 0,w=void 0,M=void 0,S=void 0,T=void 0,E=void 0,A=void 0,C=void 0,L=void 0,P=void 0,L=C=A=b=x=void 0,_=y-m,w=v-g,M=p-y,S=d-v,T=m-p,E=g-d;for(f=0;f<n;f++)if(x=e[a[f]].x,b=e[a[f]].y,!(x===p&&b===d||x===m&&b===g||x===y&&b===v)&&(A=x-p,C=b-d,L=x-m,P=b-g,x-=y,b-=v,L=_*P-w*L,A=T*C-E*A,C=M*b-S*x,-1e-10<=L&&-1e-10<=C&&-1e-10<=A)){f=!1;break t}f=!0}}if(f){o.push([e[a[h]],e[a[l]],e[a[c]]]);s.push([a[h],a[l],a[c]]);h=l;for(c=l+1;c<n;h++,c++)a[h]=a[c];n--;u=2*n}}return i?s:o};e.Triangulate.area=r;return e})(t.FontUtils);self._typeface_js={faces:t.FontUtils.faces,loadFace:t.FontUtils.loadFace};t.typeface_js=self._typeface_js;t.Audio=function(e){t.Object3D.call(this);this.type="Audio";this.context=e.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain);this.autoplay=!1;this.startTime=0;this.isPlaying=!1};t.Audio.prototype=Object.create(t.Object3D.prototype);t.Audio.prototype.constructor=t.Audio;t.Audio.prototype.load=function(t){var e=this,r=new XMLHttpRequest;r.open("GET",t,!0);r.responseType="arraybuffer";r.onload=function(t){e.context.decodeAudioData(this.response,function(t){e.source.buffer=t;e.autoplay&&e.play()})};r.send();return this};t.Audio.prototype.play=function(){if(!0===this.isPlaying)t.warn("THREE.Audio: Audio is already playing.");else{var e=this.context.createBufferSource();e.buffer=this.source.buffer;e.loop=this.source.loop;e.onended=this.source.onended;e.connect(this.panner);e.start(0,this.startTime);this.isPlaying=!0;this.source=e}};t.Audio.prototype.pause=function(){this.source.stop();this.startTime=this.context.currentTime};t.Audio.prototype.stop=function(){this.source.stop();this.startTime=0};t.Audio.prototype.onEnded=function(){this.isPlaying=!1};t.Audio.prototype.setLoop=function(t){this.source.loop=t};t.Audio.prototype.setRefDistance=function(t){this.panner.refDistance=t};t.Audio.prototype.setRolloffFactor=function(t){this.panner.rolloffFactor=t};t.Audio.prototype.setVolume=function(t){this.gain.gain.value=t};t.Audio.prototype.updateMatrixWorld=function(){var e=new t.Vector3;return function(r){t.Object3D.prototype.updateMatrixWorld.call(this,r);e.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(e.x,e.y,e.z)}}();t.AudioListener=function(){t.Object3D.call(this);this.type="AudioListener";this.context=new(window.AudioContext||window.webkitAudioContext)};t.AudioListener.prototype=Object.create(t.Object3D.prototype);t.AudioListener.prototype.constructor=t.AudioListener;t.AudioListener.prototype.updateMatrixWorld=function(){var e=new t.Vector3,r=new t.Quaternion,i=new t.Vector3,n=new t.Vector3,o=new t.Vector3,a=new t.Vector3;return function(s){t.Object3D.prototype.updateMatrixWorld.call(this,s);s=this.context.listener;var h=this.up;this.matrixWorld.decompose(e,r,i);n.set(0,0,-1).applyQuaternion(r);o.subVectors(e,a);s.setPosition(e.x,e.y,e.z);s.setOrientation(n.x,n.y,n.z,h.x,h.y,h.z);s.setVelocity(o.x,o.y,o.z);a.copy(e)}}();t.Curve=function(){};t.Curve.prototype.getPoint=function(e){t.warn("THREE.Curve: Warning, getPoint() not implemented!");return null};t.Curve.prototype.getPointAt=function(t){t=this.getUtoTmapping(t);return this.getPoint(t)};t.Curve.prototype.getPoints=function(t){t||(t=5);var e,r=[];for(e=0;e<=t;e++)r.push(this.getPoint(e/t));return r};t.Curve.prototype.getSpacedPoints=function(t){t||(t=5);var e,r=[];for(e=0;e<=t;e++)r.push(this.getPointAt(e/t));return r};t.Curve.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]};t.Curve.prototype.getLengths=function(t){t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e=[],r,i=this.getPoint(0),n,o=0;e.push(0);for(n=1;n<=t;n++)r=this.getPoint(n/t),o+=r.distanceTo(i),e.push(o),i=r;return this.cacheArcLengths=e};t.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0;this.getLengths()};t.Curve.prototype.getUtoTmapping=function(t,e){var r=this.getLengths(),i=0,n=r.length,o;o=e?e:t*r[n-1];for(var a=0,s=n-1,h;a<=s;)if(i=Math.floor(a+(s-a)/2),h=r[i]-o,0>h)a=i+1;else if(0<h)s=i-1;else{s=i;break}i=s;if(r[i]==o)return i/(n-1);a=r[i];return r=(i+(o-a)/(r[i+1]-a))/(n-1)};t.Curve.prototype.getTangent=function(t){var e=t-1e-4;t+=1e-4;0>e&&(e=0);1<t&&(t=1);e=this.getPoint(e);return this.getPoint(t).clone().sub(e).normalize()};t.Curve.prototype.getTangentAt=function(t){t=this.getUtoTmapping(t);return this.getTangent(t)};t.Curve.Utils={tangentQuadraticBezier:function(t,e,r,i){return 2*(1-t)*(r-e)+2*t*(i-r)},tangentCubicBezier:function(t,e,r,i,n){return-3*e*(1-t)*(1-t)+3*r*(1-t)*(1-t)-6*t*r*(1-t)+6*t*i*(1-t)-3*t*t*i+3*t*t*n},tangentSpline:function(t,e,r,i,n){return 6*t*t-6*t+(3*t*t-4*t+1)+(-6*t*t+6*t)+(3*t*t-2*t)},interpolate:function(t,e,r,i,n){t=.5*(r-t);i=.5*(i-e);var o=n*n;return(2*e-2*r+t+i)*n*o+(-3*e+3*r-2*t-i)*o+t*n+e}};t.Curve.create=function(e,r){e.prototype=Object.create(t.Curve.prototype);e.prototype.constructor=e;e.prototype.getPoint=r;return e};t.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=!1};t.CurvePath.prototype=Object.create(t.Curve.prototype);t.CurvePath.prototype.constructor=t.CurvePath;t.CurvePath.prototype.add=function(t){this.curves.push(t)};t.CurvePath.prototype.checkConnection=function(){};t.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),r=this.curves[this.curves.length-1].getPoint(1);e.equals(r)||this.curves.push(new t.LineCurve(r,e))};t.CurvePath.prototype.getPoint=function(t){var e=t*this.getLength(),r=this.getCurveLengths();for(t=0;t<r.length;){if(r[t]>=e)return e=r[t]-e,t=this.curves[t],e=1-e/t.getLength(),t.getPointAt(e);t++}return null};t.CurvePath.prototype.getLength=function(){var t=this.getCurveLengths();return t[t.length-1]};t.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var t=[],e=0,r,i=this.curves.length;for(r=0;r<i;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t};t.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),r,i,n,o,a,s;r=i=Number.NEGATIVE_INFINITY;o=a=Number.POSITIVE_INFINITY;var h,l,c,u,f=e[0]instanceof t.Vector3;u=f?new t.Vector3:new t.Vector2;l=0;for(c=e.length;l<c;l++)h=e[l],h.x>r?r=h.x:h.x<o&&(o=h.x),h.y>i?i=h.y:h.y<a&&(a=h.y),f&&(h.z>n?n=h.z:h.z<s&&(s=h.z)),u.add(h);e={minX:o,minY:a,maxX:r,maxY:i};f&&(e.maxZ=n,e.minZ=s);return e};t.CurvePath.prototype.createPointsGeometry=function(t){t=this.getPoints(t,!0);return this.createGeometry(t)};t.CurvePath.prototype.createSpacedPointsGeometry=function(t){t=this.getSpacedPoints(t,!0);return this.createGeometry(t)};t.CurvePath.prototype.createGeometry=function(e){for(var r=new t.Geometry,i=0;i<e.length;i++)r.vertices.push(new t.Vector3(e[i].x,e[i].y,e[i].z||0));return r};t.CurvePath.prototype.addWrapPath=function(t){this.bends.push(t)};t.CurvePath.prototype.getTransformedPoints=function(t,e){var r=this.getPoints(t),i,n;e||(e=this.bends);i=0;for(n=e.length;i<n;i++)r=this.getWrapPoints(r,e[i]);return r};t.CurvePath.prototype.getTransformedSpacedPoints=function(t,e){var r=this.getSpacedPoints(t),i,n;e||(e=this.bends);i=0;for(n=e.length;i<n;i++)r=this.getWrapPoints(r,e[i]);return r};t.CurvePath.prototype.getWrapPoints=function(t,e){var r=this.getBoundingBox(),i,n,o,a,s,h;i=0;for(n=t.length;i<n;i++)o=t[i],a=o.x,s=o.y,h=a/r.maxX,h=e.getUtoTmapping(h,a),a=e.getPoint(h),h=e.getTangent(h),h.set(-h.y,h.x).multiplyScalar(s),o.x=a.x+h.x,o.y=a.y+h.y;return t};t.Gyroscope=function(){t.Object3D.call(this)};t.Gyroscope.prototype=Object.create(t.Object3D.prototype);t.Gyroscope.prototype.constructor=t.Gyroscope;t.Gyroscope.prototype.updateMatrixWorld=function(){var e=new t.Vector3,r=new t.Quaternion,i=new t.Vector3,n=new t.Vector3,o=new t.Quaternion,a=new t.Vector3;return function(t){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||t)this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(n,o,a),this.matrix.decompose(e,r,i),this.matrixWorld.compose(n,r,a)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0;for(var s=0,h=this.children.length;s<h;s++)this.children[s].updateMatrixWorld(t)}}();t.Path=function(e){t.CurvePath.call(this);this.actions=[];e&&this.fromPoints(e)};t.Path.prototype=Object.create(t.CurvePath.prototype);t.Path.prototype.constructor=t.Path;t.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};t.Path.prototype.fromPoints=function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y)};t.Path.prototype.moveTo=function(e,r){var i=Array.prototype.slice.call(arguments);this.actions.push({action:t.PathActions.MOVE_TO,args:i})};t.Path.prototype.lineTo=function(e,r){var i=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,n=new t.LineCurve(new t.Vector2(n[n.length-2],n[n.length-1]),new t.Vector2(e,r));this.curves.push(n);this.actions.push({action:t.PathActions.LINE_TO,args:i})};t.Path.prototype.quadraticCurveTo=function(e,r,i,n){var o=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,a=new t.QuadraticBezierCurve(new t.Vector2(a[a.length-2],a[a.length-1]),new t.Vector2(e,r),new t.Vector2(i,n));this.curves.push(a);this.actions.push({action:t.PathActions.QUADRATIC_CURVE_TO,args:o})};t.Path.prototype.bezierCurveTo=function(e,r,i,n,o,a){var s=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,h=new t.CubicBezierCurve(new t.Vector2(h[h.length-2],h[h.length-1]),new t.Vector2(e,r),new t.Vector2(i,n),new t.Vector2(o,a));this.curves.push(h);this.actions.push({action:t.PathActions.BEZIER_CURVE_TO,args:s})};t.Path.prototype.splineThru=function(e){var r=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,i=[new t.Vector2(i[i.length-2],i[i.length-1])];Array.prototype.push.apply(i,e);i=new t.SplineCurve(i);this.curves.push(i);this.actions.push({action:t.PathActions.CSPLINE_THRU,args:r})};t.Path.prototype.arc=function(t,e,r,i,n,o){var a=this.actions[this.actions.length-1].args;this.absarc(t+a[a.length-2],e+a[a.length-1],r,i,n,o)};t.Path.prototype.absarc=function(t,e,r,i,n,o){this.absellipse(t,e,r,r,i,n,o)};t.Path.prototype.ellipse=function(t,e,r,i,n,o,a){var s=this.actions[this.actions.length-1].args;this.absellipse(t+s[s.length-2],e+s[s.length-1],r,i,n,o,a)};t.Path.prototype.absellipse=function(e,r,i,n,o,a,s){var h=Array.prototype.slice.call(arguments),l=new t.EllipseCurve(e,r,i,n,o,a,s);this.curves.push(l);l=l.getPoint(1);h.push(l.x);h.push(l.y);this.actions.push({action:t.PathActions.ELLIPSE,args:h})};t.Path.prototype.getSpacedPoints=function(t,e){t||(t=40);for(var r=[],i=0;i<t;i++)r.push(this.getPoint(i/t));return r};t.Path.prototype.getPoints=function(e,r){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,r);e=e||12;var i=[],n,o,a,s,h,l,c,u,f,p,d,m,g;n=0;for(o=this.actions.length;n<o;n++)switch(a=this.actions[n],s=a.action,a=a.args,s){case t.PathActions.MOVE_TO:i.push(new t.Vector2(a[0],a[1]));break;case t.PathActions.LINE_TO:i.push(new t.Vector2(a[0],a[1]));break;case t.PathActions.QUADRATIC_CURVE_TO:h=a[2];l=a[3];f=a[0];p=a[1];0<i.length?(s=i[i.length-1],d=s.x,m=s.y):(s=this.actions[n-1].args,d=s[s.length-2],m=s[s.length-1]);for(a=1;a<=e;a++)g=a/e,s=t.Shape.Utils.b2(g,d,f,h),g=t.Shape.Utils.b2(g,m,p,l),i.push(new t.Vector2(s,g));break;case t.PathActions.BEZIER_CURVE_TO:h=a[4];l=a[5];f=a[0];p=a[1];c=a[2];u=a[3];0<i.length?(s=i[i.length-1],d=s.x,m=s.y):(s=this.actions[n-1].args,d=s[s.length-2],m=s[s.length-1]);for(a=1;a<=e;a++)g=a/e,s=t.Shape.Utils.b3(g,d,f,c,h),g=t.Shape.Utils.b3(g,m,p,u,l),i.push(new t.Vector2(s,g));break;case t.PathActions.CSPLINE_THRU:s=this.actions[n-1].args;g=[new t.Vector2(s[s.length-2],s[s.length-1])];s=e*a[0].length;g=g.concat(a[0]);g=new t.SplineCurve(g);for(a=1;a<=s;a++)i.push(g.getPointAt(a/s));break;case t.PathActions.ARC:h=a[0];l=a[1];p=a[2];c=a[3];s=a[4];f=!!a[5];d=s-c;m=2*e;for(a=1;a<=m;a++)g=a/m,f||(g=1-g),g=c+g*d,s=h+p*Math.cos(g),g=l+p*Math.sin(g),i.push(new t.Vector2(s,g));break;case t.PathActions.ELLIPSE:for(h=a[0],l=a[1],p=a[2],u=a[3],c=a[4],s=a[5],f=!!a[6],d=s-c,m=2*e,a=1;a<=m;a++)g=a/m,f||(g=1-g),g=c+g*d,s=h+p*Math.cos(g),g=l+u*Math.sin(g),i.push(new t.Vector2(s,g))}n=i[i.length-1];1e-10>Math.abs(n.x-i[0].x)&&1e-10>Math.abs(n.y-i[0].y)&&i.splice(i.length-1,1);r&&i.push(i[0]);return i};t.Path.prototype.toShapes=function(e,r){function i(e){for(var r=[],i=0,n=e.length;i<n;i++){var o=e[i],a=new t.Shape;a.actions=o.actions;a.curves=o.curves;r.push(a)}return r}function n(t,e){for(var r=e.length,i=!1,n=r-1,o=0;o<r;n=o++){var a=e[n],s=e[o],h=s.x-a.x,l=s.y-a.y;if(1e-10<Math.abs(l)){if(0>l&&(a=e[o],h=-h,s=e[n],l=-l),!(t.y<a.y||t.y>s.y))if(t.y==a.y){if(t.x==a.x)return!0}else{n=l*(t.x-a.x)-h*(t.y-a.y);if(0==n)return!0;0>n||(i=!i)}}else if(t.y==a.y&&(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x))return!0}return i}var o=function(e){var r,i,n,o,a=[],s=new t.Path;r=0;for(i=e.length;r<i;r++)n=e[r],o=n.args,n=n.action,n==t.PathActions.MOVE_TO&&0!=s.actions.length&&(a.push(s),s=new t.Path),s[n].apply(s,o);0!=s.actions.length&&a.push(s);return a}(this.actions);if(0==o.length)return[];if(!0===r)return i(o);var a,s,h,l=[];if(1==o.length)return s=o[0],h=new t.Shape,h.actions=s.actions,h.curves=s.curves,l.push(h),l;var c=!t.Shape.Utils.isClockWise(o[0].getPoints()),c=e?!c:c;h=[];var u=[],f=[],p=0,d;u[p]=void 0;f[p]=[];var m,g;m=0;for(g=o.length;m<g;m++)s=o[m],d=s.getPoints(),a=t.Shape.Utils.isClockWise(d),(a=e?!a:a)?(!c&&u[p]&&p++,u[p]={s:new t.Shape,p:d},u[p].s.actions=s.actions,u[p].s.curves=s.curves,c&&p++,f[p]=[]):f[p].push({h:s,p:d[0]});if(!u[0])return i(o);if(1<u.length){m=!1;g=[];s=0;for(o=u.length;s<o;s++)h[s]=[];s=0;for(o=u.length;s<o;s++)for(a=f[s],c=0;c<a.length;c++){p=a[c];d=!0;for(var y=0;y<u.length;y++)n(p.p,u[y].p)&&(s!=y&&g.push({froms:s,tos:y,hole:c}),d?(d=!1,h[y].push(p)):m=!0);d&&h[s].push(p)}0<g.length&&(m||(f=h))}m=0;for(g=u.length;m<g;m++)for(h=u[m].s,l.push(h),s=f[m],o=0,a=s.length;o<a;o++)h.holes.push(s[o].h);return l};t.Shape=function(){t.Path.apply(this,arguments);this.holes=[]};t.Shape.prototype=Object.create(t.Path.prototype);t.Shape.prototype.constructor=t.Shape;t.Shape.prototype.extrude=function(e){return new t.ExtrudeGeometry(this,e)};t.Shape.prototype.makeGeometry=function(e){return new t.ShapeGeometry(this,e)};t.Shape.prototype.getPointsHoles=function(t){var e,r=this.holes.length,i=[];for(e=0;e<r;e++)i[e]=this.holes[e].getTransformedPoints(t,this.bends);return i};t.Shape.prototype.getSpacedPointsHoles=function(t){var e,r=this.holes.length,i=[];for(e=0;e<r;e++)i[e]=this.holes[e].getTransformedSpacedPoints(t,this.bends);return i};t.Shape.prototype.extractAllPoints=function(t){return{shape:this.getTransformedPoints(t),holes:this.getPointsHoles(t)}};t.Shape.prototype.extractPoints=function(t){return this.useSpacedPoints?this.extractAllSpacedPoints(t):this.extractAllPoints(t)};t.Shape.prototype.extractAllSpacedPoints=function(t){return{shape:this.getTransformedSpacedPoints(t),holes:this.getSpacedPointsHoles(t)}};t.Shape.Utils={triangulateShape:function(e,r){function i(t,e,r){return t.x!=e.x?t.x<e.x?t.x<=r.x&&r.x<=e.x:e.x<=r.x&&r.x<=t.x:t.y<e.y?t.y<=r.y&&r.y<=e.y:e.y<=r.y&&r.y<=t.y}function n(t,e,r,n,o){var a=e.x-t.x,s=e.y-t.y,h=n.x-r.x,l=n.y-r.y,c=t.x-r.x,u=t.y-r.y,f=s*h-a*l,p=s*c-a*u;if(1e-10<Math.abs(f)){if(0<f){if(0>p||p>f)return[];h=l*c-h*u;if(0>h||h>f)return[]}else{if(0<p||p<f)return[];h=l*c-h*u;if(0<h||h<f)return[]}if(0==h)return!o||0!=p&&p!=f?[t]:[];if(h==f)return!o||0!=p&&p!=f?[e]:[];if(0==p)return[r];if(p==f)return[n];o=h/f;return[{x:t.x+o*a,y:t.y+o*s}]}if(0!=p||l*c!=h*u)return[];s=0==a&&0==s;h=0==h&&0==l;if(s&&h)return t.x!=r.x||t.y!=r.y?[]:[t];if(s)return i(r,n,t)?[t]:[];if(h)return i(t,e,r)?[r]:[];0!=a?(t.x<e.x?(a=t,h=t.x,s=e,t=e.x):(a=e,h=e.x,s=t,t=t.x),r.x<n.x?(e=r,f=r.x,l=n,r=n.x):(e=n,f=n.x,l=r,r=r.x)):(t.y<e.y?(a=t,h=t.y,s=e,t=e.y):(a=e,h=e.y,s=t,t=t.y),r.y<n.y?(e=r,f=r.y,l=n,r=n.y):(e=n,f=n.y,l=r,r=r.y));return h<=f?t<f?[]:t==f?o?[]:[e]:t<=r?[e,s]:[e,l]:h>r?[]:h==r?o?[]:[a]:t<=r?[a,s]:[a,l]}function o(t,e,r,i){var n=e.x-t.x,o=e.y-t.y;e=r.x-t.x;r=r.y-t.y;var a=i.x-t.x;i=i.y-t.y;t=n*r-o*e;n=n*i-o*a;return 1e-10<Math.abs(t)?(e=a*r-i*e,0<t?0<=n&&0<=e:0<=n||0<=e):0<n}var a,s,h,l,c,u={};h=e.concat();a=0;for(s=r.length;a<s;a++)Array.prototype.push.apply(h,r[a]);a=0;for(s=h.length;a<s;a++)c=h[a].x+":"+h[a].y,void 0!==u[c]&&t.warn("THREE.Shape: Duplicate point",c),u[c]=a;a=function(t,e){function r(t,e){var r=s.length-1,i=t-1;0>i&&(i=r);var n=t+1;n>r&&(n=0);r=o(s[t],s[i],s[n],h[e]);if(!r)return!1;r=h.length-1;i=e-1;0>i&&(i=r);n=e+1;n>r&&(n=0);return(r=o(h[e],h[i],h[n],s[t]))?!0:!1}function i(t,e){var r,i;for(r=0;r<s.length;r++)if(i=r+1,i%=s.length,i=n(t,e,s[r],s[i],!0),0<i.length)return!0;return!1}function a(t,r){var i,o,a,s;for(i=0;i<l.length;i++)for(o=e[l[i]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,s=n(t,r,o[a],o[s],!0),0<s.length)return!0;return!1}var s=t.concat(),h,l=[],c,u,f,p,d,m=[],g,y,v,x=0;for(c=e.length;x<c;x++)l.push(x);g=0;for(var b=2*l.length;0<l.length;){b--;if(0>b){console.log("Infinite Loop! Holes left:"+l.length+", Probably Hole outside Shape!");break}for(u=g;u<s.length;u++){f=s[u];c=-1;for(x=0;x<l.length;x++)if(p=l[x],d=f.x+":"+f.y+":"+p,void 0===m[d]){h=e[p];for(y=0;y<h.length;y++)if(p=h[y],r(u,y)&&!i(f,p)&&!a(f,p)){c=y;l.splice(x,1);g=s.slice(0,u+1);p=s.slice(u);y=h.slice(c);v=h.slice(0,c+1);s=g.concat(y).concat(v).concat(p);g=u;break}if(0<=c)break;m[d]=!0}if(0<=c)break}}return s}(e,r);var f=t.FontUtils.Triangulate(a,!1);a=0;for(s=f.length;a<s;a++)for(l=f[a],h=0;3>h;h++)c=l[h].x+":"+l[h].y,c=u[c],void 0!==c&&(l[h]=c);return f.concat()},isClockWise:function(e){return 0>t.FontUtils.Triangulate.area(e)},b2p0:function(t,e){var r=1-t;return r*r*e},b2p1:function(t,e){return 2*(1-t)*t*e},b2p2:function(t,e){return t*t*e},b2:function(t,e,r,i){return this.b2p0(t,e)+this.b2p1(t,r)+this.b2p2(t,i)},b3p0:function(t,e){var r=1-t;return r*r*r*e},b3p1:function(t,e){var r=1-t;return 3*r*r*t*e},b3p2:function(t,e){return 3*(1-t)*t*t*e},b3p3:function(t,e){return t*t*t*e},b3:function(t,e,r,i,n){return this.b3p0(t,e)+this.b3p1(t,r)+this.b3p2(t,i)+this.b3p3(t,n)}};t.LineCurve=function(t,e){this.v1=t;this.v2=e};t.LineCurve.prototype=Object.create(t.Curve.prototype);t.LineCurve.prototype.constructor=t.LineCurve;t.LineCurve.prototype.getPoint=function(t){var e=this.v2.clone().sub(this.v1);e.multiplyScalar(t).add(this.v1);return e};t.LineCurve.prototype.getPointAt=function(t){return this.getPoint(t)};t.LineCurve.prototype.getTangent=function(t){return this.v2.clone().sub(this.v1).normalize()};t.QuadraticBezierCurve=function(t,e,r){this.v0=t;this.v1=e;this.v2=r};t.QuadraticBezierCurve.prototype=Object.create(t.Curve.prototype);t.QuadraticBezierCurve.prototype.constructor=t.QuadraticBezierCurve;t.QuadraticBezierCurve.prototype.getPoint=function(e){var r=new t.Vector2;r.x=t.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);r.y=t.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);return r};t.QuadraticBezierCurve.prototype.getTangent=function(e){var r=new t.Vector2;r.x=t.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x);r.y=t.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);return r.normalize()};t.CubicBezierCurve=function(t,e,r,i){this.v0=t;this.v1=e;this.v2=r;this.v3=i};t.CubicBezierCurve.prototype=Object.create(t.Curve.prototype);t.CubicBezierCurve.prototype.constructor=t.CubicBezierCurve;t.CubicBezierCurve.prototype.getPoint=function(e){var r;r=t.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);e=t.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new t.Vector2(r,e)};t.CubicBezierCurve.prototype.getTangent=function(e){var r;r=t.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);e=t.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);r=new t.Vector2(r,e);r.normalize();return r};t.SplineCurve=function(t){this.points=void 0==t?[]:t};t.SplineCurve.prototype=Object.create(t.Curve.prototype);t.SplineCurve.prototype.constructor=t.SplineCurve;t.SplineCurve.prototype.getPoint=function(e){var r=this.points;e*=r.length-1;var i=Math.floor(e);e-=i;var n=r[0==i?i:i-1],o=r[i],a=r[i>r.length-2?r.length-1:i+1],r=r[i>r.length-3?r.length-1:i+2],i=new t.Vector2;i.x=t.Curve.Utils.interpolate(n.x,o.x,a.x,r.x,e);i.y=t.Curve.Utils.interpolate(n.y,o.y,a.y,r.y,e);return i};t.EllipseCurve=function(t,e,r,i,n,o,a){this.aX=t;this.aY=e;this.xRadius=r;this.yRadius=i;this.aStartAngle=n;this.aEndAngle=o;this.aClockwise=a};t.EllipseCurve.prototype=Object.create(t.Curve.prototype);t.EllipseCurve.prototype.constructor=t.EllipseCurve;t.EllipseCurve.prototype.getPoint=function(e){var r=this.aEndAngle-this.aStartAngle;0>r&&(r+=2*Math.PI);r>2*Math.PI&&(r-=2*Math.PI);e=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-r):this.aStartAngle+e*r;r=new t.Vector2;r.x=this.aX+this.xRadius*Math.cos(e);r.y=this.aY+this.yRadius*Math.sin(e);return r};t.ArcCurve=function(e,r,i,n,o,a){t.EllipseCurve.call(this,e,r,i,i,n,o,a)};t.ArcCurve.prototype=Object.create(t.EllipseCurve.prototype);t.ArcCurve.prototype.constructor=t.ArcCurve;t.LineCurve3=t.Curve.create(function(t,e){this.v1=t;this.v2=e},function(e){var r=new t.Vector3;r.subVectors(this.v2,this.v1);r.multiplyScalar(e);r.add(this.v1);return r});t.QuadraticBezierCurve3=t.Curve.create(function(t,e,r){this.v0=t;this.v1=e;this.v2=r},function(e){var r=new t.Vector3;r.x=t.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);r.y=t.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);r.z=t.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z);return r});t.CubicBezierCurve3=t.Curve.create(function(t,e,r,i){this.v0=t;this.v1=e;this.v2=r;this.v3=i},function(e){var r=new t.Vector3;r.x=t.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);r.y=t.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);r.z=t.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return r});t.SplineCurve3=t.Curve.create(function(t){this.points=void 0==t?[]:t},function(e){var r=this.points;e*=r.length-1;var i=Math.floor(e);e-=i;var n=r[0==i?i:i-1],o=r[i],a=r[i>r.length-2?r.length-1:i+1],r=r[i>r.length-3?r.length-1:i+2],i=new t.Vector3;i.x=t.Curve.Utils.interpolate(n.x,o.x,a.x,r.x,e);i.y=t.Curve.Utils.interpolate(n.y,o.y,a.y,r.y,e);i.z=t.Curve.Utils.interpolate(n.z,o.z,a.z,r.z,e);return i});t.ClosedSplineCurve3=t.Curve.create(function(t){this.points=void 0==t?[]:t},function(e){var r=this.points;e*=r.length-0;var i=Math.floor(e);e-=i;var i=i+(0<i?0:(Math.floor(Math.abs(i)/r.length)+1)*r.length),n=r[(i-1)%r.length],o=r[i%r.length],a=r[(i+1)%r.length],r=r[(i+2)%r.length],i=new t.Vector3;i.x=t.Curve.Utils.interpolate(n.x,o.x,a.x,r.x,e);i.y=t.Curve.Utils.interpolate(n.y,o.y,a.y,r.y,e);i.z=t.Curve.Utils.interpolate(n.z,o.z,a.z,r.z,e);return i});t.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){t.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){t.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){t.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(!0===e.initialized)return e;for(var r=0;r<e.hierarchy.length;r++){for(var i=0;i<e.hierarchy[r].keys.length;i++)if(0>e.hierarchy[r].keys[i].time&&(e.hierarchy[r].keys[i].time=0),void 0!==e.hierarchy[r].keys[i].rot&&!(e.hierarchy[r].keys[i].rot instanceof t.Quaternion)){var n=e.hierarchy[r].keys[i].rot;e.hierarchy[r].keys[i].rot=(new t.Quaternion).fromArray(n)}if(e.hierarchy[r].keys.length&&void 0!==e.hierarchy[r].keys[0].morphTargets){
n={};for(i=0;i<e.hierarchy[r].keys.length;i++)for(var o=0;o<e.hierarchy[r].keys[i].morphTargets.length;o++){var a=e.hierarchy[r].keys[i].morphTargets[o];n[a]=-1}e.hierarchy[r].usedMorphTargets=n;for(i=0;i<e.hierarchy[r].keys.length;i++){var s={};for(a in n){for(o=0;o<e.hierarchy[r].keys[i].morphTargets.length;o++)if(e.hierarchy[r].keys[i].morphTargets[o]===a){s[a]=e.hierarchy[r].keys[i].morphTargetsInfluences[o];break}o===e.hierarchy[r].keys[i].morphTargets.length&&(s[a]=0)}e.hierarchy[r].keys[i].morphTargetsInfluences=s}}for(i=1;i<e.hierarchy[r].keys.length;i++)e.hierarchy[r].keys[i].time===e.hierarchy[r].keys[i-1].time&&(e.hierarchy[r].keys.splice(i,1),i--);for(i=0;i<e.hierarchy[r].keys.length;i++)e.hierarchy[r].keys[i].index=i}e.initialized=!0;return e},parse:function(e){var r=function(t,e){e.push(t);for(var i=0;i<t.children.length;i++)r(t.children[i],e)},i=[];if(e instanceof t.SkinnedMesh)for(var n=0;n<e.skeleton.bones.length;n++)i.push(e.skeleton.bones[n]);else r(e,i);return i},play:function(t){-1===this.animations.indexOf(t)&&this.animations.push(t)},stop:function(t){t=this.animations.indexOf(t);-1!==t&&this.animations.splice(t,1)},update:function(t){for(var e=0;e<this.animations.length;e++)this.animations[e].resetBlendWeights();for(e=0;e<this.animations.length;e++)this.animations[e].update(t)}};t.Animation=function(e,r){this.root=e;this.data=t.AnimationHandler.init(r);this.hierarchy=t.AnimationHandler.parse(e);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=!0;this.weight=0;this.interpolationType=t.AnimationHandler.LINEAR};t.Animation.prototype={constructor:t.Animation,keyTypes:["pos","rot","scl"],play:function(e,r){this.currentTime=void 0!==e?e:0;this.weight=void 0!==r?r:1;this.isPlaying=!0;this.reset();t.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1;t.AnimationHandler.stop(this)},reset:function(){for(var t=0,e=this.hierarchy.length;t<e;t++){var r=this.hierarchy[t];void 0===r.animationCache&&(r.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});var i=this.data.name,n=r.animationCache.animations,o=n[i];void 0===o&&(o={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:r.matrix},n[i]=o);for(r=0;3>r;r++){for(var i=this.keyTypes[r],n=this.data.hierarchy[t].keys[0],a=this.getNextKeyWith(i,t,1);a.time<this.currentTime&&a.index>n.index;)n=a,a=this.getNextKeyWith(i,t,a.index+1);o.prevKey[i]=n;o.nextKey[i]=a}}},resetBlendWeights:function(){for(var t=0,e=this.hierarchy.length;t<e;t++){var r=this.hierarchy[t].animationCache;void 0!==r&&(r=r.blending,r.positionWeight=0,r.quaternionWeight=0,r.scaleWeight=0)}},update:function(){var e=[],r=new t.Vector3,i=new t.Vector3,n=new t.Quaternion,o=function(t,e){var r=[],i=[],n,o,s,h,l,c;n=(t.length-1)*e;o=Math.floor(n);n-=o;r[0]=0===o?o:o-1;r[1]=o;r[2]=o>t.length-2?o:o+1;r[3]=o>t.length-3?o:o+2;o=t[r[0]];h=t[r[1]];l=t[r[2]];c=t[r[3]];r=n*n;s=n*r;i[0]=a(o[0],h[0],l[0],c[0],n,r,s);i[1]=a(o[1],h[1],l[1],c[1],n,r,s);i[2]=a(o[2],h[2],l[2],c[2],n,r,s);return i},a=function(t,e,r,i,n,o,a){t=.5*(r-t);i=.5*(i-e);return(2*(e-r)+t+i)*a+(-3*(e-r)-2*t-i)*o+t*n+e};return function(a){if(!1!==this.isPlaying&&(this.currentTime+=a*this.timeScale,0!==this.weight)){a=this.data.length;if(this.currentTime>a||0>this.currentTime)this.loop?(this.currentTime%=a,0>this.currentTime&&(this.currentTime+=a),this.reset()):this.stop();a=0;for(var s=this.hierarchy.length;a<s;a++)for(var h=this.hierarchy[a],l=h.animationCache.animations[this.data.name],c=h.animationCache.blending,u=0;3>u;u++){var f=this.keyTypes[u],p=l.prevKey[f],d=l.nextKey[f];if(0<this.timeScale&&d.time<=this.currentTime||0>this.timeScale&&p.time>=this.currentTime){p=this.data.hierarchy[a].keys[0];for(d=this.getNextKeyWith(f,a,1);d.time<this.currentTime&&d.index>p.index;)p=d,d=this.getNextKeyWith(f,a,d.index+1);l.prevKey[f]=p;l.nextKey[f]=d}var m=(this.currentTime-p.time)/(d.time-p.time),g=p[f],y=d[f];0>m&&(m=0);1<m&&(m=1);if("pos"===f)if(this.interpolationType===t.AnimationHandler.LINEAR)i.x=g[0]+(y[0]-g[0])*m,i.y=g[1]+(y[1]-g[1])*m,i.z=g[2]+(y[2]-g[2])*m,p=this.weight/(this.weight+c.positionWeight),h.position.lerp(i,p),c.positionWeight+=this.weight;else{if(this.interpolationType===t.AnimationHandler.CATMULLROM||this.interpolationType===t.AnimationHandler.CATMULLROM_FORWARD)e[0]=this.getPrevKeyWith("pos",a,p.index-1).pos,e[1]=g,e[2]=y,e[3]=this.getNextKeyWith("pos",a,d.index+1).pos,m=.33*m+.33,d=o(e,m),p=this.weight/(this.weight+c.positionWeight),c.positionWeight+=this.weight,f=h.position,f.x+=(d[0]-f.x)*p,f.y+=(d[1]-f.y)*p,f.z+=(d[2]-f.z)*p,this.interpolationType===t.AnimationHandler.CATMULLROM_FORWARD&&(m=o(e,1.01*m),r.set(m[0],m[1],m[2]),r.sub(f),r.y=0,r.normalize(),m=Math.atan2(r.x,r.z),h.rotation.set(0,m,0))}else"rot"===f?(t.Quaternion.slerp(g,y,n,m),0===c.quaternionWeight?(h.quaternion.copy(n),c.quaternionWeight=this.weight):(p=this.weight/(this.weight+c.quaternionWeight),t.Quaternion.slerp(h.quaternion,n,h.quaternion,p),c.quaternionWeight+=this.weight)):"scl"===f&&(i.x=g[0]+(y[0]-g[0])*m,i.y=g[1]+(y[1]-g[1])*m,i.z=g[2]+(y[2]-g[2])*m,p=this.weight/(this.weight+c.scaleWeight),h.scale.lerp(i,p),c.scaleWeight+=this.weight)}return!0}}}(),getNextKeyWith:function(e,r,i){var n=this.data.hierarchy[r].keys;for(i=this.interpolationType===t.AnimationHandler.CATMULLROM||this.interpolationType===t.AnimationHandler.CATMULLROM_FORWARD?i<n.length-1?i:n.length-1:i%n.length;i<n.length;i++)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[r].keys[0]},getPrevKeyWith:function(e,r,i){var n=this.data.hierarchy[r].keys;for(i=this.interpolationType===t.AnimationHandler.CATMULLROM||this.interpolationType===t.AnimationHandler.CATMULLROM_FORWARD?0<i?i:0:0<=i?i:i+n.length;0<=i;i--)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[r].keys[n.length-1]}};t.KeyFrameAnimation=function(e){this.root=e.node;this.data=t.AnimationHandler.init(e);this.hierarchy=t.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=!1;this.loop=this.isPaused=!0;e=0;for(var r=this.hierarchy.length;e<r;e++){var i=this.data.hierarchy[e].sids,n=this.hierarchy[e];if(this.data.hierarchy[e].keys.length&&i){for(var o=0;o<i.length;o++){var a=i[o],s=this.getNextKeyWith(a,e,0);s&&s.apply(a)}n.matrixAutoUpdate=!1;this.data.hierarchy[e].node.updateMatrix();n.matrixWorldNeedsUpdate=!0}}};t.KeyFrameAnimation.prototype={constructor:t.KeyFrameAnimation,play:function(e){this.currentTime=void 0!==e?e:0;if(!1===this.isPlaying){this.isPlaying=!0;var r=this.hierarchy.length,i,n;for(e=0;e<r;e++)i=this.hierarchy[e],n=this.data.hierarchy[e],void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey=null,n.animationCache.nextKey=null,n.animationCache.originalMatrix=i.matrix),i=this.data.hierarchy[e].keys,i.length&&(n.animationCache.prevKey=i[0],n.animationCache.nextKey=i[1],this.startTime=Math.min(i[0].time,this.startTime),this.endTime=Math.max(i[i.length-1].time,this.endTime));this.update(0)}this.isPaused=!1;t.AnimationHandler.play(this)},stop:function(){this.isPaused=this.isPlaying=!1;t.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var r=this.hierarchy[e],i=this.data.hierarchy[e];if(void 0!==i.animationCache){var n=i.animationCache.originalMatrix;n.copy(r.matrix);r.matrix=n;delete i.animationCache}}},update:function(t){if(!1!==this.isPlaying){this.currentTime+=t*this.timeScale;t=this.data.length;!0===this.loop&&this.currentTime>t&&(this.currentTime%=t);this.currentTime=Math.min(this.currentTime,t);t=0;for(var e=this.hierarchy.length;t<e;t++){var r=this.hierarchy[t],i=this.data.hierarchy[t],n=i.keys,i=i.animationCache;if(n.length){var o=i.prevKey,a=i.nextKey;if(a.time<=this.currentTime){for(;a.time<this.currentTime&&a.index>o.index;)o=a,a=n[o.index+1];i.prevKey=o;i.nextKey=a}a.time>=this.currentTime?o.interpolate(a,this.currentTime):o.interpolate(a,a.time);this.data.hierarchy[t].node.updateMatrix();r.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(t,e,r){e=this.data.hierarchy[e].keys;for(r%=e.length;r<e.length;r++)if(e[r].hasTarget(t))return e[r];return e[0]},getPrevKeyWith:function(t,e,r){e=this.data.hierarchy[e].keys;for(r=0<=r?r:r+e.length;0<=r;r--)if(e[r].hasTarget(t))return e[r];return e[e.length-1]}};t.MorphAnimation=function(t){this.mesh=t;this.frames=t.morphTargetInfluences.length;this.currentTime=0;this.duration=1e3;this.loop=!0;this.currentFrame=this.lastFrame=0;this.isPlaying=!1};t.MorphAnimation.prototype={constructor:t.MorphAnimation,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(t){if(!1!==this.isPlaying){this.currentTime+=t;!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration);this.currentTime=Math.min(this.currentTime,this.duration);t=this.duration/this.frames;var e=Math.floor(this.currentTime/t),r=this.mesh.morphTargetInfluences;e!=this.currentFrame&&(r[this.lastFrame]=0,r[this.currentFrame]=1,r[e]=0,this.lastFrame=this.currentFrame,this.currentFrame=e);r[e]=this.currentTime%t/t;r[this.lastFrame]=1-r[e]}}};t.BoxGeometry=function(e,r,i,n,o,a){function s(e,r,i,n,o,a,s,l){var c,u=h.widthSegments,f=h.heightSegments,p=o/2,d=a/2,m=h.vertices.length;if("x"===e&&"y"===r||"y"===e&&"x"===r)c="z";else if("x"===e&&"z"===r||"z"===e&&"x"===r)c="y",f=h.depthSegments;else if("z"===e&&"y"===r||"y"===e&&"z"===r)c="x",u=h.depthSegments;var g=u+1,y=f+1,v=o/u,x=a/f,b=new t.Vector3;b[c]=0<s?1:-1;for(o=0;o<y;o++)for(a=0;a<g;a++){var _=new t.Vector3;_[e]=(a*v-p)*i;_[r]=(o*x-d)*n;_[c]=s;h.vertices.push(_)}for(o=0;o<f;o++)for(a=0;a<u;a++)d=a+g*o,e=a+g*(o+1),r=a+1+g*(o+1),i=a+1+g*o,n=new t.Vector2(a/u,1-o/f),s=new t.Vector2(a/u,1-(o+1)/f),c=new t.Vector2((a+1)/u,1-(o+1)/f),p=new t.Vector2((a+1)/u,1-o/f),d=new t.Face3(d+m,e+m,i+m),d.normal.copy(b),d.vertexNormals.push(b.clone(),b.clone(),b.clone()),d.materialIndex=l,h.faces.push(d),h.faceVertexUvs[0].push([n,s,p]),d=new t.Face3(e+m,r+m,i+m),d.normal.copy(b),d.vertexNormals.push(b.clone(),b.clone(),b.clone()),d.materialIndex=l,h.faces.push(d),h.faceVertexUvs[0].push([s.clone(),c,p.clone()])}t.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:e,height:r,depth:i,widthSegments:n,heightSegments:o,depthSegments:a};this.widthSegments=n||1;this.heightSegments=o||1;this.depthSegments=a||1;var h=this;n=e/2;o=r/2;a=i/2;s("z","y",-1,-1,i,r,n,0);s("z","y",1,-1,i,r,-n,1);s("x","z",1,1,e,i,o,2);s("x","z",1,-1,e,i,-o,3);s("x","y",1,-1,e,r,a,4);s("x","y",-1,-1,e,r,-a,5);this.mergeVertices()};t.BoxGeometry.prototype=Object.create(t.Geometry.prototype);t.BoxGeometry.prototype.constructor=t.BoxGeometry;t.CircleGeometry=function(e,r,i,n){t.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:e,segments:r,thetaStart:i,thetaLength:n};e=e||50;r=void 0!==r?Math.max(3,r):8;i=void 0!==i?i:0;n=void 0!==n?n:2*Math.PI;var o,a=[];o=new t.Vector3;var s=new t.Vector2(.5,.5);this.vertices.push(o);a.push(s);for(o=0;o<=r;o++){var h=new t.Vector3,l=i+o/r*n;h.x=e*Math.cos(l);h.y=e*Math.sin(l);this.vertices.push(h);a.push(new t.Vector2((h.x/e+1)/2,(h.y/e+1)/2))}i=new t.Vector3(0,0,1);for(o=1;o<=r;o++)this.faces.push(new t.Face3(o,o+1,0,[i.clone(),i.clone(),i.clone()])),this.faceVertexUvs[0].push([a[o].clone(),a[o+1].clone(),s.clone()]);this.computeFaceNormals();this.boundingSphere=new t.Sphere(new t.Vector3,e)};t.CircleGeometry.prototype=Object.create(t.Geometry.prototype);t.CircleGeometry.prototype.constructor=t.CircleGeometry;t.CubeGeometry=function(e,r,i,n,o,a){t.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry.");return new t.BoxGeometry(e,r,i,n,o,a)};t.CylinderGeometry=function(e,r,i,n,o,a,s,h){t.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:e,radiusBottom:r,height:i,radialSegments:n,heightSegments:o,openEnded:a,thetaStart:s,thetaLength:h};e=void 0!==e?e:20;r=void 0!==r?r:20;i=void 0!==i?i:100;n=n||8;o=o||1;a=void 0!==a?a:!1;s=void 0!==s?s:0;h=void 0!==h?h:2*Math.PI;var l=i/2,c,u,f=[],p=[];for(u=0;u<=o;u++){var d=[],m=[],g=u/o,y=g*(r-e)+e;for(c=0;c<=n;c++){var v=c/n,x=new t.Vector3;x.x=y*Math.sin(v*h+s);x.y=-g*i+l;x.z=y*Math.cos(v*h+s);this.vertices.push(x);d.push(this.vertices.length-1);m.push(new t.Vector2(v,1-g))}f.push(d);p.push(m)}i=(r-e)/i;for(c=0;c<n;c++)for(0!==e?(s=this.vertices[f[0][c]].clone(),h=this.vertices[f[0][c+1]].clone()):(s=this.vertices[f[1][c]].clone(),h=this.vertices[f[1][c+1]].clone()),s.setY(Math.sqrt(s.x*s.x+s.z*s.z)*i).normalize(),h.setY(Math.sqrt(h.x*h.x+h.z*h.z)*i).normalize(),u=0;u<o;u++){var d=f[u][c],m=f[u+1][c],g=f[u+1][c+1],y=f[u][c+1],v=s.clone(),x=s.clone(),b=h.clone(),_=h.clone(),w=p[u][c].clone(),M=p[u+1][c].clone(),S=p[u+1][c+1].clone(),T=p[u][c+1].clone();this.faces.push(new t.Face3(d,m,y,[v,x,_]));this.faceVertexUvs[0].push([w,M,T]);this.faces.push(new t.Face3(m,g,y,[x.clone(),b,_.clone()]));this.faceVertexUvs[0].push([M.clone(),S,T.clone()])}if(!1===a&&0<e)for(this.vertices.push(new t.Vector3(0,l,0)),c=0;c<n;c++)d=f[0][c],m=f[0][c+1],g=this.vertices.length-1,v=new t.Vector3(0,1,0),x=new t.Vector3(0,1,0),b=new t.Vector3(0,1,0),w=p[0][c].clone(),M=p[0][c+1].clone(),S=new t.Vector2(M.x,0),this.faces.push(new t.Face3(d,m,g,[v,x,b])),this.faceVertexUvs[0].push([w,M,S]);if(!1===a&&0<r)for(this.vertices.push(new t.Vector3(0,(-l),0)),c=0;c<n;c++)d=f[o][c+1],m=f[o][c],g=this.vertices.length-1,v=new t.Vector3(0,(-1),0),x=new t.Vector3(0,(-1),0),b=new t.Vector3(0,(-1),0),w=p[o][c+1].clone(),M=p[o][c].clone(),S=new t.Vector2(M.x,1),this.faces.push(new t.Face3(d,m,g,[v,x,b])),this.faceVertexUvs[0].push([w,M,S]);this.computeFaceNormals()};t.CylinderGeometry.prototype=Object.create(t.Geometry.prototype);t.CylinderGeometry.prototype.constructor=t.CylinderGeometry;t.ExtrudeGeometry=function(e,r){"undefined"!==typeof e&&(t.Geometry.call(this),this.type="ExtrudeGeometry",e=e instanceof Array?e:[e],this.addShapeList(e,r),this.computeFaceNormals())};t.ExtrudeGeometry.prototype=Object.create(t.Geometry.prototype);t.ExtrudeGeometry.prototype.constructor=t.ExtrudeGeometry;t.ExtrudeGeometry.prototype.addShapeList=function(t,e){for(var r=t.length,i=0;i<r;i++)this.addShape(t[i],e)};t.ExtrudeGeometry.prototype.addShape=function(e,r){function i(e,r,i){r||t.error("THREE.ExtrudeGeometry: vec does not exist");return r.clone().multiplyScalar(i).add(e)}function n(e,r,i){var n=1,n=e.x-r.x,o=e.y-r.y,a=i.x-e.x,s=i.y-e.y,h=n*n+o*o;if(1e-10<Math.abs(n*s-o*a)){var l=Math.sqrt(h),c=Math.sqrt(a*a+s*s),h=r.x-o/l;r=r.y+n/l;a=((i.x-s/c-h)*s-(i.y+a/c-r)*a)/(n*s-o*a);i=h+n*a-e.x;e=r+o*a-e.y;n=i*i+e*e;if(2>=n)return new t.Vector2(i,e);n=Math.sqrt(n/2)}else e=!1,1e-10<n?1e-10<a&&(e=!0):-1e-10>n?-1e-10>a&&(e=!0):Math.sign(o)==Math.sign(s)&&(e=!0),e?(i=-o,e=n,n=Math.sqrt(h)):(i=n,e=o,n=Math.sqrt(h/2));return new t.Vector2(i/n,e/n)}function o(e,r){var i,n;for(I=e.length;0<=--I;){i=I;n=I-1;0>n&&(n=e.length-1);for(var o=0,a=d+2*u,o=0;o<a;o++){var s=k*o,h=k*(o+1),l=r+i+s,s=r+n+s,c=r+n+h,h=r+i+h,l=l+L,s=s+L,c=c+L,h=h+L;C.faces.push(new t.Face3(l,s,h,null,null,x));C.faces.push(new t.Face3(s,c,h,null,null,x));l=b.generateSideWallUV(C,l,s,c,h);C.faceVertexUvs[0].push([l[0],l[1],l[3]]);C.faceVertexUvs[0].push([l[1],l[2],l[3]])}}}function a(e,r,i){C.vertices.push(new t.Vector3(e,r,i))}function s(e,r,i){e+=L;r+=L;i+=L;C.faces.push(new t.Face3(e,r,i,null,null,v));e=b.generateTopUV(C,e,r,i);C.faceVertexUvs[0].push(e)}var h=void 0!==r.amount?r.amount:100,l=void 0!==r.bevelThickness?r.bevelThickness:6,c=void 0!==r.bevelSize?r.bevelSize:l-2,u=void 0!==r.bevelSegments?r.bevelSegments:3,f=void 0!==r.bevelEnabled?r.bevelEnabled:!0,p=void 0!==r.curveSegments?r.curveSegments:12,d=void 0!==r.steps?r.steps:1,m=r.extrudePath,g,y=!1,v=r.material,x=r.extrudeMaterial,b=void 0!==r.UVGenerator?r.UVGenerator:t.ExtrudeGeometry.WorldUVGenerator,_,w,M,S;m&&(g=m.getSpacedPoints(d),y=!0,f=!1,_=void 0!==r.frames?r.frames:new t.TubeGeometry.FrenetFrames(m,d,(!1)),w=new t.Vector3,M=new t.Vector3,S=new t.Vector3);f||(c=l=u=0);var T,E,A,C=this,L=this.vertices.length,m=e.extractPoints(p),p=m.shape,P=m.holes;if(m=!t.Shape.Utils.isClockWise(p)){p=p.reverse();E=0;for(A=P.length;E<A;E++)T=P[E],t.Shape.Utils.isClockWise(T)&&(P[E]=T.reverse());m=!1}var R=t.Shape.Utils.triangulateShape(p,P),F=p;E=0;for(A=P.length;E<A;E++)T=P[E],p=p.concat(T);var U,B,D,V,z,k=p.length,N,O=R.length,m=[],I=0;D=F.length;U=D-1;for(B=I+1;I<D;I++,U++,B++)U===D&&(U=0),B===D&&(B=0),m[I]=n(F[I],F[U],F[B]);var G=[],H,W=m.concat();E=0;for(A=P.length;E<A;E++){T=P[E];H=[];I=0;D=T.length;U=D-1;for(B=I+1;I<D;I++,U++,B++)U===D&&(U=0),B===D&&(B=0),H[I]=n(T[I],T[U],T[B]);G.push(H);W=W.concat(H)}for(U=0;U<u;U++){D=U/u;V=l*(1-D);B=c*Math.sin(D*Math.PI/2);I=0;for(D=F.length;I<D;I++)z=i(F[I],m[I],B),a(z.x,z.y,-V);E=0;for(A=P.length;E<A;E++)for(T=P[E],H=G[E],I=0,D=T.length;I<D;I++)z=i(T[I],H[I],B),a(z.x,z.y,-V)}B=c;for(I=0;I<k;I++)z=f?i(p[I],W[I],B):p[I],y?(M.copy(_.normals[0]).multiplyScalar(z.x),w.copy(_.binormals[0]).multiplyScalar(z.y),S.copy(g[0]).add(M).add(w),a(S.x,S.y,S.z)):a(z.x,z.y,0);for(D=1;D<=d;D++)for(I=0;I<k;I++)z=f?i(p[I],W[I],B):p[I],y?(M.copy(_.normals[D]).multiplyScalar(z.x),w.copy(_.binormals[D]).multiplyScalar(z.y),S.copy(g[D]).add(M).add(w),a(S.x,S.y,S.z)):a(z.x,z.y,h/d*D);for(U=u-1;0<=U;U--){D=U/u;V=l*(1-D);B=c*Math.sin(D*Math.PI/2);I=0;for(D=F.length;I<D;I++)z=i(F[I],m[I],B),a(z.x,z.y,h+V);E=0;for(A=P.length;E<A;E++)for(T=P[E],H=G[E],I=0,D=T.length;I<D;I++)z=i(T[I],H[I],B),y?a(z.x,z.y+g[d-1].y,g[d-1].x+V):a(z.x,z.y,h+V)}(function(){if(f){var t;t=0*k;for(I=0;I<O;I++)N=R[I],s(N[2]+t,N[1]+t,N[0]+t);t=d+2*u;t*=k;for(I=0;I<O;I++)N=R[I],s(N[0]+t,N[1]+t,N[2]+t)}else{for(I=0;I<O;I++)N=R[I],s(N[2],N[1],N[0]);for(I=0;I<O;I++)N=R[I],s(N[0]+k*d,N[1]+k*d,N[2]+k*d)}})();(function(){var t=0;o(F,t);t+=F.length;E=0;for(A=P.length;E<A;E++)T=P[E],o(T,t),t+=T.length})()};t.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,r,i,n){e=e.vertices;r=e[r];i=e[i];n=e[n];return[new t.Vector2(r.x,r.y),new t.Vector2(i.x,i.y),new t.Vector2(n.x,n.y)]},generateSideWallUV:function(e,r,i,n,o){e=e.vertices;r=e[r];i=e[i];n=e[n];o=e[o];return.01>Math.abs(r.y-i.y)?[new t.Vector2(r.x,1-r.z),new t.Vector2(i.x,1-i.z),new t.Vector2(n.x,1-n.z),new t.Vector2(o.x,1-o.z)]:[new t.Vector2(r.y,1-r.z),new t.Vector2(i.y,1-i.z),new t.Vector2(n.y,1-n.z),new t.Vector2(o.y,1-o.z)]}};t.ShapeGeometry=function(e,r){t.Geometry.call(this);this.type="ShapeGeometry";!1===e instanceof Array&&(e=[e]);this.addShapeList(e,r);this.computeFaceNormals()};t.ShapeGeometry.prototype=Object.create(t.Geometry.prototype);t.ShapeGeometry.prototype.constructor=t.ShapeGeometry;t.ShapeGeometry.prototype.addShapeList=function(t,e){for(var r=0,i=t.length;r<i;r++)this.addShape(t[r],e);return this};t.ShapeGeometry.prototype.addShape=function(e,r){void 0===r&&(r={});var i=r.material,n=void 0===r.UVGenerator?t.ExtrudeGeometry.WorldUVGenerator:r.UVGenerator,o,a,s,h=this.vertices.length;o=e.extractPoints(void 0!==r.curveSegments?r.curveSegments:12);var l=o.shape,c=o.holes;if(!t.Shape.Utils.isClockWise(l))for(l=l.reverse(),o=0,a=c.length;o<a;o++)s=c[o],t.Shape.Utils.isClockWise(s)&&(c[o]=s.reverse());var u=t.Shape.Utils.triangulateShape(l,c);o=0;for(a=c.length;o<a;o++)s=c[o],l=l.concat(s);c=l.length;a=u.length;for(o=0;o<c;o++)s=l[o],this.vertices.push(new t.Vector3(s.x,s.y,0));for(o=0;o<a;o++)c=u[o],l=c[0]+h,s=c[1]+h,c=c[2]+h,this.faces.push(new t.Face3(l,s,c,null,null,i)),this.faceVertexUvs[0].push(n.generateTopUV(this,l,s,c))};t.LatheGeometry=function(e,r,i,n){t.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:e,segments:r,phiStart:i,phiLength:n};r=r||12;i=i||0;n=n||2*Math.PI;for(var o=1/(e.length-1),a=1/r,s=0,h=r;s<=h;s++)for(var l=i+s*a*n,c=Math.cos(l),u=Math.sin(l),l=0,f=e.length;l<f;l++){var p=e[l],d=new t.Vector3;d.x=c*p.x-u*p.y;d.y=u*p.x+c*p.y;d.z=p.z;this.vertices.push(d)}i=e.length;s=0;for(h=r;s<h;s++)for(l=0,f=e.length-1;l<f;l++){r=u=l+i*s;n=u+i;var c=u+1+i,u=u+1,p=s*a,d=l*o,m=p+a,g=d+o;this.faces.push(new t.Face3(r,n,u));this.faceVertexUvs[0].push([new t.Vector2(p,d),new t.Vector2(m,d),new t.Vector2(p,g)]);this.faces.push(new t.Face3(n,c,u));this.faceVertexUvs[0].push([new t.Vector2(m,d),new t.Vector2(m,g),new t.Vector2(p,g)])}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};t.LatheGeometry.prototype=Object.create(t.Geometry.prototype);t.LatheGeometry.prototype.constructor=t.LatheGeometry;t.PlaneGeometry=function(e,r,i,n){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.");t.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:e,height:r,widthSegments:i,heightSegments:n};this.fromBufferGeometry(new t.PlaneBufferGeometry(e,r,i,n))};t.PlaneGeometry.prototype=Object.create(t.Geometry.prototype);t.PlaneGeometry.prototype.constructor=t.PlaneGeometry;t.PlaneBufferGeometry=function(e,r,i,n){t.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:e,height:r,widthSegments:i,heightSegments:n};var o=e/2,a=r/2;i=i||1;n=n||1;var s=i+1,h=n+1,l=e/i,c=r/n;r=new Float32Array(s*h*3);e=new Float32Array(s*h*3);for(var u=new Float32Array(s*h*2),f=0,p=0,d=0;d<h;d++)for(var m=d*c-a,g=0;g<s;g++)r[f]=g*l-o,r[f+1]=-m,e[f+2]=1,u[p]=g/i,u[p+1]=1-d/n,f+=3,p+=2;f=0;o=new(65535<r.length/3?Uint32Array:Uint16Array)(i*n*6);for(d=0;d<n;d++)for(g=0;g<i;g++)a=g+s*(d+1),h=g+1+s*(d+1),l=g+1+s*d,o[f]=g+s*d,o[f+1]=a,o[f+2]=l,o[f+3]=a,o[f+4]=h,o[f+5]=l,f+=6;this.addAttribute("index",new t.BufferAttribute(o,1));this.addAttribute("position",new t.BufferAttribute(r,3));this.addAttribute("normal",new t.BufferAttribute(e,3));this.addAttribute("uv",new t.BufferAttribute(u,2))};t.PlaneBufferGeometry.prototype=Object.create(t.BufferGeometry.prototype);t.PlaneBufferGeometry.prototype.constructor=t.PlaneBufferGeometry;t.RingGeometry=function(e,r,i,n,o,a){t.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:e,outerRadius:r,thetaSegments:i,phiSegments:n,thetaStart:o,thetaLength:a};e=e||0;r=r||50;o=void 0!==o?o:0;a=void 0!==a?a:2*Math.PI;i=void 0!==i?Math.max(3,i):8;n=void 0!==n?Math.max(1,n):8;var s,h=[],l=e,c=(r-e)/n;for(e=0;e<n+1;e++){for(s=0;s<i+1;s++){var u=new t.Vector3,f=o+s/i*a;u.x=l*Math.cos(f);u.y=l*Math.sin(f);this.vertices.push(u);h.push(new t.Vector2((u.x/r+1)/2,(u.y/r+1)/2))}l+=c}r=new t.Vector3(0,0,1);for(e=0;e<n;e++)for(o=e*(i+1),s=0;s<i;s++)a=f=s+o,c=f+i+1,u=f+i+2,this.faces.push(new t.Face3(a,c,u,[r.clone(),r.clone(),r.clone()])),this.faceVertexUvs[0].push([h[a].clone(),h[c].clone(),h[u].clone()]),a=f,c=f+i+2,u=f+1,this.faces.push(new t.Face3(a,c,u,[r.clone(),r.clone(),r.clone()])),this.faceVertexUvs[0].push([h[a].clone(),h[c].clone(),h[u].clone()]);this.computeFaceNormals();this.boundingSphere=new t.Sphere(new t.Vector3,l)};t.RingGeometry.prototype=Object.create(t.Geometry.prototype);t.RingGeometry.prototype.constructor=t.RingGeometry;t.SphereGeometry=function(e,r,i,n,o,a,s){t.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:e,widthSegments:r,heightSegments:i,phiStart:n,phiLength:o,thetaStart:a,thetaLength:s};e=e||50;r=Math.max(3,Math.floor(r)||8);i=Math.max(2,Math.floor(i)||6);n=void 0!==n?n:0;o=void 0!==o?o:2*Math.PI;a=void 0!==a?a:0;s=void 0!==s?s:Math.PI;var h,l,c=[],u=[];for(l=0;l<=i;l++){var f=[],p=[];for(h=0;h<=r;h++){var d=h/r,m=l/i,g=new t.Vector3;g.x=-e*Math.cos(n+d*o)*Math.sin(a+m*s);g.y=e*Math.cos(a+m*s);g.z=e*Math.sin(n+d*o)*Math.sin(a+m*s);this.vertices.push(g);f.push(this.vertices.length-1);p.push(new t.Vector2(d,1-m))}c.push(f);u.push(p)}for(l=0;l<i;l++)for(h=0;h<r;h++){n=c[l][h+1];o=c[l][h];a=c[l+1][h];s=c[l+1][h+1];var f=this.vertices[n].clone().normalize(),p=this.vertices[o].clone().normalize(),d=this.vertices[a].clone().normalize(),m=this.vertices[s].clone().normalize(),g=u[l][h+1].clone(),y=u[l][h].clone(),v=u[l+1][h].clone(),x=u[l+1][h+1].clone();Math.abs(this.vertices[n].y)===e?(g.x=(g.x+y.x)/2,this.faces.push(new t.Face3(n,a,s,[f,d,m])),this.faceVertexUvs[0].push([g,v,x])):Math.abs(this.vertices[a].y)===e?(v.x=(v.x+x.x)/2,this.faces.push(new t.Face3(n,o,a,[f,p,d])),this.faceVertexUvs[0].push([g,y,v])):(this.faces.push(new t.Face3(n,o,s,[f,p,m])),this.faceVertexUvs[0].push([g,y,x]),this.faces.push(new t.Face3(o,a,s,[p.clone(),d,m.clone()])),this.faceVertexUvs[0].push([y.clone(),v,x.clone()]))}this.computeFaceNormals();this.boundingSphere=new t.Sphere(new t.Vector3,e)};t.SphereGeometry.prototype=Object.create(t.Geometry.prototype);t.SphereGeometry.prototype.constructor=t.SphereGeometry;t.TextGeometry=function(e,r){r=r||{};var i=t.FontUtils.generateShapes(e,r);r.amount=void 0!==r.height?r.height:50;void 0===r.bevelThickness&&(r.bevelThickness=10);void 0===r.bevelSize&&(r.bevelSize=8);void 0===r.bevelEnabled&&(r.bevelEnabled=!1);t.ExtrudeGeometry.call(this,i,r);this.type="TextGeometry"};t.TextGeometry.prototype=Object.create(t.ExtrudeGeometry.prototype);t.TextGeometry.prototype.constructor=t.TextGeometry;t.TorusGeometry=function(e,r,i,n,o){t.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:e,tube:r,radialSegments:i,tubularSegments:n,arc:o};e=e||100;r=r||40;i=i||8;n=n||6;o=o||2*Math.PI;for(var a=new t.Vector3,s=[],h=[],l=0;l<=i;l++)for(var c=0;c<=n;c++){var u=c/n*o,f=l/i*Math.PI*2;a.x=e*Math.cos(u);a.y=e*Math.sin(u);var p=new t.Vector3;p.x=(e+r*Math.cos(f))*Math.cos(u);p.y=(e+r*Math.cos(f))*Math.sin(u);p.z=r*Math.sin(f);this.vertices.push(p);s.push(new t.Vector2(c/n,l/i));h.push(p.clone().sub(a).normalize())}for(l=1;l<=i;l++)for(c=1;c<=n;c++)e=(n+1)*l+c-1,r=(n+1)*(l-1)+c-1,o=(n+1)*(l-1)+c,a=(n+1)*l+c,u=new t.Face3(e,r,a,[h[e].clone(),h[r].clone(),h[a].clone()]),this.faces.push(u),this.faceVertexUvs[0].push([s[e].clone(),s[r].clone(),s[a].clone()]),u=new t.Face3(r,o,a,[h[r].clone(),h[o].clone(),h[a].clone()]),this.faces.push(u),this.faceVertexUvs[0].push([s[r].clone(),s[o].clone(),s[a].clone()]);this.computeFaceNormals()};t.TorusGeometry.prototype=Object.create(t.Geometry.prototype);t.TorusGeometry.prototype.constructor=t.TorusGeometry;t.TorusKnotGeometry=function(e,r,i,n,o,a,s){function h(e,r,i,n,o){var a=Math.cos(e),s=Math.sin(e);e*=r/i;r=Math.cos(e);a*=n*(2+r)*.5;s=n*(2+r)*s*.5;n=o*n*Math.sin(e)*.5;return new t.Vector3(a,s,n)}t.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:e,tube:r,radialSegments:i,tubularSegments:n,p:o,q:a,heightScale:s};e=e||100;r=r||40;i=i||64;n=n||8;o=o||2;a=a||3;s=s||1;for(var l=Array(i),c=new t.Vector3,u=new t.Vector3,f=new t.Vector3,p=0;p<i;++p){l[p]=Array(n);var d=p/i*2*o*Math.PI,m=h(d,a,o,e,s),d=h(d+.01,a,o,e,s);c.subVectors(d,m);u.addVectors(d,m);f.crossVectors(c,u);u.crossVectors(f,c);f.normalize();u.normalize();for(d=0;d<n;++d){var g=d/n*2*Math.PI,y=-r*Math.cos(g),g=r*Math.sin(g),v=new t.Vector3;v.x=m.x+y*u.x+g*f.x;v.y=m.y+y*u.y+g*f.y;v.z=m.z+y*u.z+g*f.z;l[p][d]=this.vertices.push(v)-1}}for(p=0;p<i;++p)for(d=0;d<n;++d)o=(p+1)%i,a=(d+1)%n,e=l[p][d],r=l[o][d],o=l[o][a],a=l[p][a],s=new t.Vector2(p/i,d/n),c=new t.Vector2((p+1)/i,d/n),u=new t.Vector2((p+1)/i,(d+1)/n),f=new t.Vector2(p/i,(d+1)/n),this.faces.push(new t.Face3(e,r,a)),this.faceVertexUvs[0].push([s,c,f]),this.faces.push(new t.Face3(r,o,a)),this.faceVertexUvs[0].push([c.clone(),u,f.clone()]);this.computeFaceNormals();this.computeVertexNormals()};t.TorusKnotGeometry.prototype=Object.create(t.Geometry.prototype);t.TorusKnotGeometry.prototype.constructor=t.TorusKnotGeometry;t.TubeGeometry=function(e,r,i,n,o,a){t.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:e,segments:r,radius:i,radialSegments:n,closed:o};r=r||64;i=i||1;n=n||8;o=o||!1;a=a||t.TubeGeometry.NoTaper;var s=[],h,l,c=r+1,u,f,p,d,m,g=new t.Vector3,y,v,x;y=new t.TubeGeometry.FrenetFrames(e,r,o);v=y.normals;x=y.binormals;this.tangents=y.tangents;this.normals=v;this.binormals=x;for(y=0;y<c;y++)for(s[y]=[],u=y/(c-1),m=e.getPointAt(u),h=v[y],l=x[y],p=i*a(u),u=0;u<n;u++)f=u/n*2*Math.PI,d=-p*Math.cos(f),f=p*Math.sin(f),g.copy(m),g.x+=d*h.x+f*l.x,g.y+=d*h.y+f*l.y,g.z+=d*h.z+f*l.z,s[y][u]=this.vertices.push(new t.Vector3(g.x,g.y,g.z))-1;for(y=0;y<r;y++)for(u=0;u<n;u++)a=o?(y+1)%r:y+1,c=(u+1)%n,e=s[y][u],i=s[a][u],a=s[a][c],c=s[y][c],g=new t.Vector2(y/r,u/n),v=new t.Vector2((y+1)/r,u/n),x=new t.Vector2((y+1)/r,(u+1)/n),h=new t.Vector2(y/r,(u+1)/n),this.faces.push(new t.Face3(e,i,c)),this.faceVertexUvs[0].push([g,v,h]),this.faces.push(new t.Face3(i,a,c)),this.faceVertexUvs[0].push([v.clone(),x,h.clone()]);this.computeFaceNormals();this.computeVertexNormals()};t.TubeGeometry.prototype=Object.create(t.Geometry.prototype);t.TubeGeometry.prototype.constructor=t.TubeGeometry;t.TubeGeometry.NoTaper=function(t){return 1};t.TubeGeometry.SinusoidalTaper=function(t){return Math.sin(Math.PI*t)};t.TubeGeometry.FrenetFrames=function(e,r,i){var n=new t.Vector3,o=[],a=[],s=[],h=new t.Vector3,l=new t.Matrix4;r+=1;var c,u,f;this.tangents=o;this.normals=a;this.binormals=s;for(c=0;c<r;c++)u=c/(r-1),o[c]=e.getTangentAt(u),o[c].normalize();a[0]=new t.Vector3;s[0]=new t.Vector3;e=Number.MAX_VALUE;c=Math.abs(o[0].x);u=Math.abs(o[0].y);f=Math.abs(o[0].z);c<=e&&(e=c,n.set(1,0,0));u<=e&&(e=u,n.set(0,1,0));f<=e&&n.set(0,0,1);h.crossVectors(o[0],n).normalize();a[0].crossVectors(o[0],h);s[0].crossVectors(o[0],a[0]);for(c=1;c<r;c++)a[c]=a[c-1].clone(),s[c]=s[c-1].clone(),h.crossVectors(o[c-1],o[c]),1e-4<h.length()&&(h.normalize(),n=Math.acos(t.Math.clamp(o[c-1].dot(o[c]),-1,1)),a[c].applyMatrix4(l.makeRotationAxis(h,n))),s[c].crossVectors(o[c],a[c]);if(i)for(n=Math.acos(t.Math.clamp(a[0].dot(a[r-1]),-1,1)),n/=r-1,0<o[0].dot(h.crossVectors(a[0],a[r-1]))&&(n=-n),c=1;c<r;c++)a[c].applyMatrix4(l.makeRotationAxis(o[c],n*c)),s[c].crossVectors(o[c],a[c])};t.PolyhedronGeometry=function(e,r,i,n){function o(e){var r=e.normalize().clone();r.index=l.vertices.push(r)-1;var i=Math.atan2(e.z,-e.x)/2/Math.PI+.5;e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5;r.uv=new t.Vector2(i,1-e);return r}function a(e,r,i){var n=new t.Face3(e.index,r.index,i.index,[e.clone(),r.clone(),i.clone()]);l.faces.push(n);y.copy(e).add(r).add(i).divideScalar(3);n=Math.atan2(y.z,-y.x);l.faceVertexUvs[0].push([h(e.uv,e,n),h(r.uv,r,n),h(i.uv,i,n)])}function s(t,e){for(var r=Math.pow(2,e),i=o(l.vertices[t.a]),n=o(l.vertices[t.b]),s=o(l.vertices[t.c]),h=[],c=0;c<=r;c++){h[c]=[];for(var u=o(i.clone().lerp(s,c/r)),f=o(n.clone().lerp(s,c/r)),p=r-c,d=0;d<=p;d++)h[c][d]=0==d&&c==r?u:o(u.clone().lerp(f,d/p))}for(c=0;c<r;c++)for(d=0;d<2*(r-c)-1;d++)i=Math.floor(d/2),0==d%2?a(h[c][i+1],h[c+1][i],h[c][i]):a(h[c][i+1],h[c+1][i+1],h[c+1][i])}function h(e,r,i){0>i&&1===e.x&&(e=new t.Vector2(e.x-1,e.y));0===r.x&&0===r.z&&(e=new t.Vector2(i/2/Math.PI+.5,e.y));return e.clone()}t.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:e,indices:r,radius:i,detail:n};i=i||1;n=n||0;for(var l=this,c=0,u=e.length;c<u;c+=3)o(new t.Vector3(e[c],e[c+1],e[c+2]));e=this.vertices;for(var f=[],p=c=0,u=r.length;c<u;c+=3,p++){var d=e[r[c]],m=e[r[c+1]],g=e[r[c+2]];f[p]=new t.Face3(d.index,m.index,g.index,[d.clone(),m.clone(),g.clone()])}for(var y=new t.Vector3,c=0,u=f.length;c<u;c++)s(f[c],n);c=0;for(u=this.faceVertexUvs[0].length;c<u;c++)r=this.faceVertexUvs[0][c],n=r[0].x,e=r[1].x,f=r[2].x,p=Math.max(n,Math.max(e,f)),d=Math.min(n,Math.min(e,f)),.9<p&&.1>d&&(.2>n&&(r[0].x+=1),.2>e&&(r[1].x+=1),.2>f&&(r[2].x+=1));c=0;for(u=this.vertices.length;c<u;c++)this.vertices[c].multiplyScalar(i);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new t.Sphere(new t.Vector3,i)};t.PolyhedronGeometry.prototype=Object.create(t.Geometry.prototype);t.PolyhedronGeometry.prototype.constructor=t.PolyhedronGeometry;t.DodecahedronGeometry=function(e,r){this.parameters={radius:e,detail:r};var i=(1+Math.sqrt(5))/2,n=1/i;t.PolyhedronGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,r);
};t.DodecahedronGeometry.prototype=Object.create(t.Geometry.prototype);t.DodecahedronGeometry.prototype.constructor=t.DodecahedronGeometry;t.IcosahedronGeometry=function(e,r){var i=(1+Math.sqrt(5))/2;t.PolyhedronGeometry.call(this,[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,r);this.type="IcosahedronGeometry";this.parameters={radius:e,detail:r}};t.IcosahedronGeometry.prototype=Object.create(t.Geometry.prototype);t.IcosahedronGeometry.prototype.constructor=t.IcosahedronGeometry;t.OctahedronGeometry=function(e,r){this.parameters={radius:e,detail:r};t.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,r);this.type="OctahedronGeometry";this.parameters={radius:e,detail:r}};t.OctahedronGeometry.prototype=Object.create(t.Geometry.prototype);t.OctahedronGeometry.prototype.constructor=t.OctahedronGeometry;t.TetrahedronGeometry=function(e,r){t.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,r);this.type="TetrahedronGeometry";this.parameters={radius:e,detail:r}};t.TetrahedronGeometry.prototype=Object.create(t.Geometry.prototype);t.TetrahedronGeometry.prototype.constructor=t.TetrahedronGeometry;t.ParametricGeometry=function(e,r,i){t.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:e,slices:r,stacks:i};var n=this.vertices,o=this.faces,a=this.faceVertexUvs[0],s,h,l,c,u=r+1;for(s=0;s<=i;s++)for(c=s/i,h=0;h<=r;h++)l=h/r,l=e(l,c),n.push(l);var f,p,d,m;for(s=0;s<i;s++)for(h=0;h<r;h++)e=s*u+h,n=s*u+h+1,c=(s+1)*u+h+1,l=(s+1)*u+h,f=new t.Vector2(h/r,s/i),p=new t.Vector2((h+1)/r,s/i),d=new t.Vector2((h+1)/r,(s+1)/i),m=new t.Vector2(h/r,(s+1)/i),o.push(new t.Face3(e,n,l)),a.push([f,p,m]),o.push(new t.Face3(n,c,l)),a.push([p.clone(),d,m.clone()]);this.computeFaceNormals();this.computeVertexNormals()};t.ParametricGeometry.prototype=Object.create(t.Geometry.prototype);t.ParametricGeometry.prototype.constructor=t.ParametricGeometry;t.AxisHelper=function(e){e=e||1;var r=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),i=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);e=new t.BufferGeometry;e.addAttribute("position",new t.BufferAttribute(r,3));e.addAttribute("color",new t.BufferAttribute(i,3));r=new t.LineBasicMaterial({vertexColors:t.VertexColors});t.Line.call(this,e,r,t.LinePieces)};t.AxisHelper.prototype=Object.create(t.Line.prototype);t.AxisHelper.prototype.constructor=t.AxisHelper;t.ArrowHelper=function(){var e=new t.Geometry;e.vertices.push(new t.Vector3(0,0,0),new t.Vector3(0,1,0));var r=new t.CylinderGeometry(0,.5,1,5,1);r.applyMatrix((new t.Matrix4).makeTranslation(0,-.5,0));return function(i,n,o,a,s,h){t.Object3D.call(this);void 0===a&&(a=16776960);void 0===o&&(o=1);void 0===s&&(s=.2*o);void 0===h&&(h=.2*s);this.position.copy(n);this.line=new t.Line(e,new t.LineBasicMaterial({color:a}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new t.Mesh(r,new t.MeshBasicMaterial({color:a}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(i);this.setLength(o,s,h)}}();t.ArrowHelper.prototype=Object.create(t.Object3D.prototype);t.ArrowHelper.prototype.constructor=t.ArrowHelper;t.ArrowHelper.prototype.setDirection=function(){var e=new t.Vector3,r;return function(t){.99999<t.y?this.quaternion.set(0,0,0,1):-.99999>t.y?this.quaternion.set(1,0,0,0):(e.set(t.z,0,-t.x).normalize(),r=Math.acos(t.y),this.quaternion.setFromAxisAngle(e,r))}}();t.ArrowHelper.prototype.setLength=function(t,e,r){void 0===e&&(e=.2*t);void 0===r&&(r=.2*e);this.line.scale.set(1,t-e,1);this.line.updateMatrix();this.cone.scale.set(r,e,r);this.cone.position.y=t;this.cone.updateMatrix()};t.ArrowHelper.prototype.setColor=function(t){this.line.material.color.set(t);this.cone.material.color.set(t)};t.BoxHelper=function(e){var r=new t.BufferGeometry;r.addAttribute("position",new t.BufferAttribute(new Float32Array(72),3));t.Line.call(this,r,new t.LineBasicMaterial({color:16776960}),t.LinePieces);void 0!==e&&this.update(e)};t.BoxHelper.prototype=Object.create(t.Line.prototype);t.BoxHelper.prototype.constructor=t.BoxHelper;t.BoxHelper.prototype.update=function(t){var e=t.geometry;null===e.boundingBox&&e.computeBoundingBox();var r=e.boundingBox.min,e=e.boundingBox.max,i=this.geometry.attributes.position.array;i[0]=e.x;i[1]=e.y;i[2]=e.z;i[3]=r.x;i[4]=e.y;i[5]=e.z;i[6]=r.x;i[7]=e.y;i[8]=e.z;i[9]=r.x;i[10]=r.y;i[11]=e.z;i[12]=r.x;i[13]=r.y;i[14]=e.z;i[15]=e.x;i[16]=r.y;i[17]=e.z;i[18]=e.x;i[19]=r.y;i[20]=e.z;i[21]=e.x;i[22]=e.y;i[23]=e.z;i[24]=e.x;i[25]=e.y;i[26]=r.z;i[27]=r.x;i[28]=e.y;i[29]=r.z;i[30]=r.x;i[31]=e.y;i[32]=r.z;i[33]=r.x;i[34]=r.y;i[35]=r.z;i[36]=r.x;i[37]=r.y;i[38]=r.z;i[39]=e.x;i[40]=r.y;i[41]=r.z;i[42]=e.x;i[43]=r.y;i[44]=r.z;i[45]=e.x;i[46]=e.y;i[47]=r.z;i[48]=e.x;i[49]=e.y;i[50]=e.z;i[51]=e.x;i[52]=e.y;i[53]=r.z;i[54]=r.x;i[55]=e.y;i[56]=e.z;i[57]=r.x;i[58]=e.y;i[59]=r.z;i[60]=r.x;i[61]=r.y;i[62]=e.z;i[63]=r.x;i[64]=r.y;i[65]=r.z;i[66]=e.x;i[67]=r.y;i[68]=e.z;i[69]=e.x;i[70]=r.y;i[71]=r.z;this.geometry.attributes.position.needsUpdate=!0;this.geometry.computeBoundingSphere();this.matrix=t.matrixWorld;this.matrixAutoUpdate=!1};t.BoundingBoxHelper=function(e,r){var i=void 0!==r?r:8947848;this.object=e;this.box=new t.Box3;t.Mesh.call(this,new t.BoxGeometry(1,1,1),new t.MeshBasicMaterial({color:i,wireframe:!0}))};t.BoundingBoxHelper.prototype=Object.create(t.Mesh.prototype);t.BoundingBoxHelper.prototype.constructor=t.BoundingBoxHelper;t.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};t.CameraHelper=function(e){function r(t,e,r){i(t,r);i(e,r)}function i(e,r){n.vertices.push(new t.Vector3);n.colors.push(new t.Color(r));void 0===a[e]&&(a[e]=[]);a[e].push(n.vertices.length-1)}var n=new t.Geometry,o=new t.LineBasicMaterial({color:16777215,vertexColors:t.FaceColors}),a={};r("n1","n2",16755200);r("n2","n4",16755200);r("n4","n3",16755200);r("n3","n1",16755200);r("f1","f2",16755200);r("f2","f4",16755200);r("f4","f3",16755200);r("f3","f1",16755200);r("n1","f1",16755200);r("n2","f2",16755200);r("n3","f3",16755200);r("n4","f4",16755200);r("p","n1",16711680);r("p","n2",16711680);r("p","n3",16711680);r("p","n4",16711680);r("u1","u2",43775);r("u2","u3",43775);r("u3","u1",43775);r("c","t",16777215);r("p","c",3355443);r("cn1","cn2",3355443);r("cn3","cn4",3355443);r("cf1","cf2",3355443);r("cf3","cf4",3355443);t.Line.call(this,n,o,t.LinePieces);this.camera=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=a;this.update()};t.CameraHelper.prototype=Object.create(t.Line.prototype);t.CameraHelper.prototype.constructor=t.CameraHelper;t.CameraHelper.prototype.update=function(){var e,r,i=new t.Vector3,n=new t.Camera,o=function(t,o,a,s){i.set(o,a,s).unproject(n);t=r[t];if(void 0!==t)for(o=0,a=t.length;o<a;o++)e.vertices[t[o]].copy(i)};return function(){e=this.geometry;r=this.pointMap;n.projectionMatrix.copy(this.camera.projectionMatrix);o("c",0,0,-1);o("t",0,0,1);o("n1",-1,-1,-1);o("n2",1,-1,-1);o("n3",-1,1,-1);o("n4",1,1,-1);o("f1",-1,-1,1);o("f2",1,-1,1);o("f3",-1,1,1);o("f4",1,1,1);o("u1",.7,1.1,-1);o("u2",-.7,1.1,-1);o("u3",0,2,-1);o("cf1",-1,0,1);o("cf2",1,0,1);o("cf3",0,-1,1);o("cf4",0,1,1);o("cn1",-1,0,-1);o("cn2",1,0,-1);o("cn3",0,-1,-1);o("cn4",0,1,-1);e.verticesNeedUpdate=!0}}();t.DirectionalLightHelper=function(e,r){t.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1;r=r||1;var i=new t.Geometry;i.vertices.push(new t.Vector3((-r),r,0),new t.Vector3(r,r,0),new t.Vector3(r,(-r),0),new t.Vector3((-r),(-r),0),new t.Vector3((-r),r,0));var n=new t.LineBasicMaterial({fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new t.Line(i,n);this.add(this.lightPlane);i=new t.Geometry;i.vertices.push(new t.Vector3,new t.Vector3);n=new t.LineBasicMaterial({fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new t.Line(i,n);this.add(this.targetLine);this.update()};t.DirectionalLightHelper.prototype=Object.create(t.Object3D.prototype);t.DirectionalLightHelper.prototype.constructor=t.DirectionalLightHelper;t.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};t.DirectionalLightHelper.prototype.update=function(){var e=new t.Vector3,r=new t.Vector3,i=new t.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld);r.setFromMatrixPosition(this.light.target.matrixWorld);i.subVectors(r,e);this.lightPlane.lookAt(i);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(i);this.targetLine.geometry.verticesNeedUpdate=!0;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();t.EdgesHelper=function(e,r,i){r=void 0!==r?r:16777215;i=Math.cos(t.Math.degToRad(void 0!==i?i:1));var n=[0,0],o={},a=function(t,e){return t-e},s=["a","b","c"],h=new t.BufferGeometry,l;e.geometry instanceof t.BufferGeometry?(l=new t.Geometry,l.fromBufferGeometry(e.geometry)):l=e.geometry.clone();l.mergeVertices();l.computeFaceNormals();var c=l.vertices;l=l.faces;for(var u=0,f=0,p=l.length;f<p;f++)for(var d=l[f],m=0;3>m;m++){n[0]=d[s[m]];n[1]=d[s[(m+1)%3]];n.sort(a);var g=n.toString();void 0===o[g]?(o[g]={vert1:n[0],vert2:n[1],face1:f,face2:void 0},u++):o[g].face2=f}n=new Float32Array(6*u);a=0;for(g in o)if(s=o[g],void 0===s.face2||l[s.face1].normal.dot(l[s.face2].normal)<=i)u=c[s.vert1],n[a++]=u.x,n[a++]=u.y,n[a++]=u.z,u=c[s.vert2],n[a++]=u.x,n[a++]=u.y,n[a++]=u.z;h.addAttribute("position",new t.BufferAttribute(n,3));t.Line.call(this,h,new t.LineBasicMaterial({color:r}),t.LinePieces);this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1};t.EdgesHelper.prototype=Object.create(t.Line.prototype);t.EdgesHelper.prototype.constructor=t.EdgesHelper;t.FaceNormalsHelper=function(e,r,i,n){this.object=e;this.size=void 0!==r?r:1;e=void 0!==i?i:16776960;n=void 0!==n?n:1;r=new t.Geometry;i=0;for(var o=this.object.geometry.faces.length;i<o;i++)r.vertices.push(new t.Vector3,new t.Vector3);t.Line.call(this,r,new t.LineBasicMaterial({color:e,linewidth:n}),t.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new t.Matrix3;this.update()};t.FaceNormalsHelper.prototype=Object.create(t.Line.prototype);t.FaceNormalsHelper.prototype.constructor=t.FaceNormalsHelper;t.FaceNormalsHelper.prototype.update=function(){var t=this.geometry.vertices,e=this.object,r=e.geometry.vertices,i=e.geometry.faces,n=e.matrixWorld;e.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(n);for(var o=e=0,a=i.length;e<a;e++,o+=2){var s=i[e];t[o].copy(r[s.a]).add(r[s.b]).add(r[s.c]).divideScalar(3).applyMatrix4(n);t[o+1].copy(s.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(t[o])}this.geometry.verticesNeedUpdate=!0;return this};t.GridHelper=function(e,r){var i=new t.Geometry,n=new t.LineBasicMaterial({vertexColors:t.VertexColors});this.color1=new t.Color(4473924);this.color2=new t.Color(8947848);for(var o=-e;o<=e;o+=r){i.vertices.push(new t.Vector3((-e),0,o),new t.Vector3(e,0,o),new t.Vector3(o,0,(-e)),new t.Vector3(o,0,e));var a=0===o?this.color1:this.color2;i.colors.push(a,a,a,a)}t.Line.call(this,i,n,t.LinePieces)};t.GridHelper.prototype=Object.create(t.Line.prototype);t.GridHelper.prototype.constructor=t.GridHelper;t.GridHelper.prototype.setColors=function(t,e){this.color1.set(t);this.color2.set(e);this.geometry.colorsNeedUpdate=!0};t.HemisphereLightHelper=function(e,r){t.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new t.Color,new t.Color];var i=new t.SphereGeometry(r,4,2);i.applyMatrix((new t.Matrix4).makeRotationX(-Math.PI/2));for(var n=0;8>n;n++)i.faces[n].color=this.colors[4>n?0:1];n=new t.MeshBasicMaterial({vertexColors:t.FaceColors,wireframe:!0});this.lightSphere=new t.Mesh(i,n);this.add(this.lightSphere);this.update()};t.HemisphereLightHelper.prototype=Object.create(t.Object3D.prototype);t.HemisphereLightHelper.prototype.constructor=t.HemisphereLightHelper;t.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};t.HemisphereLightHelper.prototype.update=function(){var e=new t.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();t.PointLightHelper=function(e,r){this.light=e;this.light.updateMatrixWorld();var i=new t.SphereGeometry(r,4,2),n=new t.MeshBasicMaterial({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity);t.Mesh.call(this,i,n);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1};t.PointLightHelper.prototype=Object.create(t.Mesh.prototype);t.PointLightHelper.prototype.constructor=t.PointLightHelper;t.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};t.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};t.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var r=new t.Geometry,i=0;i<this.bones.length;i++)this.bones[i].parent instanceof t.Bone&&(r.vertices.push(new t.Vector3),r.vertices.push(new t.Vector3),r.colors.push(new t.Color(0,0,1)),r.colors.push(new t.Color(0,1,0)));i=new t.LineBasicMaterial({vertexColors:t.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});t.Line.call(this,r,i,t.LinePieces);this.root=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1;this.update()};t.SkeletonHelper.prototype=Object.create(t.Line.prototype);t.SkeletonHelper.prototype.constructor=t.SkeletonHelper;t.SkeletonHelper.prototype.getBoneList=function(e){var r=[];e instanceof t.Bone&&r.push(e);for(var i=0;i<e.children.length;i++)r.push.apply(r,this.getBoneList(e.children[i]));return r};t.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,r=(new t.Matrix4).getInverse(this.root.matrixWorld),i=new t.Matrix4,n=0,o=0;o<this.bones.length;o++){var a=this.bones[o];a.parent instanceof t.Bone&&(i.multiplyMatrices(r,a.matrixWorld),e.vertices[n].setFromMatrixPosition(i),i.multiplyMatrices(r,a.parent.matrixWorld),e.vertices[n+1].setFromMatrixPosition(i),n+=2)}e.verticesNeedUpdate=!0;e.computeBoundingSphere()};t.SpotLightHelper=function(e){t.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1;e=new t.CylinderGeometry(0,1,1,8,1,(!0));e.applyMatrix((new t.Matrix4).makeTranslation(0,-.5,0));e.applyMatrix((new t.Matrix4).makeRotationX(-Math.PI/2));var r=new t.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new t.Mesh(e,r);this.add(this.cone);this.update()};t.SpotLightHelper.prototype=Object.create(t.Object3D.prototype);t.SpotLightHelper.prototype.constructor=t.SpotLightHelper;t.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};t.SpotLightHelper.prototype.update=function(){var e=new t.Vector3,r=new t.Vector3;return function(){var t=this.light.distance?this.light.distance:1e4,i=t*Math.tan(this.light.angle);this.cone.scale.set(i,i,t);e.setFromMatrixPosition(this.light.matrixWorld);r.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(r.sub(e));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();t.VertexNormalsHelper=function(e,r,i,n){this.object=e;this.size=void 0!==r?r:1;r=void 0!==i?i:16711680;n=void 0!==n?n:1;i=new t.Geometry;e=e.geometry.faces;for(var o=0,a=e.length;o<a;o++)for(var s=0,h=e[o].vertexNormals.length;s<h;s++)i.vertices.push(new t.Vector3,new t.Vector3);t.Line.call(this,i,new t.LineBasicMaterial({color:r,linewidth:n}),t.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new t.Matrix3;this.update()};t.VertexNormalsHelper.prototype=Object.create(t.Line.prototype);t.VertexNormalsHelper.prototype.constructor=t.VertexNormalsHelper;t.VertexNormalsHelper.prototype.update=function(e){var r=new t.Vector3;return function(t){t=["a","b","c","d"];this.object.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var e=this.geometry.vertices,i=this.object.geometry.vertices,n=this.object.geometry.faces,o=this.object.matrixWorld,a=0,s=0,h=n.length;s<h;s++)for(var l=n[s],c=0,u=l.vertexNormals.length;c<u;c++){var f=l.vertexNormals[c];e[a].copy(i[l[t[c]]]).applyMatrix4(o);r.copy(f).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);r.add(e[a]);a+=1;e[a].copy(r);a+=1}this.geometry.verticesNeedUpdate=!0;return this}}();t.VertexTangentsHelper=function(e,r,i,n){this.object=e;this.size=void 0!==r?r:1;r=void 0!==i?i:255;n=void 0!==n?n:1;i=new t.Geometry;e=e.geometry.faces;for(var o=0,a=e.length;o<a;o++)for(var s=0,h=e[o].vertexTangents.length;s<h;s++)i.vertices.push(new t.Vector3),i.vertices.push(new t.Vector3);t.Line.call(this,i,new t.LineBasicMaterial({color:r,linewidth:n}),t.LinePieces);this.matrixAutoUpdate=!1;this.update()};t.VertexTangentsHelper.prototype=Object.create(t.Line.prototype);t.VertexTangentsHelper.prototype.constructor=t.VertexTangentsHelper;t.VertexTangentsHelper.prototype.update=function(e){var r=new t.Vector3;return function(t){t=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var e=this.geometry.vertices,i=this.object.geometry.vertices,n=this.object.geometry.faces,o=this.object.matrixWorld,a=0,s=0,h=n.length;s<h;s++)for(var l=n[s],c=0,u=l.vertexTangents.length;c<u;c++){var f=l.vertexTangents[c];e[a].copy(i[l[t[c]]]).applyMatrix4(o);r.copy(f).transformDirection(o).multiplyScalar(this.size);r.add(e[a]);a+=1;e[a].copy(r);a+=1}this.geometry.verticesNeedUpdate=!0;return this}}();t.WireframeHelper=function(e,r){var i=void 0!==r?r:16777215,n=[0,0],o={},a=function(t,e){return t-e},s=["a","b","c"],h=new t.BufferGeometry;if(e.geometry instanceof t.Geometry){for(var l=e.geometry.vertices,c=e.geometry.faces,u=0,f=new Uint32Array(6*c.length),p=0,d=c.length;p<d;p++)for(var m=c[p],g=0;3>g;g++){n[0]=m[s[g]];n[1]=m[s[(g+1)%3]];n.sort(a);var y=n.toString();void 0===o[y]&&(f[2*u]=n[0],f[2*u+1]=n[1],o[y]=!0,u++)}n=new Float32Array(6*u);p=0;for(d=u;p<d;p++)for(g=0;2>g;g++)u=l[f[2*p+g]],s=6*p+3*g,n[s+0]=u.x,n[s+1]=u.y,n[s+2]=u.z;h.addAttribute("position",new t.BufferAttribute(n,3))}else if(e.geometry instanceof t.BufferGeometry){if(void 0!==e.geometry.attributes.index){l=e.geometry.attributes.position.array;d=e.geometry.attributes.index.array;c=e.geometry.drawcalls;u=0;0===c.length&&(c=[{count:d.length,index:0,start:0}]);for(var f=new Uint32Array(2*d.length),m=0,v=c.length;m<v;++m)for(var g=c[m].start,y=c[m].count,s=c[m].index,p=g,x=g+y;p<x;p+=3)for(g=0;3>g;g++)n[0]=s+d[p+g],n[1]=s+d[p+(g+1)%3],n.sort(a),y=n.toString(),void 0===o[y]&&(f[2*u]=n[0],f[2*u+1]=n[1],o[y]=!0,u++);n=new Float32Array(6*u);p=0;for(d=u;p<d;p++)for(g=0;2>g;g++)s=6*p+3*g,u=3*f[2*p+g],n[s+0]=l[u],n[s+1]=l[u+1],n[s+2]=l[u+2]}else for(l=e.geometry.attributes.position.array,u=l.length/3,f=u/3,n=new Float32Array(6*u),p=0,d=f;p<d;p++)for(g=0;3>g;g++)s=18*p+6*g,f=9*p+3*g,n[s+0]=l[f],n[s+1]=l[f+1],n[s+2]=l[f+2],u=9*p+(g+1)%3*3,n[s+3]=l[u],n[s+4]=l[u+1],n[s+5]=l[u+2];h.addAttribute("position",new t.BufferAttribute(n,3))}t.Line.call(this,h,new t.LineBasicMaterial({color:i}),t.LinePieces);this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1};t.WireframeHelper.prototype=Object.create(t.Line.prototype);t.WireframeHelper.prototype.constructor=t.WireframeHelper;t.ImmediateRenderObject=function(){t.Object3D.call(this);this.render=function(t){}};t.ImmediateRenderObject.prototype=Object.create(t.Object3D.prototype);t.ImmediateRenderObject.prototype.constructor=t.ImmediateRenderObject;t.MorphBlendMesh=function(e,r){t.Mesh.call(this,e,r);this.animationsMap={};this.animationsList=[];var i=this.geometry.morphTargets.length;this.createAnimation("__default",0,i-1,i/1);this.setAnimationWeight("__default",1)};t.MorphBlendMesh.prototype=Object.create(t.Mesh.prototype);t.MorphBlendMesh.prototype.constructor=t.MorphBlendMesh;t.MorphBlendMesh.prototype.createAnimation=function(t,e,r,i){e={startFrame:e,endFrame:r,length:r-e+1,fps:i,duration:(r-e)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[t]=e;this.animationsList.push(e)};t.MorphBlendMesh.prototype.autoCreateAnimations=function(t){for(var e=/([a-z]+)_?(\d+)/,r,i={},n=this.geometry,o=0,a=n.morphTargets.length;o<a;o++){var s=n.morphTargets[o].name.match(e);if(s&&1<s.length){var h=s[1];i[h]||(i[h]={start:Infinity,end:-Infinity});s=i[h];o<s.start&&(s.start=o);o>s.end&&(s.end=o);r||(r=h)}}for(h in i)s=i[h],this.createAnimation(h,s.start,s.end,t);this.firstAnimation=r};t.MorphBlendMesh.prototype.setAnimationDirectionForward=function(t){if(t=this.animationsMap[t])t.direction=1,t.directionBackwards=!1};t.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(t){if(t=this.animationsMap[t])t.direction=-1,t.directionBackwards=!0};t.MorphBlendMesh.prototype.setAnimationFPS=function(t,e){var r=this.animationsMap[t];r&&(r.fps=e,r.duration=(r.end-r.start)/r.fps)};t.MorphBlendMesh.prototype.setAnimationDuration=function(t,e){var r=this.animationsMap[t];r&&(r.duration=e,r.fps=(r.end-r.start)/r.duration)};t.MorphBlendMesh.prototype.setAnimationWeight=function(t,e){var r=this.animationsMap[t];r&&(r.weight=e)};t.MorphBlendMesh.prototype.setAnimationTime=function(t,e){var r=this.animationsMap[t];r&&(r.time=e)};t.MorphBlendMesh.prototype.getAnimationTime=function(t){var e=0;if(t=this.animationsMap[t])e=t.time;return e};t.MorphBlendMesh.prototype.getAnimationDuration=function(t){var e=-1;if(t=this.animationsMap[t])e=t.duration;return e};t.MorphBlendMesh.prototype.playAnimation=function(e){var r=this.animationsMap[e];r?(r.time=0,r.active=!0):t.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")};t.MorphBlendMesh.prototype.stopAnimation=function(t){if(t=this.animationsMap[t])t.active=!1};t.MorphBlendMesh.prototype.update=function(e){for(var r=0,i=this.animationsList.length;r<i;r++){var n=this.animationsList[r];if(n.active){var o=n.duration/n.length;n.time+=n.direction*e;if(n.mirroredLoop){if(n.time>n.duration||0>n.time)n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),0>n.time&&(n.time=0,n.directionBackwards=!1)}else n.time%=n.duration,0>n.time&&(n.time+=n.duration);var a=n.startFrame+t.Math.clamp(Math.floor(n.time/o),0,n.length-1),s=n.weight;a!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*s,this.morphTargetInfluences[a]=0,n.lastFrame=n.currentFrame,n.currentFrame=a);o=n.time%o/o;n.directionBackwards&&(o=1-o);this.morphTargetInfluences[n.currentFrame]=o*s;this.morphTargetInfluences[n.lastFrame]=(1-o)*s}}};